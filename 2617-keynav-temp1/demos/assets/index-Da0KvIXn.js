import{eM as A,i3 as y,i4 as C,eN as $,eQ as E,e$ as w,f2 as K,f5 as L,ds as h,f6 as x,eU as l,dt as f,du as t,e_ as u,eX as z,eW as _,eZ as D,F as H,i5 as S,i6 as N}from"./main-sd5p277L.js";import"./preload-helper-DMGCcr4D.js";const T={en:{"keyboardnav.activeNamespace":"Namespace Active: {name}","keyboardnav.helpTitle":"Keyboard Shortcuts","keyboardnav.keysTitle":"Keys for {name}","keyboardnav.helpDescription":'Press <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> to start fixture shortcuts then type the fixture key (for example <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) followed by an action key like <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Use <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Escape</span> to clear the chain or <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Backspace</span> to undo the last key.',"keyboardnav.noShortcuts":"No shortcuts available.","keyboardnav.mainShortcuts.title":"Global controls","keyboardnav.mainShortcuts.numbers":"Focus on an open panel (1 being leftmost)","keyboardnav.mainShortcuts.escape":"Clear the chain or close the focused panel","keyboardnav.mainShortcuts.start":"Start or reset fixture shortcuts","keyboardnav.mainShortcuts.backspace":"Remove the last key in the chain","keyboardnav.chain.help":"Toggle shortcut guide"},fr:{"keyboardnav.activeNamespace":"Espace de noms actif : {name}","keyboardnav.helpTitle":"Raccourcis clavier","keyboardnav.keysTitle":"Raccourcis pour {name}","keyboardnav.helpDescription":`Appuyez sur <span class='key indigo'>S</span> pour dAcmarrer les raccourcis de module puis saisissez la touche du module (par exemple <span class='key indigo'>D</span>) suivie d'une touche d'action comme <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Utilisez <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Echap</span> pour effacer la chaAne ou <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Retour</span> pour enlever la derniA\\\\"re touche.`,"keyboardnav.noShortcuts":"Aucun raccourci disponible.","keyboardnav.mainShortcuts.title":"ContrA'les globaux","keyboardnav.mainShortcuts.numbers":"Concentrer sur un panneau ouvert (1 Actant le plus Aï¿½ gauche)","keyboardnav.mainShortcuts.escape":"Vider la chaAne ou fermer le panneau en focus","keyboardnav.mainShortcuts.start":'DAmarrer ou rA\\\\"initialiser les raccourcis de module',"keyboardnav.mainShortcuts.backspace":'Retirer la derniA\\\\"re touche de la chaAne',"keyboardnav.chain.help":"Afficher ou masquer le guide des raccourcis"}},B={class:"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl",role:"dialog","aria-modal":"true","aria-live":"polite"},R={class:"border-b border-gray-200 bg-white px-4 py-20 sm:px-24"},V={class:"text-base font-semibold text-gray-900"},M=["innerHTML"],O={role:"list",class:"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5"},I={class:"pl-24 mb-8 py-16"},U={class:"flex items-center gap-x-12"},j={class:"font-mono text-md text-zinc-600"},F={class:"space-y-4 p-16 pl-24"},P={class:"flex items-center gap-x-12"},q={class:"font-mono text-md text-zinc-600"},G={class:"flex items-center gap-x-12"},Q={class:"font-mono text-md text-zinc-600"},W={class:"flex items-center gap-x-12"},X={class:"font-mono text-md text-zinc-600"},Y={class:"flex items-center gap-x-12"},Z={class:"font-mono text-md text-zinc-600"},J={key:0,class:"pl-24 mb-8 py-16 border-b"},ee={class:"font-mono text-md text-zinc-600"},ne={class:"flex items-center gap-x-4"},te={class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},se={class:"font-mono text-md text-zinc-600"},ae={key:0,class:"space-y-4 p-16 pl-24"},ie={class:"flex items-center gap-x-4"},re={class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},oe={class:"font-mono text-md text-zinc-600"},ce=A({__name:"keyboardnav",setup(v){const a=y(),{activeNamespace:n,namespaces:e,helpVisible:p}=C(a),{t:r}=$(),g=E(()=>Object.entries(e.value).map(([d,s])=>({id:d,keys:s?.keys??[]}))),i=w("overlayRef");function c(){a.setHelpVisible(!1),a.resetChain({suppressHandler:!0})}function o(d){const s=d.target;i.value&&s&&!i.value.contains(s)&&c()}function b(d){d.target===d.currentTarget&&c()}return K(p,d=>{d?document.addEventListener("focusin",o):document.removeEventListener("focusin",o)}),L(()=>{document.removeEventListener("focusin",o)}),(d,s)=>l(p)?(f(),h("div",{key:0,ref_key:"overlayRef",ref:i,class:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto",tabindex:"-1",onClick:b},[t("div",B,[t("button",{type:"button",class:"absolute right-8 top-8 rounded px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:c},u(l(r)("panels.controls.close")),1),t("div",R,[t("h3",V,u(l(r)("keyboardnav.helpTitle")),1),t("div",{innerHTML:l(r)("keyboardnav.helpDescription"),class:"mt-6 text-sm text-gray-500"},null,8,M)]),t("ul",O,[t("li",I,[t("div",U,[t("span",j,u(l(r)("keyboardnav.mainShortcuts.title")),1)]),t("div",F,[t("div",P,[s[0]||(s[0]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," 1-5 ",-1)),s[1]||(s[1]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",q,u(l(r)("keyboardnav.mainShortcuts.numbers")),1)]),t("div",G,[s[2]||(s[2]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," ESC ",-1)),s[3]||(s[3]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",Q,u(l(r)("keyboardnav.mainShortcuts.escape")),1)]),t("div",W,[s[4]||(s[4]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," S ",-1)),s[5]||(s[5]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",X,u(l(r)("keyboardnav.mainShortcuts.start")),1)]),t("div",Y,[s[6]||(s[6]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," Backspace ",-1)),s[7]||(s[7]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",Z,u(l(r)("keyboardnav.mainShortcuts.backspace")),1)])])]),g.value.length===0?(f(),h("li",J,[t("p",ee,u(l(r)("keyboardnav.noShortcuts")),1)])):x("",!0),(f(!0),h(z,null,_(g.value,m=>(f(),h("li",{key:m.id,class:"pl-24 mb-8 py-16 border-b"},[t("div",{class:D(["flex items-center gap-x-12",{"opacity-60":l(n)&&l(n)!==m.id}])},[t("div",ne,[s[8]||(s[8]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},"S",-1)),t("span",te,u(m.id),1)]),s[9]||(s[9]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",se,u(l(r)(`keyboardnav.ns.${m.id}`)),1)],2),m.keys.length?(f(),h("div",ae,[(f(!0),h(z,null,_(m.keys,k=>(f(),h("div",{key:k.key,class:"flex items-center gap-x-12"},[t("div",ie,[t("span",re,u(k.key),1)]),s[10]||(s[10]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",oe,u(l(r)(`keyboardnav.key.${m.id}.${k.key}`)),1)]))),128))])):x("",!0)]))),128))])])],512)):x("",!0)}});class le extends H{keyboardnavStore=y(this.$vApp.$pinia);_isInput(a){return!a||!(a instanceof HTMLElement)?!1:!!a.closest('input, textarea, [contenteditable="true"]')}register(a,n){const e=a.toUpperCase(),p=this.keyboardnavStore.register(e,n),r=`keyboardnav.ns.${p}`;return Object.entries(n.name).forEach(([g,i])=>{this.$iApi.$i18n.mergeLocaleMessage(g,{[r]:i})}),n.keys.forEach(g=>{const i=`keyboardnav.key.${p}.${g.key}`;Object.entries(g.description).forEach(([c,o])=>{this.$iApi.$i18n.mergeLocaleMessage(c,{[i]:o})})}),p}added(){const a=this.$iApi.$rootEl;a?.addEventListener("keydown",this._handleKeyDown),a?.addEventListener("blur",this._handleBlur)}removed(){const a=this.$iApi.$rootEl;a?.removeEventListener("keydown",this._handleKeyDown),a?.removeEventListener("blur",this._handleBlur)}_handleKeyDown=a=>{if(!(a instanceof KeyboardEvent))return;const n=a;if(this._isInput(n.target))return;const e=this.keyboardnavStore,p=e.keyChain,r=n.altKey||n.ctrlKey||n.metaKey;if(!n.shiftKey&&!r&&!p.length&&/^[1-5]$/.test(n.key)){const c=parseInt(n.key,10)-1,o=this.$iApi.panel.visible[c];o&&(n.preventDefault(),this.$iApi.panel.focus(o));return}const g=n.key,i=g.length===1?g.toUpperCase():g;if(!r&&i==="Escape"&&e.helpVisible){n.preventDefault(),e.setHelpVisible(!1),e.resetChain({suppressHandler:!0});return}if(!n.shiftKey&&!r&&i===S){n.preventDefault();const c=e.chainState==="complete";e.resetChain({suppressHandler:c}),e.setChain([S]),e.setLastAction(null),e.setChainState("awaitNamespace");return}if(e.chainState==="idle"){if(i==="Escape"&&!n.shiftKey&&!r){const o=n.target.closest("[data-cy]");if(o&&this.$iApi.$rootEl?.querySelector(".panel-container")?.contains(o)){n.preventDefault();const b=o.getAttribute("data-cy");b&&this.$iApi.panel.close(b)}}return}if(i==="Escape"){n.preventDefault(),e.resetChain({event:n});return}if(i==="Backspace"){if(!p.length)return;n.preventDefault();const c=e.chainState;if(e.setLastAction(null),e.popChain(),!e.keyChain.length){e.resetChain({suppressHandler:!0});return}if(e.keyChain.length===1){e.setChainState("awaitNamespace"),e.deactivate(n);return}if(e.keyChain.length===2){e.setChainState("awaitAction");const o=e.keyChain[1];c==="complete"&&o&&e.activate(o,n,{suppressHandler:!1});return}return}if(!(n.shiftKey||r)){if(e.chainState==="awaitNamespace"){const c=Object.keys(e.namespaces);if(i==="H"){n.preventDefault(),e.appendKey("H"),e.setLastAction({namespace:N,key:"H"}),e.finalizeChain({event:n}),e.setHelpVisible(!e.helpVisible);return}if(c.includes(i)){n.preventDefault(),e.appendKey(i),e.setLastAction(null),e.activate(i,n),e.setChainState("awaitAction");return}return}if(e.chainState==="awaitAction"){const c=e.activeNamespace??(p[1]||""),o=e.namespaces[c];if(!o){e.resetChain({suppressHandler:!0});return}if(!o.keys.map(s=>s.key.toUpperCase()).includes(i))return;n.preventDefault(),e.appendKey(i);const d=e.trigger(i,n);if(d?.chainAction)return;d&&e.setLastAction(d),e.finalizeChain({event:n});return}}};_handleBlur=()=>{this.keyboardnavStore.resetChain(),this.keyboardnavStore.setHelpVisible(!1)}}class ue extends le{added(){Object.entries(T).forEach(p=>this.$iApi.$i18n.mergeLocaleMessage(...p));const{destroy:a,el:n}=this.mount(ce,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(n.childNodes[0]),super.added(),this.removed=()=>{super.removed(),a(),y(this.$vApp.$pinia).$reset()}}}export{ue as default};
