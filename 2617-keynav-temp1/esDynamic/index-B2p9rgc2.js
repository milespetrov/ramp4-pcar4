import{eM as C,i0 as f,i1 as $,eN as w,eQ as E,e$ as L,f2 as D,f5 as H,dp as m,f6 as y,eU as l,dq as h,dr as t,e_ as d,eX as z,eW as S,eZ as K,F as N,i2 as A,i3 as _}from"./main-CsxAHRlH.js";const T={en:{"keyboardnav.activeNamespace":"Namespace Active: {name}","keyboardnav.helpTitle":"Keyboard Shortcuts","keyboardnav.keysTitle":"Keys for {name}","keyboardnav.helpDescription":'Press <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> to start fixture shortcuts then type the fixture key (for example <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) followed by an action key like <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Use <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Escape</span> to clear the chain or <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Backspace</span> to undo the last key.',"keyboardnav.noShortcuts":"No shortcuts available.","keyboardnav.mainShortcuts.title":"Global controls","keyboardnav.mainShortcuts.numbers":"Focus on an open panel (1 being leftmost)","keyboardnav.mainShortcuts.escape":"Clear the chain or close the focused panel","keyboardnav.mainShortcuts.start":"Start or reset fixture shortcuts","keyboardnav.mainShortcuts.backspace":"Remove the last key in the chain","keyboardnav.chain.help":"Toggle shortcut guide"},fr:{"keyboardnav.activeNamespace":"Espace de noms actif : {name}","keyboardnav.helpTitle":"Raccourcis clavier","keyboardnav.keysTitle":"Raccourcis pour {name}","keyboardnav.helpDescription":`Appuyez sur <span class='key indigo'>S</span> pour dAcmarrer les raccourcis de module puis saisissez la touche du module (par exemple <span class='key indigo'>D</span>) suivie d'une touche d'action comme <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Utilisez <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Echap</span> pour effacer la chaAne ou <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Retour</span> pour enlever la derniA\\\\"re touche.`,"keyboardnav.noShortcuts":"Aucun raccourci disponible.","keyboardnav.mainShortcuts.title":"ContrA'les globaux","keyboardnav.mainShortcuts.numbers":"Concentrer sur un panneau ouvert (1 Actant le plus A\uFFFD gauche)","keyboardnav.mainShortcuts.escape":"Vider la chaAne ou fermer le panneau en focus","keyboardnav.mainShortcuts.start":'DAmarrer ou rA\\\\"initialiser les raccourcis de module',"keyboardnav.mainShortcuts.backspace":'Retirer la derniA\\\\"re touche de la chaAne',"keyboardnav.chain.help":"Afficher ou masquer le guide des raccourcis"}},V={class:"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl",role:"dialog","aria-modal":"true","aria-live":"polite"},B={class:"border-b border-gray-200 bg-white px-4 py-20 sm:px-24"},M={class:"text-base font-semibold text-gray-900"},R=["innerHTML"],j={role:"list",class:"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5"},U={class:"pl-24 mb-8 py-16"},O={class:"flex items-center gap-x-12"},q={class:"font-mono text-md text-zinc-600"},I={class:"space-y-4 p-16 pl-24"},F={class:"flex items-center gap-x-12"},G={class:"font-mono text-md text-zinc-600"},P={class:"flex items-center gap-x-12"},Q={class:"font-mono text-md text-zinc-600"},W={class:"flex items-center gap-x-12"},X={class:"font-mono text-md text-zinc-600"},Z={class:"flex items-center gap-x-12"},J={class:"font-mono text-md text-zinc-600"},Y={key:0,class:"pl-24 mb-8 py-16 border-b"},ee={class:"font-mono text-md text-zinc-600"},ne={class:"flex items-center gap-x-4"},te={class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},ae={class:"font-mono text-md text-zinc-600"},ie={key:0,class:"space-y-4 p-16 pl-24"},re={class:"flex items-center gap-x-4"},se={class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},ce={class:"font-mono text-md text-zinc-600"},oe=C({__name:"keyboardnav",setup(v){const i=f(),{activeNamespace:n,namespaces:e,helpVisible:g}=$(i),{t:s}=w(),p=E(()=>Object.entries(e.value).map(([u,a])=>({id:u,keys:a?.keys??[]}))),r=L("overlayRef");function c(){i.setHelpVisible(!1),i.resetChain({suppressHandler:!0})}function o(u){const a=u.target;r.value&&a&&!r.value.contains(a)&&c()}function k(u){u.target===u.currentTarget&&c()}return D(g,u=>{u?document.addEventListener("focusin",o):document.removeEventListener("focusin",o)}),H(()=>{document.removeEventListener("focusin",o)}),(u,a)=>l(g)?(h(),m("div",{key:0,ref_key:"overlayRef",ref:r,class:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto",tabindex:"-1",onClick:k},[t("div",V,[t("button",{type:"button",class:"absolute right-8 top-8 rounded px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:c},d(l(s)("panels.controls.close")),1),t("div",B,[t("h3",M,d(l(s)("keyboardnav.helpTitle")),1),t("div",{innerHTML:l(s)("keyboardnav.helpDescription"),class:"mt-6 text-sm text-gray-500"},null,8,R)]),t("ul",j,[t("li",U,[t("div",O,[t("span",q,d(l(s)("keyboardnav.mainShortcuts.title")),1)]),t("div",I,[t("div",F,[a[0]||(a[0]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," 1-5 ",-1)),a[1]||(a[1]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",G,d(l(s)("keyboardnav.mainShortcuts.numbers")),1)]),t("div",P,[a[2]||(a[2]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," ESC ",-1)),a[3]||(a[3]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",Q,d(l(s)("keyboardnav.mainShortcuts.escape")),1)]),t("div",W,[a[4]||(a[4]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," S ",-1)),a[5]||(a[5]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",X,d(l(s)("keyboardnav.mainShortcuts.start")),1)]),t("div",Z,[a[6]||(a[6]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," Backspace ",-1)),a[7]||(a[7]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",J,d(l(s)("keyboardnav.mainShortcuts.backspace")),1)])])]),p.value.length===0?(h(),m("li",Y,[t("p",ee,d(l(s)("keyboardnav.noShortcuts")),1)])):y("",!0),(h(!0),m(z,null,S(p.value,b=>(h(),m("li",{key:b.id,class:"pl-24 mb-8 py-16 border-b"},[t("div",{class:K(["flex items-center gap-x-12",{"opacity-60":l(n)&&l(n)!==b.id}])},[t("div",ne,[a[8]||(a[8]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},"S",-1)),t("span",te,d(b.id),1)]),a[9]||(a[9]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",ae,d(l(s)(`keyboardnav.ns.${b.id}`)),1)],2),b.keys.length?(h(),m("div",ie,[(h(!0),m(z,null,S(b.keys,x=>(h(),m("div",{key:x.key,class:"flex items-center gap-x-12"},[t("div",re,[t("span",se,d(x.key),1)]),a[10]||(a[10]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",ce,d(l(s)(`keyboardnav.key.${b.id}.${x.key}`)),1)]))),128))])):y("",!0)]))),128))])])],512)):y("",!0)}});class le extends N{keyboardnavStore=f(this.$vApp.$pinia);_isInput(i){return!i||!(i instanceof HTMLElement)?!1:!!i.closest('input, textarea, [contenteditable="true"]')}register(i,n){const e=i.toUpperCase(),g=this.keyboardnavStore.register(e,n),s=`keyboardnav.ns.${g}`;return Object.entries(n.name).forEach(([p,r])=>{this.$iApi.$i18n.mergeLocaleMessage(p,{[s]:r})}),n.keys.forEach(p=>{const r=`keyboardnav.key.${g}.${p.key}`;Object.entries(p.description).forEach(([c,o])=>{this.$iApi.$i18n.mergeLocaleMessage(c,{[r]:o})})}),g}added(){const i=this.$iApi.$rootEl;i?.addEventListener("keydown",this._handleKeyDown),i?.addEventListener("blur",this._handleBlur)}removed(){const i=this.$iApi.$rootEl;i?.removeEventListener("keydown",this._handleKeyDown),i?.removeEventListener("blur",this._handleBlur)}_handleKeyDown=i=>{if(!(i instanceof KeyboardEvent))return;const n=i;if(this._isInput(n.target))return;const e=this.keyboardnavStore,g=e.keyChain,s=n.altKey||n.ctrlKey||n.metaKey;if(!n.shiftKey&&!s&&!g.length&&/^[1-5]$/.test(n.key)){const c=parseInt(n.key,10)-1,o=this.$iApi.panel.visible[c];o&&(n.preventDefault(),this.$iApi.panel.focus(o));return}const p=n.key,r=p.length===1?p.toUpperCase():p;if(!s&&r==="Escape"&&e.helpVisible){n.preventDefault(),e.setHelpVisible(!1),e.resetChain({suppressHandler:!0});return}if(!n.shiftKey&&!s&&r===A){n.preventDefault();const c=e.chainState==="complete";e.resetChain({suppressHandler:c}),e.setChain([A]),e.setLastAction(null),e.setChainState("awaitNamespace");return}if(e.chainState==="idle"){if(r==="Escape"&&!n.shiftKey&&!s){const c=n.target.closest("[data-cy]");if(c&&this.$iApi.$rootEl?.querySelector(".panel-container")?.contains(c)){n.preventDefault();const o=c.getAttribute("data-cy");o&&this.$iApi.panel.close(o)}}return}if(r==="Escape"){n.preventDefault(),e.resetChain({event:n});return}if(r==="Backspace"){if(!g.length)return;n.preventDefault();const c=e.chainState;if(e.setLastAction(null),e.popChain(),!e.keyChain.length){e.resetChain({suppressHandler:!0});return}if(e.keyChain.length===1){e.setChainState("awaitNamespace"),e.deactivate(n);return}if(e.keyChain.length===2){e.setChainState("awaitAction");const o=e.keyChain[1];c==="complete"&&o&&e.activate(o,n,{suppressHandler:!1});return}return}if(!(n.shiftKey||s)){if(e.chainState==="awaitNamespace"){const c=Object.keys(e.namespaces);if(r==="H"){n.preventDefault(),e.appendKey("H"),e.setLastAction({namespace:_,key:"H"}),e.finalizeChain({event:n}),e.setHelpVisible(!e.helpVisible);return}if(c.includes(r)){n.preventDefault(),e.appendKey(r),e.setLastAction(null),e.activate(r,n),e.setChainState("awaitAction");return}return}if(e.chainState==="awaitAction"){const c=e.activeNamespace??(g[1]||""),o=e.namespaces[c];if(!o){e.resetChain({suppressHandler:!0});return}if(!o.keys.map(u=>u.key.toUpperCase()).includes(r))return;n.preventDefault(),e.appendKey(r);const k=e.trigger(r,n);if(k?.chainAction)return;k&&e.setLastAction(k),e.finalizeChain({event:n});return}}};_handleBlur=()=>{this.keyboardnavStore.resetChain(),this.keyboardnavStore.setHelpVisible(!1)}}class de extends le{added(){Object.entries(T).forEach(e=>this.$iApi.$i18n.mergeLocaleMessage(...e));const{destroy:i,el:n}=this.mount(oe,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(n.childNodes[0]),super.added(),this.removed=()=>{super.removed(),i(),f(this.$vApp.$pinia).$reset()}}}export{de as default};
