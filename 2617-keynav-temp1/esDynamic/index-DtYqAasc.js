import{v as o,x as s,z as S,n as Y,V as te,N as Ie,bp as ae,fa as $e,c8 as nt,gS as di,gR as ci,hN as pi,kS as kt,kT as Et,kU as hi,kV as ui,kW as Pt,bC as gi,cG as rt,c4 as yi,e as mi,bZ as ze,fQ as vi,am as ie,o as bi,a4 as wi,i as de,g0 as fi,ab as M,l as Ge,i$ as Ue,fZ as at,ad as dt,dJ as It,e1 as $,kX as _i,kY as Ti,kZ as Mi,gv as We,cc as Ci,s as Si,fA as Li,ac as Oi,e8 as At,k_ as ki,k$ as Ei,l0 as Pi,l1 as Ii,l2 as Ai,l3 as Di,l4 as xi,ci as Ri,cj as Gi,l5 as Be,l6 as Bi,cp as Fi,l7 as Vi,l8 as Ni,eM as Hi,eN as $i,e$ as zi,a as Ui,f2 as Dt,f3 as Wi,f4 as Ki,eC as xt,l9 as ji,dp as qi,dq as Qi,hd as Yi,el as Ke,du as Rt,dt as Zi,bv as fe,al as _e,F as Ji,gi as Xi}from"./main-CsxAHRlH.js";import{u as ct}from"./draw-store-C5nYcvIg.js";import eo from"./GraphicsLayer-EJ4MUIZn.js";import{o as to}from"./intl-BXc08Gz8.js";import{Y as io,m as Gt,l as Bt,_ as Ft,af as oo,ag as so,k as Vt,ah as Fe}from"./SketchViewModel-Bl4ntw5v.js";import{n as p,p as lo,O as oe,a as ce,i as Nt,e as pe,j as no}from"./jsxFactory-CevjCIHY.js";import{a as je,m as ro,e as pt}from"./utils-DINVteIY.js";import{u as qe}from"./layerViewUtils-B5a1vrGN.js";import{d as Ht}from"./asyncUtils-DH52Dic-.js";import{r as ao,o as co}from"./drapedUtils-DflKiHHB.js";import{e as $t}from"./utils-C0LvbFCo.js";import{e as zt,a as po}from"./widget-DH9iuva8.js";import{s as Ut}from"./substitute-uz1fJIJ2.js";const ho=(e,t,i)=>{const l=e[t];return l?typeof l=="function"?l():Promise.resolve(l):new Promise((n,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})};let z=class extends Y{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};o([s({type:Boolean,nonNullable:!0})],z.prototype,"colorSelection",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"dynamicScaleToggle",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"gridEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"numericInputs",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"gridSnapEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"lineIntervalInput",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"outOfScaleWarning",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"placementButtons",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"rotateWithMapToggle",void 0),z=o([S("esri.widgets.support.GridControls.VisibleElements")],z);const ht=z;let U=class extends Y{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new ht({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};o([s({type:Boolean,nonNullable:!0})],U.prototype,"enabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"featureEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"gridEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"header",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"layerList",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"gridControls",void 0),o([s({type:ht,nonNullable:!0})],U.prototype,"gridControlsElements",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"layerListToggleLayersButton",void 0),o([s({type:Boolean,nonNullable:!0})],U.prototype,"selfEnabledToggle",void 0),U=o([S("esri.widgets.support.SnappingControls.VisibleElements")],U);const Qe=U;let H=class extends Y{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};o([s({type:Boolean,nonNullable:!0})],H.prototype,"point",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"polyline",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"polygon",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"rectangle",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"circle",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"multipoint",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"mesh",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"freehandPolyline",void 0),o([s({type:Boolean,nonNullable:!0})],H.prototype,"freehandPolygon",void 0),H=o([S("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],H);let Te=class extends Y{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};o([s({nonNullable:!0})],Te.prototype,"rectangle-selection",void 0),o([s({nonNullable:!0})],Te.prototype,"lasso-selection",void 0),o([s({nonNullable:!0})],Te.prototype,"custom-selection",void 0),Te=o([S("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],Te);let R=class extends Y{constructor(e){super(e),this.createTools=new H,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new Te,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new Qe,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};o([s({type:H,nonNullable:!0})],R.prototype,"createTools",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"directionModePicker",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"duplicateButton",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"deleteButton",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"selectionCountLabel",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"labelsToggle",void 0),o([s({type:Te,nonNullable:!0})],R.prototype,"selectionTools",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"settingsMenu",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"snappingControls",void 0),o([s({type:Qe,nonNullable:!0})],R.prototype,"snappingControlsElements",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"tooltipsToggle",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"undoRedoMenu",void 0),R=o([S("esri.widgets.Sketch.VisibleElements")],R);const A={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},Wt={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function Kt(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(i=>Kt(i,t))??[]}const ut=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(i){const l=this._get("measurementManager");i!==l&&(l&&l.managedElements.remove(this),this._set("measurementManager",i),i?.managedElements.add(this))}set budgetedLength(i){this.budgetedLength!==i&&(this._set("budgetedLength",i),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(i=>Kt(i,"calcite-action"))??[]}get activeChildElement(){const i=this.actionChildren.find(l=>l.properties?.active===!0);return i?(this._set("lastActiveKey",i.properties?.key),i):this.lastActiveKey?this.actionChildren.find(l=>l.properties?.key===this.lastActiveKey):void 0}_handleClick(i){i?.dataset&&"dataset"in i&&i.dataset.actionKey&&(this.lastActiveKey=i.dataset.actionKey)}};return o([s()],t.prototype,"priority",void 0),o([s()],t.prototype,"measurementManager",null),o([s()],t.prototype,"budgetedLength",null),o([s()],t.prototype,"actionChildren",null),o([s()],t.prototype,"activeChildElement",null),o([s()],t.prototype,"scale",void 0),o([s()],t.prototype,"slot",void 0),o([s()],t.prototype,"lastActiveKey",void 0),o([s()],t.prototype,"layout",void 0),t=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t},jt=Symbol("on-resize-handle-key");let Me=class extends ut(oe){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return p("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(lo(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),jt)},afterRemoved:()=>this.removeHandles(jt)},this.children)}};o([s()],Me.prototype,"_measuredWidth",void 0),o([s()],Me.prototype,"_measuredHeight",void 0),o([s()],Me.prototype,"lengthOptions",null),o([s()],Me.prototype,"_measuredElement",void 0),Me=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],Me);let Ce=class extends ut(oe){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return ce({action:()=>import("./index-1Ra4Eoox.js"),"action-group":()=>import("./index-C6BX4pTh.js").then(e=>e.i),"action-menu":()=>import("./index-DPtaHHqC.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?A.groupSeparator+A.action[t]*Math.min(e.length,2):A.groupSeparator+A.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:l,priority:n}=this,r=[i];if(e.length<=2||!l||n<1)return r;for(let a=1;a<e.length-1;a++)r.push(i+A.action[t]*a);return r}render(){if(!this.actionChildren.length)return p(Nt,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:l,slot:n,scale:r}=this,a=Math.floor(e/A.action[r]),c=[],d=[];if(a>=t.length)c.push(...t);else{const u=i??c.at(0);if(c.push(...t.slice(0,a-1)),d.push(...t.slice(a-1)),u&&d.includes(u)){const[g]=d.splice(d.indexOf(u),1),w=c.pop();c.push(g),w&&d.unshift(w)}}return p("calcite-action-group",{key:"overflow-button-group",layout:l,onclick:u=>this._handleClick(u.target),slot:n},c.map(u=>this._renderManagedAction(u)),d.length>0?p("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},p("calcite-action",{icon:Wt.overflow,key:"split-button-dropdown-trigger",scale:r,slot:"trigger",text:this.messagesCommon.more}),d.map(u=>this._renderManagedAction(u))):void 0)}_renderManagedAction(e){return p("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};o([s()],Ce.prototype,"allowCollapse",void 0),o([s()],Ce.prototype,"minimumLength",null),o([s(),pe("esri/t9n/common")],Ce.prototype,"messagesCommon",void 0),o([s()],Ce.prototype,"lengthOptions",null),Ce=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],Ce);let he=class extends Y{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new te,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let l=0;for(const n of i){const r=n.lengthOptions[0];e.set(n,r),l+=r}for(const n of i)for(;l<t;){const r=e.get(n);if(!r)break;const a=n.lengthOptions.find(d=>d>r);if(!a)break;const c=l-r+a;if(c>t)break;e.set(n,a),l=c}for(const[n,r]of e)n.budgetedLength=r}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};o([s()],he.prototype,"measuredElement",void 0),o([s()],he.prototype,"managedElements",void 0),o([s()],he.prototype,"_sortedElements",null),o([s()],he.prototype,"availableLength",void 0),o([s()],he.prototype,"layout",void 0),he=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],he);const uo={splitButtonBase:"esri-split-button--split-part"};let Se=class extends ut(oe){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return ce({action:()=>import("./index-1Ra4Eoox.js"),"action-group":()=>import("./index-C6BX4pTh.js").then(e=>e.i),"action-menu":()=>import("./index-DPtaHHqC.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?A.action[this.scale]+A.groupSeparator:this.allowCollapse?A.action[this.scale]+A.splitButtonPart[this.layout][this.scale]+A.groupSeparator:A.action[this.scale]*e.length+A.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:l,priority:n,allowCollapse:r}=this;if(e.length<2||n<0||!r)return[t];const a=A.groupSeparator+A.action[l]*e.length;return[A.groupSeparator+A.action[l]+A.splitButtonPart[i][l],a]}render(){if(!this.actionChildren.length)return p(Nt,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:l,slot:n,allowCollapse:r}=this,a=!r||e.length<2||i>t;return p("calcite-action-group",{key:"split-button-group",layout:l,onclick:c=>this._handleClick(c.target),slot:n},a?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:l,messagesCommon:n}=this,r=e??i.at(0);if(!r)return;const a=i.filter(c=>c!==r);return[this._renderManagedAction(r),p("calcite-action-menu",{key:"split-button-dropdown",label:n.more,overlayPositioning:"fixed",placement:t==="horizontal"?"bottom-end":"right-end"},p("calcite-action",{class:`${uo.splitButtonBase}--${t}--${this.scale}`,compact:t==="horizontal",icon:Wt.splitButton[t],key:"split-button-dropdown-trigger",scale:l,slot:"trigger",text:n.more}),a?.map(c=>this._renderManagedAction(c)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return p("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};o([s()],Se.prototype,"minimumLength",null),o([s()],Se.prototype,"allowCollapse",void 0),o([s()],Se.prototype,"lengthOptions",null),o([s(),pe("esri/t9n/common")],Se.prototype,"messagesCommon",void 0),Se=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],Se);const W="esri-responsive-toolbar",K={rulerBase:`${W}__ruler`,rulerBarHorizontal:`${W}__ruler--bar`,rulerBarVertical:`${W}__ruler--bar--vertical`,rulerPadVertical:`${W}__ruler--pad--vertical`,rulerPadHorizontal:`${W}__ruler--pad--horizontal`,bar:`${W}__bar`,barHorizontal:`${W}__bar--horizontal`,barVertical:`${W}__bar--vertical`,pad:`${W}__pad`,padVertical:`${W}__pad--vertical`,padHorizontal:`${W}__pad--horizontal`};let Z=class extends oe{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new he,this._managedWidgets=new Map}loadDependencies(){return ce({"action-bar":()=>import("./index-evaKQqC2.js")})}destroy(){this._measurementManager=Ie(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e=this.barStyle==="docked",t=this.layout==="vertical";return{[K.barHorizontal]:e&&!t,[K.barVertical]:e&&t,[K.bar]:e,[K.padHorizontal]:!e&&!t,[K.padVertical]:!e&&t,[K.pad]:!e}}render(){const{layout:e,scale:t,barStyle:i}=this,l={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},n=i==="docked"?e==="vertical"?K.rulerBarVertical:K.rulerBarHorizontal:e==="horizontal"?K.rulerPadHorizontal:K.rulerPadVertical;return p("div",null,p("div",{afterCreate:r=>{this._measurementManager?.connect(r)},class:this.classes(K.rulerBase,n)}),p("calcite-action-bar",{...l,classes:this._barClasses,floating:i!=="docked",overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(l=>l.properties?.key!==void 0&&"group-kind"in l.properties),t=new Set,i=e.map(l=>{const n=l.properties,r=n.key;t.add(r);const a=this.barStyle==="docked"?n.slot??void 0:void 0,c=n.priority??0,d=n["group-kind"]??"overflow-group",u=n["allow-collapse"]??!0,g=this._managedWidgets.get(r);if(g)return g.children=l.children,g.priority=c,"allowCollapse"in g&&(g.allowCollapse=u),g.slot=a,g.layout=this.layout,g.scale=this.scale,g.measurementManager=this._measurementManager,g;const w={scale:this.scale,priority:c,measurementManager:this._measurementManager,children:l.children,slot:a,layout:this.layout};switch(d){case"split-button":{const _=new Se({...w,allowCollapse:u});return this._managedWidgets.set(r,_),_}case"overflow-group":{const _=new Ce({...w,allowCollapse:u});return this._managedWidgets.set(r,_),_}case"measured-content":{const _=new Me({...w});return this._managedWidgets.set(r,_),_}}}).filter(ae);return Array.from(this._managedWidgets.keys()).filter(l=>!t.has(l)).forEach(l=>{this._managedWidgets.get(l)?.destroy(),this._managedWidgets.delete(l)}),this._measurementManager?.allocate(),i.map(l=>l.render())}};o([s()],Z.prototype,"scale",void 0),o([s({value:"horizontal"})],Z.prototype,"layout",null),o([s()],Z.prototype,"barStyle",void 0),o([s()],Z.prototype,"_measurementManager",void 0),o([s()],Z.prototype,"_managedWidgets",void 0),o([s()],Z.prototype,"_barClasses",null),Z=o([S("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],Z);async function go(e){const{returnFeatureTitleFields:t,returnGeometry:i,selector:l,signal:n,sources:r,view:a}=e;if(!r?.length)return[];const{layers:c,layerViews:d,graphicsLayers:u}=yo(r),g=[];return await $e(nt(Promise.all([bo({candidates:g,layers:c,returnFeatureTitleFields:t,returnGeometry:i,selector:l,signal:n,view:a}),mo({candidates:g,layerViews:d,returnGeometry:i,selector:l,signal:n,view:a}),To({candidates:g,graphicsLayers:u,selector:l})]),n)),g}function yo(e){const t=[],i=[],l=[];return e.forEach(n=>{di(n)||ci(n)||pi(n)?t.push(n):(kt(n)||Et(n))&&n.layers?.length?t.push(...n.layers.toArray()):hi(n)&&n.sublayers?.length?l.push(...n.sublayers.toArray()):ui(n)?l.push(n):qe(n)&&i.push(n)}),{layers:t,layerViews:i,graphicsLayers:l}}async function mo(e){const{candidates:t,layerViews:i,returnGeometry:l,selector:n,signal:r,view:a}=e;n.type!=="point"?await nt(Promise.allSettled(i.map(async c=>{const d=fo(c,n,a,l),u=await c.queryFeatures(d,{signal:r});Pt(t,u.features)})),r):await vo({candidates:t,layerViews:i,selector:n,view:a})}async function vo({candidates:e,layerViews:t,selector:i,view:l}){const n=l.toScreen(i);if(!n)return;const r=t.map(c=>c.layer),{results:a}=await l.hitTest(n,{include:r});a.forEach(c=>{"graphic"in c&&c.graphic&&e.push(c.graphic)})}async function bo(e){const{candidates:t,layers:i,returnFeatureTitleFields:l,returnGeometry:n,selector:r,signal:a,view:c}=e;await nt(Promise.allSettled(i.map(async d=>{if("isTable"in d&&d.isTable)return;const u=_o(d,r,c,l,n),g=await d.queryFeatures(u,{signal:a});Pt(t,g.features)})),a)}function qt(e,t,i){return e.type==="point"?ao(e,"renderer"in t?co({renderer:t.renderer}):0,i):e}function wo(e,t,i){const{fields:l,fieldsIndex:n}=e,r=new Set([e.objectIdField]);"globalIdField"in e&&e.globalIdField!=null&&n.has(e.globalIdField)&&r.add(n.get(e.globalIdField).name);const a="displayField"in e?e.displayField:null,c=gi({displayField:a,fields:l});if(c!=null&&n.has(c)&&r.add(c),"subtypeField"in e&&e.subtypeField!=null){const d=n.get(e.subtypeField)?.name;if(d!=null&&r.add(d),"utilityNetworks"in t.map&&t.map.utilityNetworks?.length){const u=n.get("assetgroup");u?.name&&r.add(u.name);const g=n.get("assettype");g?.name&&r.add(g.name)}}return(i||t.requiredFieldsOptions.featureTitleFields)&&"featureTitleFields"in e&&e.featureTitleFields&&e.featureTitleFields.forEach(d=>r.add(d)),Array.from(r.values())}function fo(e,t,i,l=!0){const n=e.createQuery();return n.outFields=["*"],n.geometry=qt(t,e.layer,i),n.returnGeometry=l,n.outSpatialReference=i.spatialReference,n}function _o(e,t,i,l=!1,n=!0){const r=e.createQuery();return r.outFields=wo(e,i,l),r.geometry=qt(t,e,i),r.returnGeometry=n,r.outSpatialReference=i.spatialReference,r}async function To(e){const{candidates:t,graphicsLayers:i,selector:l}=e,n=i.flatMap(a=>a.graphics.toArray())??[];if(!n?.length||!l)return;const r=await import("./intersectsOperator-PuciiMOI.js").then(a=>a.i);r.accelerateGeometry(l),n.forEach(a=>{a.geometry&&a.geometry.type!=="mesh"&&r.execute(l,a.geometry)&&t.push(a)})}const Mo=100;let O=class extends rt.EventedAccessor{constructor(e){super(e),this._completed=!1,this._isConstraintKeyDown=!1,this._processTask=null,this.createTool="rectangle",this.mode=null,this.persistSelection=!0,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selection=new te,this.selectionManager=null,this.selectOnComplete=!0,this.sources=null,this.toolName="",this.type="add",this._process=yi(async(t,i)=>{const{callback:l,selector:n,completed:r}=t,a=Ht(async c=>{const{effectiveSelectionManager:d,returnFeatureTitleFields:u,returnGeometry:g,selection:w,sources:_,view:E}=this;if(!(!_?.length&&!d.sources.length)&&E){if(n&&_!=null){const me=await go({returnFeatureTitleFields:u,returnGeometry:g,selector:n,signal:c,sources:_,view:E});if(w.removeAll(),w.addMany(me),r&&this.persistSelection)switch(this.effectiveType){case"remove":d.updateSelection({current:[],added:[],removed:me});break;case"replace":d.clear(),d.updateSelection({current:me,added:[],removed:[]});break;default:d.updateSelection({current:me,added:[],removed:[]})}}l&&l()}else w.removeAll()});return mi(i,()=>a.abort()),this._processTask=a,a.promise},Mo),this._onOperationFinish=this._onOperationFinish.bind(this)}initialize(){this._setup()}get _defaultMode(){return this.createTool==="polygon"?"click":"hybrid"}get _selectionArea(){const e=this._tool.coordinates;if(e.length===0)return;const t=fi(),i=this.view.spatialReference,l=r=>{t.x=r[0],t.y=r[1];const a=this.view.toMap(t);return[a?.x??0,a?.y??0]};if(e.length===1||e.every(([r,a])=>r===e[0][0]&&a===e[0][1])){const[r,a]=l(e[0]);return new ze({x:r,y:a,spatialReference:i})}const n=e.map(l);if(n.length!==0)return vi(n)||n.reverse(),new ie({spatialReference:i,rings:[n]})}get completed(){return this._completed}get effectiveSelectionManager(){return this.selectionManager??this.view.selectionManager}get effectiveType(){const e=this.type??"add";if(this._isConstraintKeyDown)switch(e){case"add":return"remove";case"remove":case"replace":return"add";default:return e}return e}get processingFinalSelection(){return!(!this._processTask||!this._tool?.drawOperation?.isCompleted)}cancel(){this.selection.removeAll(),this._onOperationFinish(!0)}destroy(){this._toolImportController=bi(this._toolImportController)}async _setup(){const{createTool:e,view:t}=this;if(await t.whenReady(),this.destroyed||this._toolImportController)return;const i=new AbortController;this._toolImportController=i;const[l,n]=await Promise.all([import("./DrawScreenTool-B9C2OOzL.js"),io()]);if(i.signal.aborted)return;const r=Symbol();try{this._tool=new l.DrawScreenTool({view:t,mode:this.mode??this._defaultMode,geometryType:e,cursor:e==="point"?"default":"crosshair",automaticLengthMeasurementUtils:n})}finally{this._toolImportController=null}this._tool?(this.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>{this._syncConstraintKeyDown(),$e(this._process({selector:this._selectionArea}))}),r),this.addHandles([t.on("key-down",a=>{if(!a.repeat)switch(a.key){case je.constraint:this._tool.uniformSizeToggled=!0,a.stopPropagation();break;case je.center:this._tool.centeredToggled=!0,a.stopPropagation()}}),t.on("key-up",a=>{switch(a.key){case je.constraint:this._tool.uniformSizeToggled=!1,a.stopPropagation();break;case je.center:this._tool.centeredToggled=!1,a.stopPropagation()}}),this.selection.on("change",({added:a,removed:c})=>this.emit("selection-change",{operationType:this.effectiveType,added:a,removed:c})),this._tool.on("complete",async a=>{this._syncConstraintKeyDown(),this.removeHandles(r),a.aborted?this.cancel():(this._tool.cursor="progress",await this._process({selector:this._selectionArea,callback:this._onOperationFinish,completed:!0}))})],r),this.addHandles(wi(()=>t.tools.remove(this._tool))),t.addAndActivateTool(this._tool)):de.getLogger(this).warn("Unable to import Draw module. SelectionOperation failed to load.")}_syncConstraintKeyDown(){const{inputManager:e}=this.view;this._isConstraintKeyDown=ro.invertType.some(t=>e.isModifierKeyDown(t))}_onOperationFinish(e=!1){this.removeAllHandles(),this._processTask?.abort(),this.emit("complete",{aborted:e,operationType:this.effectiveType,selection:this.selection.toArray(),toolName:this.toolName}),this._completed=!0}};o([s()],O.prototype,"_completed",void 0),o([s()],O.prototype,"_defaultMode",null),o([s()],O.prototype,"_isConstraintKeyDown",void 0),o([s()],O.prototype,"_processTask",void 0),o([s()],O.prototype,"_selectionArea",null),o([s()],O.prototype,"completed",null),o([s({constructOnly:!0})],O.prototype,"createTool",void 0),o([s()],O.prototype,"effectiveSelectionManager",null),o([s()],O.prototype,"effectiveType",null),o([s({constructOnly:!0})],O.prototype,"mode",void 0),o([s()],O.prototype,"persistSelection",void 0),o([s()],O.prototype,"processingFinalSelection",null),o([s()],O.prototype,"returnFeatureTitleFields",void 0),o([s()],O.prototype,"returnGeometry",void 0),o([s({readOnly:!0})],O.prototype,"selection",void 0),o([s({constructOnly:!0})],O.prototype,"selectionManager",void 0),o([s({constructOnly:!0})],O.prototype,"selectOnComplete",void 0),o([s()],O.prototype,"sources",void 0),o([s({constructOnly:!0})],O.prototype,"toolName",void 0),o([s({constructOnly:!0})],O.prototype,"type",void 0),o([s({constructOnly:!0})],O.prototype,"view",void 0),O=o([S("esri.widgets.support.Selector2D.SelectionOperation")],O);const Co=O;let k=class extends rt.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([M(()=>this.effectiveSources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=Ge(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this,l=t??this.effectiveSelectionManager?.sources;if(!l?.length)return[];const n=[];return l.forEach(r=>{if(qe(r))n.push(r);else if(kt(r)||Et(r))(r.layers||[]).forEach(a=>{const c=i?Gt(i,a):void 0,d=e&&qe(c)?c:a;n.push(d)});else if(e){const a=i?Gt(i,r):void 0,c=qe(a)?a:r;n.push(c)}else n.push(r)}),n}get layers(){return Ue(de.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){Ue(de.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,i=e?.view||this.view,l=e?.sources||this.effectiveSources;if(t==="disabled"||!i)return void de.getLogger(this).warn("Unable to start selection operation.");t==="active"&&this.cancel();const n=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",n),n.defaultPrevented)return;const r={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:l,view:i},a=new Co({...r});return this._operationHandlesGroup=at([a.on("selection-change",c=>this.emit("selection-change",c)),a.once("complete",c=>this._onOperationComplete(c,r))]),this._set("activeOperation",a),a}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);de.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const i=t.toolName;if(this.cancel(),i===e)return}return this.activateTool(e)}_onOperationComplete(e,t){this._operationHandlesGroup=Ge(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate(t)}_getToolOptions(e){return this.toolConfigs.find(t=>t.toolName===e)||(e==="lasso"?this.defaultLassoToolOptions:e==="point"?this.defaultPointToolOptions:e==="rectangle"?this.defaultRectangleToolOptions:void 0)}};o([s({readOnly:!0})],k.prototype,"activeOperation",void 0),o([s()],k.prototype,"continuousSelectionEnabled",void 0),o([s()],k.prototype,"defaultLassoToolOptions",void 0),o([s()],k.prototype,"defaultOperationType",void 0),o([s()],k.prototype,"defaultPointToolOptions",void 0),o([s()],k.prototype,"defaultRectangleToolOptions",void 0),o([s()],k.prototype,"effectiveSelectionManager",null),o([s()],k.prototype,"effectiveSources",null),o([s()],k.prototype,"layers",null),o([s()],k.prototype,"layerViewPreferenceEnabled",void 0),o([s()],k.prototype,"persistSelection",void 0),o([s()],k.prototype,"selectionManager",void 0),o([s()],k.prototype,"returnFeatureTitleFields",void 0),o([s()],k.prototype,"returnGeometry",void 0),o([s()],k.prototype,"selectOnComplete",void 0),o([s()],k.prototype,"sources",void 0),o([s({readOnly:!0})],k.prototype,"state",null),o([s()],k.prototype,"toolConfigs",void 0),o([s()],k.prototype,"view",void 0),k=o([S("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],k);const So=k;let ue=class extends Y{constructor(e){super(e),this.chip=!0,this.lassoTool=!0,this.pan=!0,this.pointTool=!0,this.rectangleTool=!0}};o([s({type:Boolean,nonNullable:!0})],ue.prototype,"chip",void 0),o([s({type:Boolean,nonNullable:!0})],ue.prototype,"lassoTool",void 0),o([s({type:Boolean,nonNullable:!0})],ue.prototype,"pan",void 0),o([s({type:Boolean,nonNullable:!0})],ue.prototype,"pointTool",void 0),o([s({type:Boolean,nonNullable:!0})],ue.prototype,"rectangleTool",void 0),ue=o([S("esri.widgets.support.SelectionToolbar.VisibleElements")],ue);const gt=ue,yt="esri-selection-toolbar",mt={base:yt,container:`${yt}__container`,toolButton:`${yt}__tool-button`};let f=class extends oe{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.disabled=!1,this.layout="horizontal",this.messages=null,this.scale="s",this.viewModel=new So,this.visibleElements=new gt}initialize(){this._viewModelHandlesGroup=at([dt(()=>this.viewModel,"before-activate",e=>this.emit("before-activate",e)),dt(()=>this.viewModel,"complete",e=>this.emit("complete",e)),dt(()=>this.viewModel,"selection-change",e=>this.emit("selection-change",e))])}destroy(){this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup)}loadDependencies(){return ce({action:()=>import("./index-1Ra4Eoox.js"),"action-bar":()=>import("./index-evaKQqC2.js"),chip:()=>import("./index-DdFYN-gK.js")})}get _effectiveDisabled(){return this.disabled||this.state==="disabled"}get activeOperation(){return this.viewModel.activeOperation}get continuousSelectionEnabled(){return this.viewModel.continuousSelectionEnabled}set continuousSelectionEnabled(e){this.viewModel.continuousSelectionEnabled=e}get defaultLassoToolOptions(){return this.viewModel.defaultLassoToolOptions}set defaultLassoToolOptions(e){this.viewModel.defaultLassoToolOptions=e}get defaultOperationType(){return this.viewModel.defaultOperationType}set defaultOperationType(e){this.viewModel.defaultOperationType=e}get defaultPointToolOptions(){return this.viewModel.defaultPointToolOptions}set defaultPointToolOptions(e){this.viewModel.defaultPointToolOptions=e}get defaultRectangleToolOptions(){return this.viewModel.defaultRectangleToolOptions}set defaultRectangleToolOptions(e){this.viewModel.defaultRectangleToolOptions=e}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get effectiveSources(){return this.viewModel.effectiveSources}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return Ue(de.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){Ue(de.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get persistSelection(){return this.viewModel.persistSelection}set persistSelection(e){this.viewModel.persistSelection=e}get returnFeatureTitleFields(){return this.viewModel.returnFeatureTitleFields}set returnFeatureTitleFields(e){this.viewModel.returnFeatureTitleFields=e}get returnGeometry(){return this.viewModel.returnGeometry}set returnGeometry(e){this.viewModel.returnGeometry=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get toolConfigs(){return this.viewModel.toolConfigs}set toolConfigs(e){this.viewModel.toolConfigs=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleToolCount(){const{visibleElements:e}=this;return this.toolConfigs.length+(e.lassoTool?1:0)+(e.rectangleTool?1:0)}activate(e){if(this.cancel(),!this._effectiveDisabled)return this.viewModel.activate(e)}activateTool(e){if(!this._effectiveDisabled)return this.viewModel.activateTool(e)}cancel(){this.viewModel.cancel()}toggleTool(e){if(!this._effectiveDisabled)return this.viewModel.toggleTool(e)}render(){return p("div",{"aria-label":this.label,class:this.classes(mt.base,pt.widget)},p("div",{class:mt.container},p("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",scale:this.scale},this._renderDefaultTools(),this._renderCustomTools(),this._renderChip())))}_renderDefaultTools(){return[this._renderPanAction(),this._renderPointTool(),this._renderRectangleTool(),this._renderLassoTool()]}_renderPanAction(){if(!this.visibleElements.pan)return;const e=this.messages.pan,t=`${this.id}-tool-pan`;return this._renderAction({active:!this.activeOperation,disabled:this._effectiveDisabled,icon:"pan",id:t,key:t,onclick:()=>this.cancel(),text:e,title:e})}_renderChip(){if(!this.visibleElements.chip)return;const{effectiveSelectionManager:e}=this,t=e?.count??0,i=to(t);return p("calcite-chip",{appearance:"outline",closable:t>0,closed:t===0,disabled:this._effectiveDisabled||t===0,label:i,scale:this.scale,slot:"actions-end",title:this.messages.clearSelection,onCalciteChipClose:()=>e?.clear()},i)}_renderCustomTools(){return this.toolConfigs.map(({toolName:e,icon:t})=>this._renderToolWithTooltip(e,t))}_renderPointTool(){if(this.visibleElements.pointTool)return this._renderToolWithTooltip("point","selection-set",this.messages.selectByPoint)}_renderLassoTool(){if(this.visibleElements.lassoTool)return this._renderToolWithTooltip("lasso","lasso-select",this.messages.selectByLasso)}_renderRectangleTool(){if(this.visibleElements.rectangleTool)return this._renderToolWithTooltip("rectangle","cursor-marquee",this.messages.selectByRectangle)}_renderToolWithTooltip(e,t,i=e){const l=`${this.id}-tool-${e}`;return this._renderAction({active:this.activeOperation?.toolName===e,disabled:this._effectiveDisabled,icon:t||"selection",id:l,key:l,onclick:()=>this.toggleTool(e),text:i,title:i})}_renderAction(e){return p("calcite-action",{...e,bind:this,class:mt.toolButton,scale:this.scale})}};o([s()],f.prototype,"_effectiveDisabled",null),o([s()],f.prototype,"activeOperation",null),o([s()],f.prototype,"continuousSelectionEnabled",null),o([s()],f.prototype,"defaultLassoToolOptions",null),o([s()],f.prototype,"defaultOperationType",null),o([s()],f.prototype,"defaultPointToolOptions",null),o([s()],f.prototype,"defaultRectangleToolOptions",null),o([s()],f.prototype,"disabled",void 0),o([s()],f.prototype,"effectiveSelectionManager",null),o([s()],f.prototype,"effectiveSources",null),o([s()],f.prototype,"label",null),o([s()],f.prototype,"layers",null),o([s()],f.prototype,"layerViewPreferenceEnabled",null),o([s()],f.prototype,"layout",void 0),o([s(),pe("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],f.prototype,"messages",void 0),o([s()],f.prototype,"persistSelection",null),o([s()],f.prototype,"returnFeatureTitleFields",null),o([s()],f.prototype,"returnGeometry",null),o([s()],f.prototype,"selectOnComplete",null),o([s()],f.prototype,"scale",void 0),o([s()],f.prototype,"selectionManager",null),o([s()],f.prototype,"state",null),o([s()],f.prototype,"sources",null),o([s()],f.prototype,"toolConfigs",null),o([s()],f.prototype,"view",null),o([s()],f.prototype,"viewModel",void 0),o([s({type:gt,nonNullable:!0})],f.prototype,"visibleElements",void 0),o([s()],f.prototype,"visibleToolCount",null),f=o([S("esri.widgets.support.SelectionToolbar")],f);const Lo=f,Qt={absolute:"absolute-direction",relative:"relative-direction"},vt=()=>ce({icon:()=>import("./index-DlXwlCuZ.js").then(e=>e.i),label:()=>import("./index-D5U5VDiq.js"),switch:()=>import("./index-zLZP-u0_.js"),tooltip:()=>import("./index-cY5kLhaO.js")}),Ve="esri-labeled-switch",Ne={label:`${Ve}__label`,labelContent:`${Ve}__label-content`,iconInfo:`${Ve}__icon_info`,iconWarning:`${Ve}__icon_warning`,tooltip:`${Ve}__tooltip`};function Le({checked:e,disabled:t,hint:i,key:l,label:n,onChange:r,hintIcon:a,hintKind:c}){return p("calcite-label",{class:Ne.label,disabled:t,key:l,layout:"inline-space-between",scale:"s"},i?p("div",{class:Ne.labelContent,key:"label-content"},p("div",null,n),p("calcite-icon",{class:c!=="warning"?Ne.iconInfo:Ne.iconWarning,icon:a??"information",id:l,onclick:d=>d.stopPropagation(),onpointerdown:d=>{d.preventDefault(),d.stopPropagation();const u=d.target.nextElementSibling;u.open=!u.open},scale:"s",tabIndex:0}),p("calcite-tooltip",{class:Ne.tooltip,overlayPositioning:"fixed",referenceElement:l},i)):n,p("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:d=>r(d.currentTarget.checked)}))}let Oe=class extends Y{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};o([s({type:Boolean,nonNullable:!0})],Oe.prototype,"directionModePicker",void 0),o([s({type:Boolean,nonNullable:!0})],Oe.prototype,"header",void 0),o([s({type:Boolean,nonNullable:!0})],Oe.prototype,"labelsToggle",void 0),o([s({type:Boolean,nonNullable:!0})],Oe.prototype,"tooltipsToggle",void 0),Oe=o([S("esri.widgets.support.SketchTooltipControls.VisibleElements")],Oe);const bt=Oe,Ye="esri-sketch-tooltip-controls",Ze={base:Ye,block:`${Ye}__block`,blockContent:`${Ye}__block-content`,radioButtonLabelWrapper:`${Ye}__radio-button-label-wrapper`};let ge=class extends oe{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new bt,this.sketchOptions=new Bt,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([ce({block:()=>import("./index-CogojyRp.js"),label:()=>import("./index-D5U5VDiq.js"),icon:()=>import("./index-DlXwlCuZ.js").then(e=>e.i),"radio-button":()=>import("./index-DVPxuXsN.js"),"radio-button-group":()=>import("./index-B6n7toe1.js")}),vt()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return p("div",{"aria-label":e,class:this.classes(Ze.base,pt.widget)},i?p("calcite-block",{class:Ze.block,expanded:!0,heading:t.header?this.label:"",key:"content-block",label:this.label},p("div",{class:Ze.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(ae);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return p(Le,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return p(Le,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return p("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,p("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return p("calcite-label",{key:e,layout:"inline",scale:"s"},p("calcite-radio-button",{checked:e===t,scale:"s",value:e}),p("div",{class:Ze.radioButtonLabelWrapper,key:"label-wrapper"},p("calcite-icon",{icon:Qt[e],scale:"s"}),i))}};o([s()],ge.prototype,"label",null),o([s({type:bt,nonNullable:!0})],ge.prototype,"visibleElements",void 0),o([s(),pe("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],ge.prototype,"messages",void 0),o([s({nonNullable:!0,type:Bt})],ge.prototype,"sketchOptions",void 0),o([s({type:String})],ge.prototype,"viewType",void 0),ge=o([S("esri.widgets.support.SketchTooltipControls")],ge);const Oo=ge,ko={hide:"hide"};function Je(e){return e?.listMode??void 0}function Eo(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function Po(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function Io(e){if(!e)return"inherited";const t=Do(Jt(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function Yt(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function wt(e){return Je(e)!==ko.hide}function Ao(e,t){if(!e||t==null||isNaN(t))return!1;const i=Eo(e),l=Po(e),n=i!=null&&!isNaN(i)&&i>0&&t>i,r=l!=null&&!isNaN(l)&&l>0&&t<l;return n||r}function Zt(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function Jt(e){return e!=null&&"layer"in e&&e.layer!=null}function Do(e){const t=xo(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function xo(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}let G=class extends It.IdentifiableMixin(oe){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([M(()=>this._canCreateLegend,()=>this._createLegend(),$),M(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),$)])}destroy(){this._legend=Ie(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e?.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||e.type==="subtype-sublayer")return null;const t=Jt(e)?e:null,i=e?.parent,l=i!=null&&"type"in i&&i.type==="map-image"?t?.source:null,n="";return l&&i?{layer:i,title:n,sublayerIds:[l.mapLayerId]}:{layer:e,title:n}}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!t.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return p("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:l}=this;return e&&!i&&l?e==="legend"&&t?p("div",{key:"legend-widget"},t.render()):typeof e=="string"?p("div",{innerHTML:e,key:e}):zt(e)?p("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?p("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e):null}async _createLegend(){if(Ie(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await import("./Legend-BJhkL1A5.js"),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:zt(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};o([s()],G.prototype,"_legend",void 0),o([s()],G.prototype,"_canCreateLegend",null),o([s()],G.prototype,"_legendOptions",null),o([s()],G.prototype,"_legendLayerInfo",null),o([s()],G.prototype,"content",void 0),o([s()],G.prototype,"disabled",null),o([s()],G.prototype,"flowEnabled",void 0),o([s()],G.prototype,"icon",null),o([s()],G.prototype,"image",void 0),o([s()],G.prototype,"listItem",void 0),o([s()],G.prototype,"open",void 0),o([s()],G.prototype,"title",null),o([s()],G.prototype,"visible",void 0),G=o([S("esri.widgets.LayerList.ListItemPanel")],G);const Xt=G;var He;const Ro=te.ofType({key:"type",defaultKeyValue:"button",base:Mi,typeMap:{button:Ti,toggle:_i}}),ei=te.ofType(Ro),ft="layer",Xe="child-list-mode",Go="hide";let T=He=class extends It.IdentifiableMixin(Y){constructor(e){super(e),this.actionsSections=new ei,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(te.ofType(He)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.parent=null,this.view=null}initialize(){if(this.addHandles([M(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),$),M(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),$),M(()=>this.view,e=>this._updateChildrenView(e),$),M(()=>this.panel,e=>this._setListItemOnPanel(e),$)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){const{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;const i=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(l=>l.layer===i)??null}set panel(e){const t=this._get("panel");e!==t&&e&&t?.destroy(),this._set("panel",e)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new Xt(e):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=We(this,"layer.layer");return(!e||e&&We(this,"layer.layer.loaded"))&&We(this,"layer.title")||We(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&e.publishingInfo?.status==="publishing")}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:l}=this;return!l&&!t&&(e?e.updating:i?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!Ao(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return Io(this.layer)}clone(){return new He({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_createChildren(e){const{listModeDisabled:t,children:i}=this,l=e.filter(n=>!i.some(r=>r.layer===n));i.addMany(this._createChildItems(l,t))}_destroyChildren(e){const{children:t}=this,i=t.filter(l=>!!l.layer&&!e.includes(l.layer));t.destroyMany(i)}_sortChildren(e){this.children.sort((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(Xe),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(Xe),this.listModeDisabled||this.addHandles(e.toArray().map(t=>M(()=>t.listMode,()=>this._compileChildren(e))),Xe)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(i=>Je(i)!==Go);e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),ft)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(i=>t||wt(i)?new He({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(ae)}_watchLayerProperties(e){if(this.removeHandles(ft),this.removeHandles(Xe),!e)return;if((!this.listModeDisabled&&Je(e))==="hide-children")return void this.children.destroyAll();const t=Yt(e);t&&this.addHandles(M(()=>e[t],i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)},$),ft)}};o([s({type:ei})],T.prototype,"actionsSections",void 0),o([s()],T.prototype,"actionsOpen",void 0),o([s()],T.prototype,"checkPublishStatusEnabled",void 0),o([s({type:te.ofType(T)})],T.prototype,"children",void 0),o([s()],T.prototype,"childrenSortable",void 0),o([s({readOnly:!0})],T.prototype,"connectionStatus",null),o([s({readOnly:!0})],T.prototype,"error",null),o([s()],T.prototype,"hidden",void 0),o([s({readOnly:!0})],T.prototype,"incompatible",null),o([s()],T.prototype,"layer",void 0),o([s({readOnly:!0})],T.prototype,"layerView",null),o([s()],T.prototype,"listItemCreatedFunction",void 0),o([s({nonNullable:!0})],T.prototype,"listModeDisabled",void 0),o([s()],T.prototype,"open",void 0),o([s({type:Xt})],T.prototype,"panel",null),o([Ci("panel")],T.prototype,"castPanel",null),o([s()],T.prototype,"parent",void 0),o([s({value:!0})],T.prototype,"sortable",null),o([s()],T.prototype,"title",null),o([s({readOnly:!0})],T.prototype,"publishing",null),o([s({readOnly:!0})],T.prototype,"updating",null),o([s()],T.prototype,"view",void 0),o([s()],T.prototype,"visible",null),o([s({readOnly:!0})],T.prototype,"visibleAtCurrentScale",null),o([s({readOnly:!0})],T.prototype,"visibleAtCurrentTimeExtent",null),o([s({readOnly:!0})],T.prototype,"visibilityMode",null),T=He=o([S("esri.widgets.LayerList.ListItem")],T);const _t=T,j={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},Bo="hide",ti=te.ofType(_t);let J=class extends rt.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new ti,this.view=null}initialize(){this.addHandles([M(()=>this.view?.ready===!0,()=>this._viewHandles(),$),M(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),M(()=>$t(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],j.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,l){const n=e?.layer;if(!n||n.type==="subtype-sublayer"||n.type==="sublayer")return;const r=this.view?.map?.layers,a=t?Zt(t):r,c=i?Zt(i):r;if(!a||!c)return;const{operationalItems:d}=this,u=t?.children||d,g=i?.children||d,w=c.length-l;e.parent=i||null,u.remove(e),a.remove(n),g.includes(e)||g.add(e,w),c.includes(n)||c.add(n,w),this._compileList()}_createLayerViewHandles(e){this.removeHandles(j.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),j.layerViews)}_createMapLayerHandles(e){this.removeHandles(j.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),j.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:l,listModeDisabled:n}=this;return new _t({checkPublishStatusEnabled:l,listModeDisabled:n,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>Je(t)!==Bo):void 0}_watchLayersListMode(e){this.removeHandles(j.layerListMode),e&&!this.listModeDisabled&&this.addHandles(M(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),j.layerListMode)}_compileList(){const e=this.view?.map?.layers,t=$t(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:l})=>l==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(l=>l.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(l=>{l&&e&&e.includes(l.layer)||i.push(l)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,l)=>{const n=e.indexOf(i.layer),r=e.indexOf(l.layer);return n>r?-1:n<r?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([j.mapLayers,j.layerViews,j.viewLayers]),e?.ready?this.addHandles([M(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),$),M(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),$)],j.viewLayers):this._removeAllItems()}};o([s()],J.prototype,"checkPublishStatusEnabled",void 0),o([s()],J.prototype,"listItemCreatedFunction",void 0),o([s({nonNullable:!0})],J.prototype,"listModeDisabled",void 0),o([s({type:ti})],J.prototype,"operationalItems",void 0),o([s({readOnly:!0})],J.prototype,"state",null),o([s()],J.prototype,"totalItems",null),o([s()],J.prototype,"view",void 0),J=o([S("esri.widgets.LayerList.LayerListViewModel")],J);const Fo=J,Tt=e=>Vo(e)||No(e),Vo=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},No=e=>{const t=Yt(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(const i of e[t])if(Tt(i))return!0}return!1},et=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(i=>et(i,t)!==!1)&&"children");var Mt;let se=Mt=class extends _t{constructor(e){super(e),this.children=new te,this.parent=null}get enabled(){const{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const l of e){if(l.enabled==="indeterminate")return l.enabled;if(l.enabled==="enabled"?t=!0:l.enabled==="disabled"&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(i=>i.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(Tt);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>wt(t)?new Mt({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(ae).reverse()}};o([s()],se.prototype,"enabled",null),o([s()],se.prototype,"children",void 0),o([s()],se.prototype,"childLayerIds",null),o([s()],se.prototype,"featureSource",null),o([s({constructOnly:!0})],se.prototype,"getFeatureSnappingSources",void 0),o([s()],se.prototype,"parent",void 0),se=Mt=o([S("esri.widgets.support.SnappingControls.SnappingListItem")],se);let ke=class extends Fo{constructor(){super(...arguments),this.featureSnappingSources=new te}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(Tt);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new se({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};o([s()],ke.prototype,"featureSnappingSources",void 0),o([s()],ke.prototype,"operationalItems",void 0),o([s()],ke.prototype,"operationalItemsFlat",null),o([s()],ke.prototype,"selectableItems",null),ke=o([S("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],ke);let X=class extends Y{constructor(e){super(e),this.layerListViewModel=new ke,this.snappingOptions=new Ft,this.view=null}initialize(){this.addHandles([M(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},$),M(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},$)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(i=>t?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const i=t?.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)wt(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(l=>l.layer?.id===e)?.layer;if(!t)throw new Si("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;const i=new oo({layer:t});return this.snappingOptions.featureSources.add(i),i}};o([s()],X.prototype,"allLayersEnabled",null),o([s()],X.prototype,"allLayersDisabled",null),o([s({constructOnly:!0})],X.prototype,"layerListViewModel",void 0),o([s()],X.prototype,"layersEnabledCount",null),o([s({type:Ft,nonNullable:!0})],X.prototype,"snappingOptions",void 0),o([s()],X.prototype,"state",null),o([s()],X.prototype,"view",void 0),X=o([S("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],X);const Ho=X,ee="esri-snapping-controls",q={base:ee,container:`${ee}__container`,toggleBlock:`${ee}__toggle-block`,layerListBlock:`${ee}__layer-list-block`,layerList:`${ee}__layer-list`,layerListFilter:`${ee}__layer-list__filter`,layerListButton:`${ee}__layer-list__button`,layerListItem:`${ee}__layer-list__item`,layerListGroup:`${ee}__layer-list__group`,nestedContainer:`${ee}__nested-container`};let I=class extends oe{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new Qe,this._enableSnappingSwitchChange=r=>{this.snappingOptions.enabled=r},this._featureEnabledSwitchChange=r=>{this.snappingOptions.featureEnabled=r},this._gridEnabledSwitchChange=r=>{this.snappingOptions.gridEnabled=r,r&&this._startLoadGrid()},this._selfEnabledSwitchChange=r=>{this.snappingOptions.selfEnabled=r},this._onToggleLayersButtonClick=r=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),no(r.target)};const{snappingOptions:i,view:l,viewModel:n}=e;this.viewModel=n??(this._defaultViewModel=new Ho({snappingOptions:i,view:l}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:l,...n}=e;return n}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=Ie(this._defaultViewModel))}loadDependencies(){return Promise.all([ce({block:()=>import("./index-CogojyRp.js"),button:()=>import("./index-DEJaBjyi.js"),input:()=>import("./index-1fXGKsZs.js"),list:()=>import("./index-D6uwO-mx.js"),"list-item":()=>import("./index-Bsjh0Wxr.js"),checkbox:()=>import("./index-EfBiFTcY.js"),loader:()=>import("./index-ELi13q5Y.js")}),vt()])}initialize(){this.addHandles(M(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=Ie(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return p("div",{"aria-label":e,class:this.classes(q.base,pt.widget)},p("div",{class:q.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&t?.type==="2d"?this._renderGridEnabledToggle():null].filter(ae),l=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?p("div",{class:q.nestedContainer},i):null].filter(ae);return l.length===0?null:p("calcite-block",{class:q.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},l)}_renderEnabledToggle(){return p(Le,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return p(Le,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return p(Le,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return p(Le,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?p("calcite-input",{class:q.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:a}})=>{this._layerListFilter=a===""?null:new RegExp(a,"i")}}):null,l=this._secondaryElementsDisabled,n=this.layerListOpen&&!l,r=t.layerListViewModel.operationalItems?.find(a=>!!a.children.length);return p("calcite-block",{class:q.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:n,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:a=>this.layerListOpen=a.currentTarget.expanded},i,this._renderToggleLayersButton(),p("calcite-list",{class:q.layerList,displayMode:r?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:i,snappingOptions:l,_openAndReady:n}=this,{gridEnabled:r,enabled:a}=l;(n||e?.type==="2d"&&e.grid)&&this._startLoadGrid();const c=this._gridLoadTask?.value,d=c&&e?.type==="2d"&&p(c,{snappingManager:i,snappingOptions:l,view:e,visibleElements:t.gridControlsElements});return p("calcite-block",{class:q.layerListBlock,collapsible:!0,disabled:!r||!a,expanded:n,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},d??p("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=Ht(async()=>(await import("./GridControls-C0aRdNFa.js")).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(i=>{switch(t?et(i,t):null){case"children":{const l=i.children.filter(n=>et(n,t)!==!1);return this._renderLayerListItemGroup(i,l)}case"self":case null:return this._renderLayerListItemOrGroup(i);case!1:return et(i.parent,t)==="self"?this._renderLayerListItemOrGroup(i):null}}).toArray().filter(ae)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return p("calcite-button",{appearance:"transparent",class:q.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,l=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return p("calcite-list-item",{class:q.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:n=>{n.stopPropagation(),l()}},p("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:l}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:l,title:n}=e,r=n||i.untitledLayer,a=n&&n!==""?n:Li(),c=!!t?.length,d=t??l,u=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},g=d?.find(w=>!!w.children.length);return p("calcite-list-item",{class:q.layerListGroup,expanded:c,key:a,label:r,onCalciteListItemSelect:w=>{w.stopPropagation(),u()}},p("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:u}),p("calcite-list",{displayMode:g?"nested":"flat",label:i?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(d)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};o([s()],I.prototype,"_defaultViewModel",void 0),o([s()],I.prototype,"_layerListFilter",void 0),o([s()],I.prototype,"_gridLoadTask",void 0),o([s()],I.prototype,"_openAndReady",null),o([s()],I.prototype,"label",null),o([s({type:Boolean,nonNullable:!0})],I.prototype,"layerListOpen",void 0),o([s({type:Boolean,nonNullable:!0})],I.prototype,"gridOptionsOpen",void 0),o([s(),pe("esri/widgets/support/SnappingControls/t9n/SnappingControls")],I.prototype,"messages",void 0),o([s(),pe("esri/t9n/common")],I.prototype,"messagesCommon",void 0),o([s()],I.prototype,"snappingOptions",null),o([s()],I.prototype,"snappingManager",void 0),o([s()],I.prototype,"view",null),o([s()],I.prototype,"viewModel",null),o([s({type:Qe,nonNullable:!0})],I.prototype,"visibleElements",void 0),o([s()],I.prototype,"_enabledToggleDisabled",null),o([s()],I.prototype,"_secondaryElementsDisabled",null),I=o([S("esri.widgets.support.SnappingControls")],I);const $o=I,ye="esri-sketch",le={base:ye,vertical:`${ye}--vertical`,docked:`${ye}-bar`,floating:`${ye}-pad`,chipHorizontal:`${ye}__selection-count-chip--horizontal`,chipVertical:`${ye}__selection-count-chip--vertical`,chipVerticalSmall:`${ye}__selection-count-chip--vertical--s`,popoverWrapper:`${ye}__popover-wrapper`},zo={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let v=class extends oe{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new R,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new Vt({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=t?.type==="2d",l=new Lo({persistSelection:!1,visibleElements:new gt({chip:!1,pan:!1,pointTool:!1,lassoTool:i,rectangleTool:i}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([M(()=>this.viewModel,n=>{this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup),n&&(this._viewModelHandlesGroup=at([n.on("create",()=>this.scheduleRender()),n.on("update",()=>this.scheduleRender()),n.on("delete",r=>this.emit("delete",r)),n.on("undo",()=>this.scheduleRender()),n.on("redo",()=>this.scheduleRender()),M(()=>n.layer,r=>{this._selectionToolbar&&(this._selectionToolbar.sources=r?[r]:null)}),M(()=>n.view,r=>{this._selectionToolbar&&(this._selectionToolbar.view=r)}),M(()=>n.state,()=>this.notifyChange("state"))]))},At),Oi(()=>l.activeOperation,()=>this.viewModel.cancel()),l.on("complete",n=>this._onSelectionOperationComplete(n)),M(()=>{const{view:n,visibleElements:{selectionTools:r}}=this;return{lassoTool:n?.type!=="3d"&&!!r?.["lasso-selection"],rectangleTool:n?.type!=="3d"&&!!r?.["rectangle-selection"]}},n=>{Object.assign(l.visibleElements,n)},At)]),this._selectionToolbar=l}loadDependencies(){return ce({action:()=>import("./index-1Ra4Eoox.js"),chip:()=>import("./index-DdFYN-gK.js"),popover:()=>import("./index-HurW8npo.js").then(e=>e.i)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:l}=this.viewModel;return i==="polygon"&&l==="freehand"&&t?.includes("freehandPolygon")?"freehandPolygon":i==="polyline"&&l==="freehand"&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&Ie(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,l=e?.filter(n=>!!i.createTools?.[n]);return t?.type==="3d"?l?.filter(n=>n!=="multipoint"):l}create(e,t,i){const l=i?.createOptions??t;return this._activeCustomToolOptions=i,$e(this.viewModel.create(e,l))}update(e,t){return $e(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,l=this.customActions?.filter(n=>n.position==="selection-toolbar");return p("div",null,p("div",{classes:{[le.base]:!0,[le.floating]:e==="floating",[le.docked]:e==="docked",[le.vertical]:t==="vertical"}},p(Z,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??Fe.Low},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),l?.map(n=>this._renderToolbarItem(n))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:l,visibleElements:n}=this;if(!this._calcitePopoverReferenceElement)return;const r={directionModePicker:n.directionModePicker,labelsToggle:n.labelsToggle,tooltipsToggle:n.tooltipsToggle},a=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return p("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:a,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},p("div",{class:le.popoverWrapper},Object.values(r).includes(!0)?p(Oo,{sketchOptions:l.sketchOptions,viewType:i?.type,visibleElements:new bt(r)}):void 0,n.snappingControls&&i&&t?p($o,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:n.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e?.length?p(Z,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??Fe.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(l=>{l.position==="settings-before"?t.push(l):l.position==="settings-after"&&e.push(l)});const i=[...t.map(l=>this._renderToolbarItem(l)),this._renderSettingsMenuButton(),...e.map(l=>this._renderToolbarItem(l))].filter(ae);if(i.length)return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??Fe.Max,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=this.customActions?.filter(n=>n.position==="before-selection-set"),i=this.customActions?.filter(n=>n.position==="after-selection-set"),l=this.groupCollapsePriorities?.get("selectionSet")??Fe.High;return[p("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:l,slot:e},this._renderFeatureCountChip()),p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:l,slot:e},t?.map(n=>this._renderToolbarItem(n)),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map(n=>this._renderToolbarItem(n)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(i=>this._renderBuiltInCreateToolItem(i))??[],t=this.customToolOptions?.flatMap(i=>this._renderCustomToolItem(i))??[];return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??Fe.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:zo[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:l,updateGraphics:{length:n}}=this,r=Ut(t.selectedCount,{count:n}),a=i==="s"?99:999,c=n>a?Ut(t.selectedCountTruncated,{truncated:a}):n,d=i==="s"&&e==="vertical",u=d?`${l}-selection-chip-small`:`${l}-selection-chip`;return[d?p("span",{classes:{[le.chipVertical]:!0,[le.chipVerticalSmall]:this.scale==="s"},id:u,tabIndex:0,title:r},c):p("calcite-chip",{appearance:"outline",class:e==="horizontal"?le.chipHorizontal:le.chipVertical,id:u,kind:"brand",label:r,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?r:void 0},e==="vertical"?c:r)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:l,onclick:n,active:r,flipRTL:a,afterCreate:c,afterUpdate:d,afterRemoved:u}){const g=`${this.id}-${e}`;return[p("calcite-action",{active:r,afterCreate:c,afterRemoved:u,afterUpdate:d,bind:this,"data-testid":e,disabled:l||this.state==="disabled",icon:i,iconFlipRtl:a??!1,id:g,key:e,onclick:n,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),l=t?.style;if(!(t&&i&&l&&this.view?.container?.contains(t)))return;const n=this._calcitePopoverReferenceElement;if(!n)return;const{bottom:r,top:a}=n.getBoundingClientRect();if(this.layout==="horizontal"){const d=r<i.height/2;d!==(this._relativeLocation==="top")&&(this._relativeLocation=d?"top":"bottom"),d?(l?.setProperty("--sketch-view-height-offset",r-i.top+"px"),l?.setProperty("--sketch-view-margin-offset","30px")):(l?.setProperty("--sketch-view-height-offset",i.bottom-a+"px"),l?.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(l.setProperty("--sketch-view-height-offset","15px"),l.setProperty("--sketch-view-margin-offset","15px"));const c=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;l.setProperty("--sketch-popover-header-offset",`${c}px`)}catch(t){de.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,i){const l=this._activeCustomToolOptions;if(i||l){if(i?.toolKey===l?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const l=t.tool,n=i.length>1&&l==="reshape"?"transform":l;this.update(i,{...t,tool:n})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};o([s()],v.prototype,"_activeCustomToolOptions",void 0),o([s()],v.prototype,"activeTool",null),o([s({readOnly:!0})],v.prototype,"activeTooltip",null),o([s({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(i=>t.has(i))}})],v.prototype,"availableCreateTools",void 0),o([s({readOnly:!0})],v.prototype,"createGraphic",null),o([s()],v.prototype,"creationMode",null),o([s()],v.prototype,"customToolOptions",void 0),o([s()],v.prototype,"customActions",void 0),o([s()],v.prototype,"defaultCreateOptions",null),o([s()],v.prototype,"defaultUpdateOptions",null),o([s()],v.prototype,"icon",null),o([s()],v.prototype,"label",null),o([s()],v.prototype,"labelOptions",null),o([s()],v.prototype,"layer",null),o([s({type:["horizontal","vertical"],value:"horizontal"})],v.prototype,"layout",null),o([s({value:"m"})],v.prototype,"scale",null),o([s()],v.prototype,"toolbarKind",void 0),o([s()],v.prototype,"contextualToolLocation",void 0),o([s()],v.prototype,"groupCollapsePriorities",void 0),o([s()],v.prototype,"groupAllowCollapseOptions",void 0),o([s(),pe("esri/widgets/Sketch/t9n/Sketch")],v.prototype,"messages",void 0),o([s(),pe("esri/t9n/common")],v.prototype,"messagesCommon",void 0),o([s()],v.prototype,"snappingOptions",null),o([s()],v.prototype,"state",null),o([s()],v.prototype,"tooltipOptions",null),o([s({readOnly:!0})],v.prototype,"updateGraphics",null),o([s({type:so,nonNullable:!0})],v.prototype,"valueOptions",null),o([s()],v.prototype,"view",null),o([s({type:Vt}),po(["create","update","undo","redo"])],v.prototype,"viewModel",null),o([s({type:R,nonNullable:!0})],v.prototype,"visibleElements",void 0),o([s()],v.prototype,"_effectiveAvailableCreateTools",null),o([s()],v.prototype,"_defaultViewModel",void 0),o([s()],v.prototype,"_calcitePopoverReferenceElement",void 0),o([s()],v.prototype,"_relativeLocation",void 0),o([s()],v.prototype,"_popoverOpen",void 0),v=o([S("esri.widgets.Sketch")],v);const Uo=v,Wo=(e,t)=>i=>jo(i,e);class Ko extends Ei{#i=new Map;#e;#t;constructor(t,i){super(t,i),new Pi(t);const l=this,n=l.instance;let r=n.viewModel,a=n.visibleElements;const c=new Proxy(this.exports,{get(d,u,g){return u==="viewModel"?r:u==="visibleElements"?a:Reflect.get(d,u,g)}});if(l.#t=n,l.instance=c,l.exports=c,r){const d={component:t,get exports(){return l.instance.viewModel}};Ii(l).set("viewModel","viewModel"),t.addController(d),r=Ai(t,new WeakRef(d),Di(t)-1,r,l.#i)}l.instance.visibleElements&&(a=l.#o(n))}hostConnected(){this.instance=this.#t,super.hostConnected()}hostLoad(){this.#e=M(()=>this.component.el.view,t=>{const i=this.instance;!("view"in i)&&typeof i.viewModel=="object"?i.viewModel.view=t:i.view=t,!("map"in i)&&typeof i.viewModel=="object"?i.viewModel.map=t?.map:i.map=t?.map},{sync:!0,initial:!0})}hostUpdate(t){t.has("closed")&&(this.instance.visible=!this.component.closed)}hostLoaded(){const{el:t}=this.component;t.childElem??=document.createElement("div"),this.instance.container=t.childElem,this.component.closed!==void 0&&this.onLifecycle(()=>M(()=>this.instance.visible,i=>this.component.closed=!i,{initial:!0}))}#o(t){return new Proxy(t.visibleElements,{get:(i,l)=>{if(typeof l=="symbol"||l in Promise.prototype)return i[l];const n=[l],r=this.#s(n);return xi(this.component,a=>{const c=a;this.component[c]=!1;let d=t.visibleElements??{},u;for(const w of n.slice(0,-1))if(typeof d[w]=="object"&&d[w]!==null)d=d[w];else{u=!!d[w];break}u===void 0&&(u=!!(d[n.slice(-1)[0]]??!0));const g=c.startsWith("hide")||c.startsWith("show")?c.startsWith("hide"):u;this.onUpdate(w=>{if(w.has(c)){const _=this.component[c];this.#l(n,_,g)}})},r)}})}#s(t){const i=new Proxy({},{get:(l,n)=>{const r=Reflect.get(l,n);return typeof n=="symbol"||n in Promise.prototype?r:(t.push(n),i)}});return i}#l(t,i,l){let n=this.instance.visibleElements??{};for(const a of t.slice(0,-1))(typeof n[a]!="object"||n[a]===null)&&(n[a]={}),n=n[a];const r=!!(l?!i:i);n[t.at(-1)]=r}hostDestroy(){this.#e?.remove(),super.hostDestroy()}}const jo=ki(Ko),qo=Ri`@layer{arcgis-sketch{display:block}}`,Qo=Wo(Uo);class Yo extends Gi{constructor(){super(),this.widget=Qo(this),this.viewModel=this.widget.viewModel,this._defaultGraphicsLayer=null,this.activeTool=this.widget.activeTool,this.autoDestroyDisabled=!1,this.availableCreateTools=this.widget.availableCreateTools,this.createGraphic=this.widget.createGraphic,this.creationMode=this.widget.creationMode,this.defaultCreateOptions=this.widget.defaultCreateOptions,this.defaultGraphicsLayerDisabled=!1,this.defaultUpdateOptions=this.widget.defaultUpdateOptions,this.hideCreateToolsCircle=this.widget.visibleElements.createTools.circle,this.hideCreateToolsPoint=this.widget.visibleElements.createTools.point,this.hideCreateToolsPolygon=this.widget.visibleElements.createTools.polygon,this.hideCreateToolsPolyline=this.widget.visibleElements.createTools.polyline,this.hideCreateToolsRectangle=this.widget.visibleElements.createTools.rectangle,this.hideDuplicateButton=this.widget.visibleElements.duplicateButton,this.hideDeleteButton=this.widget.visibleElements.deleteButton,this.hideSelectionCountLabel=this.widget.visibleElements.selectionCountLabel,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSelectionToolsLassoSelection=this.widget.visibleElements.selectionTools["lasso-selection"],this.hideSelectionToolsRectangleSelection=this.widget.visibleElements.selectionTools["rectangle-selection"],this.hideSettingsMenu=this.widget.visibleElements.settingsMenu,this.hideSnappingControls=this.widget.visibleElements.snappingControls,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.hideUndoRedoMenu=this.widget.visibleElements.undoRedoMenu,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layer=this.widget.layer,this.layout=this.widget.layout,this.pointSymbol=this.viewModel.pointSymbol,this.polygonSymbol=this.viewModel.polygonSymbol,this.polylineSymbol=this.viewModel.polylineSymbol,this.position="bottom-left",this.scale=this.widget.scale,this.toolbarKind=this.widget.toolbarKind,this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.snappingOptions=this.widget.snappingOptions,this.state=this.widget.state,this.tooltipOptions=this.widget.tooltipOptions,this.updateGraphics=this.widget.updateGraphics,this.arcgisCreate=Be(()=>this.widget,"create"),this.arcgisDelete=Be(()=>this.widget,"delete"),this.arcgisPropertyChange=Bi()("state"),this.arcgisReady=Fi(),this.arcgisRedo=Be(()=>this.widget,"redo"),this.arcgisUndo=Be(()=>this.widget,"undo"),this.arcgisUpdate=Be(()=>this.widget,"update"),this.listen("arcgisReady",this._arcgisReadyHandler)}static{this.properties={activeTool:3,autoDestroyDisabled:5,availableCreateTools:0,createGraphic:0,creationMode:1,defaultCreateOptions:0,defaultGraphicsLayerDisabled:5,defaultUpdateOptions:0,hideCreateToolsCircle:5,hideCreateToolsPoint:5,hideCreateToolsPolygon:5,hideCreateToolsPolyline:5,hideCreateToolsRectangle:5,hideDuplicateButton:5,hideDeleteButton:5,hideSelectionCountLabel:5,hideLabelsToggle:5,hideSelectionToolsLassoSelection:5,hideSelectionToolsRectangleSelection:5,hideSettingsMenu:5,hideSnappingControls:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,hideUndoRedoMenu:5,icon:1,label:1,labelOptions:0,layer:0,layout:1,pointSymbol:0,polygonSymbol:0,polylineSymbol:0,position:1,referenceElement:1,scale:1,toolbarKind:1,showSnappingControlsElementsHeader:5,snappingOptions:0,state:3,tooltipOptions:0,updateGraphics:0}}static{this.shadowRootOptions=Vi}static{this.styles=qo}async cancel(){this.widget?.cancel()}async complete(){this.widget?.complete()}async create(t,i){await this.widget?.create(t,i)}async delete(){this.widget?.delete()}async destroy(){await this.manager.destroy()}async duplicate(){this.widget?.duplicate()}async redo(){this.widget?.redo()}async triggerUpdate(t,i){this.widget?.update(t,i)}async undo(){this.widget?.undo()}_arcgisReadyHandler(){this.defaultGraphicsLayerDisabled||(this._defaultGraphicsLayer=new eo({title:"Sketch Layer"}),this.widget.layer=this._defaultGraphicsLayer,this.el.view?.map?.add(this.widget.layer),this.manager.onLifecycle(()=>M(()=>this.el.view?.map,(t,i)=>{if(this.widget.layer!==this._defaultGraphicsLayer)return;const l=this._defaultGraphicsLayer;i?.allLayers.includes(l)&&i.allLayers.remove(l),t?.add(l)})),this.manager.onDestroy(()=>{this._defaultGraphicsLayer&&this.el.view?.map?.allLayers.includes(this._defaultGraphicsLayer)&&this.el.view?.map?.remove(this._defaultGraphicsLayer),this._defaultGraphicsLayer?.destroy(),this._defaultGraphicsLayer=null}))}}Ni("arcgis-sketch",Yo);const tt="RampDrawGraphicsLayer",Zo=Hi({__name:"draw",setup(e){const{t}=$i(),i=h=>t(h?`draw.${h}`:"draw.unknown"),l=Ki("iApi"),n=ct();let r=null;const a=zi("sketchEl");let c=null,d=null,u=null,g=null,w=!1,_=null,E=[];const me=Ui([]);let Ae=null;async function oi(){(await l.fixture.isLoaded("keyboardnav")).register("D",{name:{en:"Draw Tools",fr:"Outils de dessin"},activeHandler:h=>{n.setActiveTool(""),Ae=h},deactiveHandler:()=>{Ae=null,n.setActiveTool(null)},keys:[{key:"P",description:{en:"Draw a point",fr:"Dessine un point"},handler:()=>{n.setActiveTool("point")}},{key:"L",description:{en:"Draw a line",fr:"Dessine une ligne"},handler:()=>{n.setActiveTool("polyline")}},{key:"G",description:{en:"Draw a polygon",fr:"Dessine un polygone"},handler:()=>{n.setActiveTool("polygon")}},{key:"C",description:{en:"Draw a circle",fr:"Dessine un cercle"},handler:()=>{n.setActiveTool("circle")}},{key:"R",description:{en:"Draw a rectangle",fr:"Dessine un rectangle"},handler:()=>{n.setActiveTool("rectangle")}},{key:"E",description:{en:"Edit geometry",fr:"Mode \xE9dition"},handler:()=>{n.setActiveTool("edit")}}]})}const ne=h=>{if(g&&(d?.remove(g),g=null),!h)return;let b;switch(h.geometry?.type){case"point":case"multipoint":b=new Zi({color:[255,255,0,.8],size:16,outline:{color:[255,165,0,1],width:3}});break;case"polyline":b=new Rt({color:[255,255,0,.8],width:6});break;default:b=new Ke({color:[255,255,0,.3],outline:{color:[255,165,0,1],width:3}})}g=new fe({geometry:h.geometry,symbol:b}),d?.add(g)};Dt(()=>n.selectedGraphicId,(h,b)=>{if(!(!r||!d)){if(!h)r.cancel(),ne();else if(h!==b){const m=d.graphics.toArray().find(L=>L.attributes&&L.attributes.id===h);m&&(r.triggerUpdate([m]),ne(m))}}});const si=async()=>{if(!d||!r||n.activeTool!=="edit")return;await l.geo.map.viewPromise;const h=l.geo.map.esriView,b={x:h.width/2,y:h.height/2},m={x:b.x,y:b.y,width:20,height:20},L=(await h.hitTest(m)).results.filter(B=>!("graphic"in B)||B.graphic.layer!==d?!1:!!B.graphic.attributes?.id);L.length>0?(u=L[0].graphic,r.triggerUpdate([u]),u.attributes?.id&&n.selectGraphic(u.attributes.id),l.updateAlert(t("draw.graphic.selected",{type:i(u.attributes?.type)}))):(r.cancel(),u=null,n.clearSelection())},li=async()=>{if(!r||!n.activeTool)return;await l.geo.map.viewPromise;const h=l.geo.map.esriView,b={x:Math.floor(h.width/2),y:Math.floor(h.height/2)},m=h.toMap(b),L=h.extent,B=L.width,Q=L.height,re=Math.min(B,Q)/10;let F;switch(n.activeTool){case"point":F=new fe({geometry:new ze({x:m.x,y:m.y,spatialReference:h.spatialReference}),symbol:r.pointSymbol});break;case"polyline":F=new fe({geometry:new _e({paths:[[[m.x-re/2,m.y],[m.x+re/2,m.y]]],spatialReference:h.spatialReference}),symbol:r.polylineSymbol});break;case"polygon":case"rectangle":const y=re/2;F=new fe({geometry:new ie({rings:[[[m.x-y,m.y-y],[m.x+y,m.y-y],[m.x+y,m.y+y],[m.x-y,m.y+y],[m.x-y,m.y-y]]],spatialReference:h.spatialReference}),symbol:r.polygonSymbol||new Ke({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})});break;case"circle":const C=re/2,Ee=36,De=[];for(let ve=0;ve<=Ee;ve++){const Pe=ve/Ee*2*Math.PI,D=m.x+C*Math.cos(Pe),P=m.y+C*Math.sin(Pe);De.push([D,P])}F=new fe({geometry:new ie({rings:[De],spatialReference:h.spatialReference}),symbol:r.polygonSymbol||new Ke({color:[255,0,255,.3],outline:{color:[255,0,255,1],width:1}})});break;default:console.warn("Unknown tool type:",n.activeTool);return}if(F){const y=`graphic-${Date.now()}`;F.attributes={id:y,type:n.activeTool},d?.add(F),n.addGraphic({id:y,type:n.activeTool,geometry:F.geometry,attributes:F.attributes}),n.activeTool!=="point"&&(n.clearSelection(),n.setActiveTool(""),Ae?.reset(),r.cancel()),l.updateAlert(t("draw.graphic.created",{type:i(n.activeTool)}))}},Ct=h=>{const b=l.geo.map.esriView?.container;if(!(!document.activeElement||!b?.contains(document.activeElement)))switch(h.key){case"Enter":if(h.preventDefault(),n.activeTool&&n.activeTool!=="edit")if((n.activeTool==="polyline"||n.activeTool==="polygon")&&(w||E.length===0)){const L=l.geo.map.esriView,B={x:Math.floor(L.width/2),y:Math.floor(L.height/2)},Q=L.toMap(B);w?(E.push([Q.x,Q.y]),n.activeTool==="polyline"?_.geometry=new _e({paths:[E],spatialReference:L.spatialReference}):_.geometry=new ie({rings:[E],spatialReference:L.spatialReference}),l.updateAlert(t("draw.multiPoint.pointAdded",{type:i(n.activeTool),count:E.length}))):(w=!0,E=[[Q.x,Q.y]],n.activeTool==="polyline"?_=new fe({geometry:new _e({paths:[E],spatialReference:L.spatialReference}),symbol:r?.polylineSymbol||new Rt({color:[0,0,255,1],width:2})}):_=new fe({geometry:new ie({rings:[E],spatialReference:L.spatialReference}),symbol:r?.polygonSymbol||new Ke({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})}),_.attributes={id:`temp-graphic-${Date.now()}`,type:n.activeTool},d?.add(_),l.updateAlert(t("draw.multiPoint.started",{type:i(n.activeTool),count:1})))}else li();else si();break;case"Delete":case"Backspace":const m=l.geo.map.esriView;w&&E.length>1?(h.preventDefault(),E.pop(),n.activeTool==="polyline"?_.geometry=new _e({paths:[E],spatialReference:m.spatialReference}):_.geometry=new ie({rings:[E],spatialReference:m.spatialReference}),_.set("geometry",_?.geometry),l.updateAlert(t("draw.multiPoint.pointRemoved",{type:i(n.activeTool??void 0),count:E.length}))):w&&E.length===1?(h.preventDefault(),_&&d?.remove(_),_=null,E=[],w=!1,l.updateAlert(t("draw.multiPoint.canceled"))):u&&(h.preventDefault(),r?.delete(),d?.remove(u),typeof n.removeGraphic=="function"&&n.removeGraphic(u.attributes.id),u=null,ne(void 0),l.updateAlert(t("draw.graphic.deleted")));break;case"Escape":n.setActiveTool(null),r?.cancel(),u=null,ne(void 0),n.clearSelection(),l.updateAlert(t("draw.tool.canceled"));break}},St=h=>{const b=l.geo.map.esriView.container;if(!document.activeElement||!b?.contains(document.activeElement)||!u||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key))return;h.preventDefault(),h.stopPropagation();const m=10,L=h.shiftKey,B=h.altKey,Q=l.geo.map.esriView;let re=0,F=0;h.key==="ArrowLeft"&&(re=-m),h.key==="ArrowRight"&&(re=m),h.key==="ArrowUp"&&(F=-m),h.key==="ArrowDown"&&(F=m);const y=u.geometry;let C;if(y.type==="point")C={x:y.x,y:y.y};else{const P=y.extent;C={x:(P.xmin+P.xmax)/2,y:(P.ymin+P.ymax)/2}}const Ee=Q.toScreen(new ze({x:C.x,y:C.y,spatialReference:Q.spatialReference}));Ee.x+=re,Ee.y+=F;const De=Q.toMap(Ee),ve=De.x-C.x,Pe=De.y-C.y;let D;if(y.type==="point")!L&&!B?D=new ze({x:y.x+ve,y:y.y+Pe,spatialReference:y.spatialReference}):L?(D=y.clone(),l.updateAlert(t("draw.point.resize.unsupported"))):B&&(D=y.clone(),l.updateAlert(t("draw.point.rotate.unsupported")));else if(y.type==="polyline"){if(!L&&!B){const P=y.paths.map(x=>x.map(([V,N])=>[V+ve,N+Pe]));D=new _e({paths:P,spatialReference:y.spatialReference})}else if(L){const P=y,x=h.key==="ArrowUp"||h.key==="ArrowRight"?1.05:.95,V=P.paths.map(N=>N.map(([be,we])=>[C.x+(be-C.x)*x,C.y+(we-C.y)*x]));D=new _e({paths:V,spatialReference:y.spatialReference})}else if(B){const P=y,x=h.key==="ArrowLeft"?-.05:h.key==="ArrowRight"?.05:0;if(x!==0){const V=Math.cos(x),N=Math.sin(x),be=P.paths.map(we=>we.map(([it,ot])=>{const xe=it-C.x,Re=ot-C.y,st=xe*V-Re*N,lt=xe*N+Re*V;return[C.x+st,C.y+lt]}));D=new _e({paths:be,spatialReference:y.spatialReference})}else D=y.clone()}}else if(y.type==="polygon"){if(!L&&!B){const P=y.rings.map(x=>x.map(([V,N])=>[V+ve,N+Pe]));D=new ie({rings:P,spatialReference:y.spatialReference})}else if(L){const P=y,x=h.key==="ArrowUp"||h.key==="ArrowRight"?1.05:.95,V=P.rings.map(N=>N.map(([be,we])=>[C.x+(be-C.x)*x,C.y+(we-C.y)*x]));D=new ie({rings:V,spatialReference:y.spatialReference})}else if(B){const P=y,x=h.key==="ArrowLeft"?-.05:h.key==="ArrowRight"?.05:0;if(x!==0){const V=Math.cos(x),N=Math.sin(x),be=P.rings.map(we=>we.map(([it,ot])=>{const xe=it-C.x,Re=ot-C.y,st=xe*V-Re*N,lt=xe*N+Re*V;return[C.x+st,C.y+lt]}));D=new ie({rings:be,spatialReference:y.spatialReference})}else D=y.clone()}}if(D){u.geometry=D,u.set("geometry",D),ne(u),u.attributes?.id&&n.updateGraphicGeometry(u.attributes.id,D);const P=L?"resized":B?"rotated":"moved";l.updateAlert(t(`draw.graphic.${P}`))}},ni=async h=>{const b=(await l.geo.map.esriView.hitTest(h)).results.find(m=>"graphic"in m&&m.graphic.layer===d&&!!m.graphic.attributes?.id);b&&n.activeTool==="edit"?r?.triggerUpdate([b.graphic]):(r?.cancel(),u=null,n.clearSelection(),ne())},ri=async()=>{await l.geo.map.viewPromise,l.geo.layer.getLayer(tt)?d=l.geo.layer.getLayer(tt).esriLayer:(d=l.geo.layer.createLayer({id:tt,layerType:Yi.GRAPHIC,cosmetic:!0,system:!0,url:""}),await l.geo.map.addLayer(d)),d?.esriLayer&&(d=d.esriLayer),Object.assign(a.value,{view:l.geo.map.esriView,layer:d,availableCreateTools:["point","multipoint","polyline","polygon","rectangle","circle"],updateOnGraphicClick:!0,visibleElements:{createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{enable:!0},settingsMenu:!1},defaultUpdateOptions:{highlightOptions:{enabled:!1}}}),l.geo.map.esriView.ui.add(a.value,"bottom-right"),a.value?.addEventListener("arcgisCreate",h=>Ot(h.detail)),a.value?.addEventListener("arcgisUpdate",h=>ai(h.detail)),c={remove:()=>a.value?.removeEventListener("arcgisCreate",h=>Ot(h.detail))},r=a.value,l.geo.map.esriView.on("click",ni),document.addEventListener("keydown",Ct),document.addEventListener("keydown",St,{capture:!0})},Lt=()=>{r&&(l.geo.map.esriView&&l.geo.map.esriView.ui.remove(r),c&&c.remove(),r.destroy()),document.removeEventListener("keydown",Ct),document.removeEventListener("keydown",St,{capture:!0}),w=!1,_=null,E=[],r=null,d=null,Ae=null},Ot=h=>{if(h.state==="complete"){const b=h.graphic,m=`graphic-${Date.now()}`;b.attributes=b.attributes||{},b.attributes.id=m,n.addGraphic({id:m,type:h.tool,geometry:b.geometry,attributes:b.attributes}),h.tool!=="point"&&(n.setActiveTool(""),Ae?.reset())}},ai=h=>{const b=h.graphics[0];if(b)if(h.state==="start"){if(n.activeTool!=="edit"){r.cancel();return}u=b,b.attributes?.id&&(n.selectGraphic(b.attributes.id),l.updateAlert(t("draw.graphic.selected",{type:i(b.attributes?.type)})))}else h.state==="active"?ne(b):h.state==="complete"&&b.attributes?.id&&(n.updateGraphicGeometry(b.attributes.id,b.geometry),l.updateAlert(t("draw.graphic.updated")))};return Wi(()=>{oi(),ri(),me.push(l.event.on(xt.MAP_DESTROYED,()=>{Lt()}))}),Dt(()=>n.activeTool,h=>{r.cancel(),ne(),_=null,E=[],w=!1,h&&h!="edit"&&r.create(h)}),ji(()=>{Lt(),me.forEach(h=>l.event.off(h))}),(h,b)=>(Qi(),qi("arcgis-sketch",{ref_key:"sketchEl",ref:a,style:{display:"none"}},null,512))}}),ii=[{type:"point"},{type:"polyline"},{type:"polygon"},{type:"circle"},{type:"rectangle"}];class Jo extends Ji{store;constructor(t,i){super(t,i),this.store=ct(this.$vApp.$pinia)}_parseConfig(t){if(!t){this.store.setSupportedTypes(ii);return}if(t.types!==void 0){const i=(t.types===null?[]:t.types).filter(l=>l.enabled!==!1);this.store.setSupportedTypes(i)}else this.store.setSupportedTypes(ii);t.defaultTool&&this.store.setActiveTool(t.defaultTool)}get graphicsLayerId(){return tt}}const Xo={en:{"draw.multiPoint.started":"{type} drawing started with 1 point","draw.multiPoint.pointAdded":"Point added {count} points total","draw.multiPoint.pointRemoved":"Point removed {count} points remaining","draw.multiPoint.canceled":"Drawing canceled","draw.multiPoint.completed":"{type} completed with {count} points","draw.multiPoint.notEnoughPoints":"Not enough points for {type} minimum {min} required","draw.graphic.created":"{type} created","draw.graphic.selected":"{type} selected","draw.graphic.deselected":"Graphic deselected","draw.graphic.deleted":"Graphic deleted","draw.graphic.updated":"Graphic updated","draw.graphic.none":"No graphic found","draw.tool.canceled":"Drawing tool canceled","draw.point.resize.unsupported":"Resizing not supported for point graphics","draw.point.rotate.unsupported":"Rotation not supported for point graphics","draw.move.up":"Moved up","draw.move.down":"Moved down","draw.move.left":"Moved left","draw.move.right":"Moved right","draw.resize.increase":"Increased size","draw.resize.decrease":"Decreased size","draw.rotate.clockwise":"Rotated clockwise","draw.rotate.counterclockwise":"Rotated counter-clockwise","draw.button.point":"Draw point","draw.button.polyline":"Draw line","draw.button.polygon":"Draw polygon","draw.button.rectangle":"Draw rectangle","draw.button.circle":"Draw circle","draw.point.tooltip":"Draw point","draw.polyline.tooltip":"Draw polyline","draw.polygon.tooltip":"Draw polygon","draw.circle.tooltip":"Draw circle","draw.rectangle.tooltip":"Draw rectangle","draw.edit.tooltip":"Edit Mode","draw.graphic.moved":"Graphic moved","draw.shape":"shape","draw.point":"point","draw.multipoint":"multipoint","draw.polyline":"polyline","draw.polygon":"polygon","draw.rectangle":"rectangle","draw.circle":"circle","draw.unknown":"unknown"},fr:{"draw.multiPoint.started":"Dessin de {type} commenc\xE9 avec 1 point","draw.multiPoint.pointAdded":"Point ajout\xE9","draw.multiPoint.pointRemoved":"Point supprim\xE9","draw.multiPoint.canceled":"Dessin annul\xE9","draw.multiPoint.completed":"{type} termin\xE9 avec {count} points","draw.multiPoint.notEnoughPoints":"Pas assez de points pour {type}","draw.graphic.created":"{type} cr\xE9\xE9","draw.graphic.selected":"{type} s\xE9lectionn\xE9","draw.graphic.deselected":"Graphique d\xE9s\xE9lectionn\xE9","draw.graphic.deleted":"Graphique supprim\xE9","draw.graphic.updated":"Graphique mis \xE0 jour","draw.graphic.none":"Aucun graphique trouv\xE9","draw.tool.canceled":"Outil de dessin annul\xE9","draw.point.resize.unsupported":"Le redimensionnement n'est pas pris en charge pour les points","draw.point.rotate.unsupported":"La rotation n'est pas prise en charge pour les points","draw.move.up":"D\xE9plac\xE9 vers le haut","draw.move.down":"D\xE9plac\xE9 vers le bas","draw.move.left":"D\xE9plac\xE9 vers la gauche","draw.move.right":"D\xE9plac\xE9 vers la droite","draw.resize.increase":"Taille augment\xE9e","draw.resize.decrease":"Taille r\xE9duite","draw.rotate.clockwise":"Rotation dans le sens horaire","draw.rotate.counterclockwise":"Rotation dans le sens antihoraire","draw.button.point":"Dessiner un point","draw.button.polyline":"Dessiner une ligne","draw.button.polygon":"Dessiner un polygone","draw.button.rectangle":"Dessiner un rectangle","draw.button.circle":"Dessiner un cercle","draw.point.tooltip":"Dessiner un point","draw.polyline.tooltip":"Dessiner une polyligne","draw.polygon.tooltip":"Dessiner un polygone","draw.circle.tooltip":"Dessiner un cercle","draw.rectangle.tooltip":"Dessiner un rectangle","draw.edit.tooltip":"Mode \xE9dition","draw.graphic.moved":"Graphique d\xE9plac\xE9","draw.shape":"forme","draw.point":"indiquer","draw.multipoint":"multipoint","draw.polyline":"polyligne","draw.polygon":"polygone","draw.rectangle":"rectangle","draw.circle":"cercle","draw.unknown":"inconnue"}};class es extends Jo{async init(){const{el:t}=this.mount(Zo,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),Object.entries(Xo).forEach(i=>this.$iApi.$i18n.mergeLocaleMessage(...i)),this._parseConfig(this.config),ct(this.$vApp.$pinia).supportedTypes.forEach(i=>{const l=`${i.type}-icon`;this.$iApi.component(l,Xi(ho(Object.assign({"./icons/circle-icon.vue":()=>import("./circle-icon-cBhQpVEp.js"),"./icons/edit-icon.vue":()=>import("./edit-icon-DHnlLFA9.js"),"./icons/point-icon.vue":()=>import("./point-icon-Bp0hQmRR.js"),"./icons/polygon-icon.vue":()=>import("./polygon-icon-BSKpGj_s.js"),"./icons/polyline-icon.vue":()=>import("./polyline-icon-DmpvxaHg.js"),"./icons/rectangle-icon.vue":()=>import("./rectangle-icon-D8wuYO4I.js")}),`./icons/${i.type}-icon.vue`,3)))})}async added(){this.$iApi.event.on(xt.MAP_CREATED,()=>{this.init()})}}const ts=Object.freeze(Object.defineProperty({__proto__:null,default:es},Symbol.toStringTag,{value:"Module"}));export{Le as c,Qt as e,ts as i,vt as n,ht as r};
