import{x as r,z as a,an as F,K as k,ae as J,$ as go,gx as yo,eT as mo,O as vo,gz as fo,eS as _o,a0 as wo,ft as bo,Q as Mt,i0 as x,ac as To,a9 as E,am as Ei,aW as xo,bQ as Mo,d4 as Le,eC as Eo,ad as Me,b6 as Et,U as Co,bp as Ci,aV as So,l6 as Vo,T as je,aX as Po,bE as un,bs as Ft,V as _e,a3 as ne,L as ko,bP as se,fI as Nt,dC as Si,fT as Vi,l as Xe,jT as Oo,jU as Lo,a4 as L,eq as Re,fo as Ro,f4 as Ct,d5 as we,ai as Pi,eQ as Io,c5 as ki,d2 as gn,dq as ce,kK as Do,kL as Ao,kM as zo,j7 as Zt,aY as yn,s as Go,cW as mn,eU as Ho,ao as Bo,l7 as vn,eh as fn,ci as _n,l8 as Fo,bq as No,l9 as wn,la as Zo,eY as Uo,ca as $o,i7 as Wo,i8 as jo,bD as Oi,f6 as Xo,lb as bn,lc as Tn,ld as qo,le as Ko,ew as Yo,f5 as xn,c as Qo,hH as Ut,n as St,fa as Li,a5 as Jo,lf as er,lg as tr,lh as Ri,li as $t,lj as Ii,lk as ir,cK as nr,cL as sr,ll as Vt,lm as or,cR as rr,ln as ar,lo as lr,dO as cr,dP as pr,e1 as dr,e2 as hr,a as ur,e5 as Mn,e6 as gr,dG as En,lp as yr,c$ as mr,g4 as vr,d1 as fr,f3 as Wt,cA as Cn,cz as _r,ah as qe,F as wr,ff as br}from"./main-CZ1ZHN9A.js";import{u as Di}from"./draw-store-Banj_rPE.js";import Tr from"./GraphicsLayer-DXJEC1A8.js";import"./intl-BuKqMwGl.js";import{a5 as xr,K as Sn,a6 as jt,a7 as Ai,c as dt,a8 as Mr,a9 as Vn,a1 as Er,aa as Cr,a2 as ht,Z as ut,ab as Pn,ac as Sr,M as Vr,x as Pr,ad as kn,ae as kr,j as Or,B as Lr,af as On,ag as Rr,ah as Ir,ai as Dr,aj as Ln,o as Rn,S as In,ak as Ar,D as Xt,C as Dn,al as zr,l as An,am as Pt}from"./SketchViewModel-Dvss6U7x.js";import{O as Ee,n as u,c as Ie,e as De,a as Gr,h as Hr,i as zn}from"./jsxFactory-DRy2zNaO.js";import{o as Ke,d as Gn,f as Br,e as zi,g as Fr}from"./globalCss-BeWmXR81.js";import{o as qt}from"./layerViewUtils-Co04b2ti.js";import{a as Nr,e as Hn,b as Zr}from"./widget-Yw9I_cxP.js";import{y as Ur}from"./diffUtils-BFZxyxa-.js";import{h as $r}from"./UpdatingHandles-CGXL8W59.js";import{l as Bn}from"./ViewingMode-CyR_b1T8.js";import{_ as Wr,m as Fn,r as jr,T as Xr,e as Nn,v as qr,j as Kr,I as Yr,k as Zn}from"./vec2-BnynUbeJ.js";import{n as Ye,t as Kt,o as Qr}from"./vec2f64-CEUyUoff.js";import{o as Qe,I as Gi,p as Un,s as gt,J as Hi,K as $n,_ as yt,A as mt,g as Bi,P as Yt,y as Wn,u as vt,c as jn,Q as Xn}from"./vec32-P7asVjhs.js";import{_ as Jr,a as ea,L as ta}from"./vec42-D8CJyqHG.js";import{n as ia,r as Fi,u as na}from"./vec4f64-CjUMzAyX.js";import{O as Qt}from"./projection-B1uBxcWq.js";import{c as sa}from"./meshVertexSpaceUtils-BakNfzJa.js";import{k as oa,x as Jt}from"./hydratedFeatures-BEPA5xgq.js";import{M as qn,b as ra,l as aa,V as kt,f as Kn,h as Ni,z as la,H as ca,O as Zi,k as pa}from"./plane-DxbBqgMO.js";import{f as Ui,a as da,o as ha}from"./quantityUtils-DxiETWUr.js";import{e as $i,n as ei}from"./projectVectorToVector-0zJqhkp1.js";import{j as ua,N as ga}from"./geodesicUtils-BoV2C68y.js";import{g as Yn,F as Qn}from"./Scheduler-B1Gp9ChL.js";import{G as T}from"./geometryEngineBase-DueYg7ux.js";import{hydratedAdapter as V}from"./hydrated-PyhcGgy8.js";import{u as ya}from"./mat2d-BQA-1WB-.js";import{R as ma,L as va}from"./quat-BCC9kToU.js";import{e as Jn}from"./quatf64-C16JxGFv.js";import{o as fa,r as _a}from"./drapedUtils-BaIkfH_w.js";import{e as es}from"./utils-C0LvbFCo.js";import{s as ts}from"./substitute-Df0JYzU0.js";var Wi;let Ae=Wi=class extends J{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;const i=go(this.radius,this.radiusUnit,"meters"),n=e.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&yo[n.wkid])!=null||(n.wkt2||n.wkt)&&mo(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let l;switch(o){case"webMercator":l=vo(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":l=e}s=this._createGeodesicCircle(l,i,t),o==="webMercator"&&(s=fo(s))}else{let l;o==="webMercator"||o==="projected"?l=i/_o(e.spatialReference):o==="geographic"&&(l=wo(i,"meters",bo(e.spatialReference).radius)),s=this._createPlanarCircle(e,l,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s}=this;return new Wi({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(e,t,i){const n=[],s=[e.x,e.y];for(let o=0;o<360;o+=360/i){const l=this.hasZ?[0,0,e.z??0]:[0,0];ua(l,s,o,t,Mt.WGS84),n.push(l)}return n.push(n[0]),new J({rings:[n]})}_createPlanarCircle(e,t,i){const n=[],s=2*Math.PI/i;for(let o=0;o<i;++o){const l=s*o,c=[e.x+Math.cos(-l)*t,e.y+Math.sin(-l)*t];this.hasZ&&c.push(e.z??0),n.push(c)}return n.push(n[0]),new J({spatialReference:e.spatialReference,rings:[n]})}};r([a({type:F})],Ae.prototype,"center",void 0),r([a()],Ae.prototype,"geodesic",void 0),r([a()],Ae.prototype,"numberOfPoints",void 0),r([a()],Ae.prototype,"radius",void 0),r([a()],Ae.prototype,"radiusUnit",void 0),Ae=Wi=r([k("esri.geometry.Circle")],Ae);const wa=Ae;function P(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?To(Mt,t):Mt.WGS84}function ba(e){return T.extendedSpatialReferenceInfo(e)}function Ta(e,t){return x(e),T.clip(V,P(e),e,t)}function xa(e,t){return x(e),T.cut(V,P(e),e,t)}function Ma(e,t){return x(e),x(t),T.contains(V,P(e),e,t)}function Ea(e,t){return x(e),x(t),T.crosses(V,P(e),e,t)}function is(e,t,i){return x(e),x(t),T.distance(V,P(e),e,t,i)}function Ca(e,t){return x(e),x(t),T.equals(V,P(e),e,t)}function Sa(e,t){return x(e),x(t),T.intersects(V,P(e),e,t)}function Va(e,t){return x(e),x(t),T.touches(V,P(e),e,t)}function Pa(e,t){return x(e),x(t),T.within(V,P(e),e,t)}function ka(e,t){return x(e),x(t),T.disjoint(V,P(e),e,t)}function Oa(e,t){return x(e),x(t),T.overlaps(V,P(e),e,t)}function La(e,t,i){return x(e),x(t),T.relate(V,P(e),e,t,i)}function Ra(e){return x(e),T.isSimple(V,P(e),e)}function ns(e){return x(e),T.simplify(V,P(e),e)}function Ia(e,t=!1){return T.convexHull(V,P(e),e,t)}function Da(e,t){return x(t),T.difference(V,P(e),e,t)}function Aa(e,t){return x(t),T.symmetricDifference(V,P(e),e,t)}function za(e,t){return x(t),T.intersect(V,P(e),e,t)}function Ga(e){return T.union(V,P(e),e)}function Ha(e,t,i,n,s,o){return T.offset(V,P(e),e,t,i,n,s,o)}function Ba(e,t,i,n=!1){return T.buffer(V,P(e),e,t,i,n)}function Fa(e,t,i,n,s,o){return T.geodesicBuffer(V,P(e),e,t,i,n,s,o)}function Na(e,t,i=!0){return x(e),T.nearestCoordinate(V,P(e),e,t,i)}function Za(e,t){return x(e),T.nearestVertex(V,P(e),e,t)}function Ua(e,t,i,n){return x(e),T.nearestVertices(V,P(e),e,t,i,n)}function ji(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function $a(e,t,i){if(e==null)throw new ft;const n=e.spatialReference;if((i=i??ji(e))==null)throw new ft;const s=e.constructor.fromJSON(T.rotate(e,t,i));return s.spatialReference=n,s}function Wa(e,t){if(e==null)throw new ft;const i=e.spatialReference;if((t=t??ji(e))==null)throw new ft;const n=e.constructor.fromJSON(T.flipHorizontal(e,t));return n.spatialReference=i,n}function ja(e,t){if(e==null)throw new ft;const i=e.spatialReference;if((t=t??ji(e))==null)throw new ft;const n=e.constructor.fromJSON(T.flipVertical(e,t));return n.spatialReference=i,n}function Xa(e,t,i,n){return x(e),T.generalize(V,P(e),e,t,i,n)}function qa(e,t,i){return x(e),T.densify(V,P(e),e,t,i)}function Ka(e,t,i,n=0){return x(e),T.geodesicDensify(V,P(e),e,t,i,n)}function Ya(e,t){return x(e),T.planarArea(V,P(e),e,t)}function Qa(e,t){return x(e),T.planarLength(V,P(e),e,t)}function ss(e,t,i){return x(e),T.geodesicArea(V,P(e),e,t,i)}function os(e,t,i){return x(e),T.geodesicLength(V,P(e),e,t,i)}function Ja(e,t){return T.intersectLinesToPoints(V,P(e),e,t)}function el(e,t){T.changeDefaultSpatialReferenceTolerance(e,t)}function tl(e){T.clearDefaultSpatialReferenceTolerance(e)}let ft=class extends Error{constructor(){super("Illegal Argument Exception")}};const il=Object.freeze(Object.defineProperty({__proto__:null,buffer:Ba,changeDefaultSpatialReferenceTolerance:el,clearDefaultSpatialReferenceTolerance:tl,clip:Ta,contains:Ma,convexHull:Ia,crosses:Ea,cut:xa,densify:qa,difference:Da,disjoint:ka,distance:is,equals:Ca,extendedSpatialReferenceInfo:ba,flipHorizontal:Wa,flipVertical:ja,generalize:Xa,geodesicArea:ss,geodesicBuffer:Fa,geodesicDensify:Ka,geodesicLength:os,intersect:za,intersectLinesToPoints:Ja,intersects:Sa,isSimple:Ra,nearestCoordinate:Na,nearestVertex:Za,nearestVertices:Ua,offset:Ha,overlaps:Oa,planarArea:Ya,planarLength:Qa,relate:La,rotate:$a,simplify:ns,symmetricDifference:Aa,touches:Va,union:Ga,within:Pa},Symbol.toStringTag,{value:"Module"}));var G;(function(e){e[e.Z=0]="Z",e[e.M=1]="M"})(G||(G={}));let nl=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(Ye())}pointToVector(e){return this._tag(Kt(e.x,e.y))}arrayToVector(e){return this._tag(Kt(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return Wr(n,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return Fn(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(Qr(e))}copy(e,t){return jr(t,e)}fromXYZ(e){return this._tag(Kt(e[0],e[1]))}toXYZ(e,t=E()){return Qe(t,e[0],e[1],0)}pointToXYZ(e,t=E()){return Qe(t,e.x,e.y,0)}equals(e,t){return Xr(e,t)}_tag(e){return e}},rs=class{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag(E())}pointToVector(e){return this._tag(Ei(e.x,e.y,this._valueType===G.Z?e.z:e.m))}arrayToVector(e){return this._tag(Ei(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===G.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=this._valueType===G.Z?e[2]:void 0,t.m=this._valueType===G.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=this._valueType===G.Z?e[2]:void 0,t.m=this._valueType===G.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const i=this._valueType===G.Z,n=this._valueType===G.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=n?e[2]:void 0,t.hasZ=i,t.hasM=n,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return Gi(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,this._valueType===G.Z&&(e[2]+=n)}distance(e,t){return this._valueType===G.Z?Un(e,t):Fn(e,t)}getZ(e,t=void 0){return this._valueType===G.Z?e[2]:t}hasZ(){return this._valueType===G.Z}getM(e,t=void 0){return this._valueType===G.M?e[2]:t}hasM(){return this._valueType===G.M}clone(e){return this._tag(xo(e))}copy(e,t){return gt(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Ei(e[0],e[1],this._valueType===G.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=E()){return Qe(t,e[0],e[1],this._valueType===G.Z?e[2]:0)}pointToXYZ(e,t=E()){return Qe(t,e.x,e.y,this._valueType===G.Z?e.z??0:0)}equals(e,t){return Hi(e,t)}_tag(e){return e}},sl=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(ia())}pointToVector(e){return this._tag(Fi(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Fi(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return Jr(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}distance(e,t){return Un(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(na(e))}copy(e,t){return ea(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Fi(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=E()){return Qe(t,e[0],e[1],e[2])}pointToXYZ(e,t=E()){return Qe(t,e.x,e.y,e.z??0)}equals(e,t){return ta(e,t)}_tag(e){return e}};function Xi(e,t,i){return e&&t?new sl(i):t?new rs(G.M,i):e?new rs(G.Z,i):new nl(i)}function ol(e,t){if(!t.supported)return;let i=1/0,n=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach(l=>{let c=l.pos[0];for(;c<t.lowerBoundX;)c+=s;for(;c>t.upperBoundX;)c-=s;i=Math.min(i,c),n=Math.max(n,c),l.pos[0]=c});const o=n-i;s-o<o&&e.forEach(l=>{l.pos[0]<0&&(l.pos[0]+=s)})}function rl(e,t){const i=Mo(e);return t===Bn.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Ot=class{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}},Ce=class{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}},ti=class{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||ol(this.vertices,rl(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(this.vertices.length===0)return;const i=this.vertices[0];let n=null,s=e,o=t;do n=s,n.index=o++,s=n.rightEdge?n.rightEdge.rightVertex:null;while(s!=null&&s!==i);n.leftEdge&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(this.vertices.length===0)return;const t=this.vertices[0];let i=t;do e(i,i.index),i=i.rightEdge!=null?i.rightEdge.rightVertex:null;while(i!==t&&i!=null)}},ii=class io extends Le{constructor(t,i){super(),this.type=t,this.coordinateHelper=i,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:Eo(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const i of t.vertices)yield i}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[];let o=n.vertices.find(c=>c.leftEdge==null);const l=o;do s.push(i(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==l);t.push(s)}return new Me({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[],o=n.vertices[0];let l=o;const c=l;do s.push(i(l.pos)),l=l.rightEdge!=null?l.rightEdge.rightVertex:null;while(l&&l!==c);n.isClosed()&&s.push(i(o.pos)),t.push(s)}return new J({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,i){const n=t.spatialReference,s=Xi(t.hasZ,t.hasM,n),o=new io(t.type,s);switch(t.type){case"polygon":al(o,t,i);break;case"polyline":ll(o,t,i);break;case"point":as(o,t,i);break;case"mesh":as(o,t.origin,i),o._geometry=t,o._dirty=!1}return o}};function al(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.rings;for(let l=0;l<o.length;++l){const c=o[l],p=new ti(n,i);p.index=l;const d=c.length>2&&Et(c[0],c[c.length-1]),h=d?c.length-1:c.length;for(let m=0;m<h;++m){const v=s.arrayToVector(c[m]),C=new Ot(p);p.vertices.push(C),C.pos=v,C.index=m}const g=p.vertices.length-1;for(let m=0;m<g;++m){const v=p.vertices[m],C=p.vertices[m+1],S=new Ce(p,v,C);p.edges.push(S)}if(d){const m=new Ce(p,p.vertices[p.vertices.length-1],p.vertices[0]);p.edges.push(m)}e.components.push(p)}}function ll(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.paths;for(let l=0;l<o.length;++l){const c=o[l],p=new ti(n,i);p.index=l;const d=c.length;for(let g=0;g<d;++g){const m=s.arrayToVector(c[g]),v=new Ot(p);p.vertices.push(v),v.pos=m,v.index=g}const h=p.vertices.length-1;for(let g=0;g<h;++g){const m=p.vertices[g],v=p.vertices[g+1],C=new Ce(p,m,v);p.edges.push(C)}e.components.push(p)}}function as(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=new ti(n,i);o.index=0;const l=new Ot(o);l.index=0,l.pos=s.pointToVector(t),o.vertices.push(l),e.components.push(o)}function Lt(e){return e.type==="mesh"}var Y;(function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(Y||(Y={}));let cl=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";this._addedVertex==null&&(e="apply",this._addedVertex=new Ot(this._component));const t=this._component.getLastVertex();if(t==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;t.rightEdge&&(this._originalEdge=t.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Ce(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Ce(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},ls=class no{constructor(t,i,n){this._editGeometry=t,this._vertices=i,this.operation=n,this._undone=!1}_notifyChanges(t){this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:this._vertices})}apply(){this._vertices.forEach(t=>this.operation.apply(t)),this._notifyChanges(this._undone?"redo":"apply")}undo(){this._vertices.forEach(t=>this.operation.undo(t)),this._undone=!0,this._notifyChanges("undo")}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let i=0;i<t._vertices.length;++i)if(t._vertices[i]!==this._vertices[i])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof no&&this.canAccumulate(t))&&(this._vertices.forEach(i=>this.operation.accumulate(i,t.operation)),this.operation.accumulateParams(t.operation),this._notifyChanges("apply"),!0)}};var oe;(function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"})(oe||(oe={}));let pl=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(this.removedVertices==null){const t=this.removedVertices=[];this._vertices.forEach(i=>{const n=this._removeVertex(i);n!=null&&t.push(n)}),e="apply"}else this.removedVertices.forEach(t=>{this._removeVertex(t.removedVertex)});this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach(e=>{this._undoRemoveVertex(e)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},n=e.leftEdge,s=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),n&&(t.edges.splice(t.edges.indexOf(n),1),n.leftVertex.rightEdge=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.rightVertex.leftEdge=null),e.index===0&&s&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.rightVertex),0),n&&s&&(i.createdEdge=new Ce(t,n.leftVertex,s.rightVertex),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.rightVertex,s.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,n=t.leftEdge,s=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),s&&(i.edges.push(s),s.rightVertex.leftEdge=s),i.updateVertexIndex(t,t.index)}},dl=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,i=t.component,n=t.leftVertex,s=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),this.createdVertex==null&&(e="apply",this.createdVertex=new Ot(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Ce(i,n,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),n.rightEdge=this._left,this._right==null&&(this._right=new Ce(i,this.createdVertex,s)),i.edges.push(this._right),s.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,n.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,s=i?.leftVertex,o=n?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),s&&(s.rightEdge=e),o&&(o.leftEdge=e),s&&t.updateVertexIndex(s,s.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},hl=class so{constructor(t,i,n){this._editGeometry=t,this._vertex=i,this._pos=n}apply(){const t=this._originalPosition==null;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof so&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},ul=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(this._createdEdge==null){e="apply";const t=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||t==null||i==null)return;this._createdEdge=new Ce(this._component,i,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){this._createdEdge!=null&&(Co(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},cs=class oo{constructor(t,i,n,s){this._editGeometry=t,this.dx=i,this.dy=n,this.dz=s,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const i=this._editGeometry.geometry;return t instanceof oo&&t._editGeometry.geometry===i&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,i,n,s){const o=this._editGeometry.geometry;o.offset(i,n,s);const l=this._editGeometry.components[0].getFirstVertex();if(!l)return;const c=this._editGeometry.coordinateHelper;l.pos=c.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[l]})}},ps=class ro{constructor(t,i,n,s){this._helper=t,this.dx=i,this.dy=n,this.dz=s}_move(t,i,n,s){this._helper.addDelta(t.pos,i,n,s)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof ro}accumulate(t,i){this._move(t,i.dx,i.dy,i.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},ds=class hn{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,i,n,s=0,o=Rt.IMMEDIATE){this._helper=t,this._planeType=i,this._edge=n,this.distance=s,this._plane=qn(),this._offsetPlane=qn(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===Rt.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),i=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=$n(E(),t,n),i?(this._left=this._computeNeighbor(t,i,this._edgeDirection),this._right=this._computeNeighbor(n,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,s,this._edgeDirection),this._left=this._computeNeighbor(t,i,this._edgeDirection,this._right))}_toXYZ(t){return t!=null?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,i,n,s){const o=E();if(i){$n(o,t,i);const l=!this._passesBisectingAngleThreshold(o,n);return{start:t,end:i,direction:l?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!l}}return this._helper.hasZ()?s&&(yt(o,n,s.direction),yt(o,o,n),mt(o,o),Math.sign(o[1])!==Math.sign(n[0])&&Bi(o,o,-1)):Qe(o,-n[1],n[0],0),{start:t,end:i,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,i){const n=Math.abs(ra(i,t));return n>=hs&&n<=Math.PI-hs}_bisectVectorsPerpendicular(t,i){const n=Yt(t,i)<0?t:Wn(E(),t),s=Math.abs(Yt(n,i));if(!(s<us||s>1-us))return this._bisectDirection(n,i);const o=yt(E(),n,[0,0,1]);return mt(o,o)}_bisectDirection(t,i){const n=vt(E(),t,i);return mt(n,n)}_initializePlane(){const t=this._computeNormalDirection(this._left),i=this._computeNormalDirection(this._right);Yt(t,i)<0&&Wn(i,i),aa(this._left.start,this._bisectDirection(t,i),this._plane)}_computeNormalDirection(t){const i=yt(E(),t.direction,this._edgeDirection);mt(i,i);const n=yt(E(),this._edgeDirection,i);return this._planeType===ni.XY&&(n[2]=0),mt(n,n)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(kt(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(kt(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const i=Zi(t),n=this._edgeDirection,s=vt(E(),this._left.start,this._left.direction),o=vt(E(),this._right.start,this._right.direction),l=this._pointInBasis2D(Ye(),i,n,this._left.start),c=this._pointInBasis2D(Ye(),i,n,s),p=this._pointInBasis2D(Ye(),i,n,this._right.start),d=this._pointInBasis2D(Ye(),i,n,o),[h]=xr({start:c,end:l,type:Sn.LINE},{start:d,end:p,type:Sn.LINE});if(!h)return;const g=Nn(Ye(),l,c);qr(g,g);const m=Nn(Ye(),h,c),v=Kr(g,m),C=vt(E(),s,Bi(E(),this._left.direction,-v)),S=kt(t,C);this._updateDistanceConstraint(S)}_pointInBasis2D(t,i,n,s){return t[0]=Kn(i,s),t[1]=Kn(n,s),t}_offset(t,i){Number.isFinite(this._minDistance)&&(i=Math.max(this._minDistance,i)),Number.isFinite(this._maxDistance)&&(i=Math.min(this._maxDistance,i)),Ni(this._offsetPlane,this._plane),this._offsetPlane[3]-=i;const n=(o,l,c)=>l!=null&&pa(this._offsetPlane,o,vt(E(),o,l),c),s=E();(t===this._edge.leftVertex?n(this._left.start,this._left.direction,s):n(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=la(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return kt(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const i=this._helper.toXYZ(this._helper.pointToVector(t)),n=ca(this._plane,i,E()),s=kt(this._plane,i),o=Ci(s,this._minDistance,this._maxDistance);return Gi(i,n,i,o/s),{start:n,end:i}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof hn&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&Hi(Zi(this._plane),Zi(t._plane))}accumulate(t,i){const n=this._plane[3]-i._plane[3]+i.distance;this._offset(t,n)}accumulateParams(t){const i=t.distance-t._plane[3];this.distance=i+this._plane[3]}clone(){const t=new hn(this._helper,this._planeType,this._edge,this.distance,Rt.DEFERRED);return Ni(t._plane,this._plane),Ni(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=gt(E(),this._edgeDirection),t}_maybeEqualsVec3(t,i){return t==null&&i==null||t!=null&&i!=null&&Hi(t,i)}_cloneNeighbor({start:t,end:i,direction:n,isOriginalDirection:s}){return{start:gt(E(),t),end:i!=null?gt(E(),i):null,direction:gt(E(),n),isOriginalDirection:s}}};const hs=So(15),us=.001;var ni,Rt;(function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"})(ni||(ni={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(Rt||(Rt={}));let gs=class ao{constructor(t,i,n=oe.CUMULATIVE){this.origin=t,this.angle=i,this._accumulationType=n}_rotate(t,i){Yr(t.pos,t.pos,this.origin,i)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof ao&&Et(this.origin,t.origin)}accumulate(t,i){const n=i._accumulationType===oe.REPLACE;this._rotate(t,n?i.angle-this.angle:i.angle)}accumulateParams(t){const i=t._accumulationType===oe.REPLACE;this.angle=i?t.angle:this.angle+t.angle}},ys=class lo{constructor(t,i,n,s,o=oe.CUMULATIVE){this.origin=t,this.axis1=i,this.factor1=n,this.factor2=s,this._accumulationType=o,this.axis2=Kt(i[1],-i[0])}_scale(t,i,n){Zn(t.pos,t.pos,this.origin,this.axis1,i),Zn(t.pos,t.pos,this.origin,this.axis2,n)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof lo&&Et(this.origin,t.origin)&&Et(this.axis1,t.axis1)}accumulate(t,i){i._accumulationType===oe.REPLACE?this._scale(t,i.factor1/this.factor1,i.factor2/this.factor2):this._scale(t,i.factor1,i.factor2)}accumulateParams(t){const i=t._accumulationType===oe.REPLACE;this.factor1=i?t.factor1:this.factor1*t.factor1,this.factor2=i?t.factor2:this.factor2*t.factor2}},gl=class co{constructor(t,i){this._editGeometry=t,this._newPositions=i}apply(){const t=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const i=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(n=>i.clone(n.pos))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof co&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,i){const n=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let o=0;o<s.length;o++)n.copy(i[o],s[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:s})}};var ms;const yl=Symbol();let ml=class{constructor(e){this._operations=[],this._closed=!1,this[ms]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}};ms=yl;let si=class po extends Le{constructor(t,i){super(),this.data=t,this.viewingMode=i,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",n=>{n.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:n.addedVertices,operation:n.operation}),n.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:n.removedVertices,operation:n.operation}),n.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:n.updatedVertices,operation:n.operation})})}destroy(){this._listener.remove()}splitEdge(t,i){return this._apply(new dl(this.data,t,i))}updateVertices(t,i,n=Y.ACCUMULATE_STEPS){return this._apply(new ls(this.data,t,i),n)}move(t,i,n,s=Y.ACCUMULATE_STEPS){return Lt(this.data)?this._apply(new cs(this.data,t,i,n),s):this.moveVertices(this.data.allVertices,t,i,n,s)}moveVertices(t,i,n,s,o=Y.ACCUMULATE_STEPS){return Lt(this.data)?this._apply(new cs(this.data,i,n,s),o):this.updateVertices(t,new ps(this.data.coordinateHelper,i,n,s),o)}scale(t,i,n,s,o=Y.ACCUMULATE_STEPS,l=oe.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,i,n,s,o,l)}scaleVertices(t,i,n,s,o,l=Y.ACCUMULATE_STEPS,c=oe.CUMULATIVE){return this.updateVertices(t,new ys(i,n,s,o,c),l)}rotate(t,i,n=Y.ACCUMULATE_STEPS,s=oe.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,i,n,s)}rotateVertices(t,i,n,s=Y.ACCUMULATE_STEPS,o=oe.CUMULATIVE){return this.updateVertices(t,new gs(i,n,o),s)}removeVertices(t){return this._apply(new pl(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return this.data.components.length===0?null:this._apply(new cl(this.data,this.data.components[0],t))}setVertexPosition(t,i){return this._apply(new hl(this.data,t,i))}offsetEdge(t,i,n,s=Y.ACCUMULATE_STEPS){return this.updateVertices([i.leftVertex,i.rightVertex],new ds(this.data.coordinateHelper,t,i,n),s)}trySetGeometry(t,i=Y.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:s}=n;if(n.type!==t.type||!n.spatialReference.equals(t.spatialReference)||s.hasZ()!==t.hasZ||s.hasM()!==t.hasM||!Vo(n.geometry,t)||Lt(n))return;const o=Array.from(ii.fromGeometry(t,this.viewingMode).iterateVertices(),l=>l.pos);return this.setVertexPositions(o,i)}setVertexPositions(t,i=Y.ACCUMULATE_STEPS){return this._apply(new gl(this.data,t),i)}createResetState(){if(Lt(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return je(()=>this.trySetGeometry(t))}closeComponent(t){return this.data.components.includes(t)?this._apply(new ul(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new ml;return this._apply(t),je(()=>t.close())}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,i=Y.ACCUMULATE_STEPS){return i!==Y.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!Lt(this.data))return je();const t=this.data.geometry,{vertexSpace:i}=t;if(i.origin){const s=Po(i.origin);return je(()=>{t.vertexSpace.origin=s})}const n=t.vertexAttributes.clonePositional();return je(()=>{t.vertexAttributes=n,t.vertexAttributesChanged()})}static fromGeometry(t,i){return new po(ii.fromGeometry(t,i),i)}};function It(e,t){return e===t||e!=null&&t!=null&&un(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function qi(e,t,i){return e===t||e!=null&&t!=null&&un(e.spatialReference,t.spatialReference)&&Ft(e.x,t.x,i)&&Ft(e.y,t.y,i)&&Ft(e.z??0,t.z??0,i)&&Ft(e.m??0,t.m??0,i)}var Je;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(Je||(Je={}));let vl=class{constructor(){this._isToolEditable=!0,this._manipulators=new _e,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=Je.WhenToolEditable){this.addMany([e],t)}addMany(e,t=Je.WhenToolEditable){for(const i of e){const n={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const i=this._manipulators.splice(t,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,i=>{t(i)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const l=s.intersectionDistance(e,t);l!=null&&l<n&&(n=l,i=s)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===Je.Always||(this._isToolEditable?e.visibilityPredicate===Je.WhenToolEditable:e.visibilityPredicate===Je.WhenToolNotEditable)}},U=class extends ne{constructor(e){super(e),this.manipulators=new vl,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Ke.MANAGER,!0],[Ke.USER,!0]]),this._creationFinishedResolver=ko()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(Ke.USER)}set editable(e){this.setEditableFlag(Ke.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===Ke.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(Ke.USER)&&this.getEditableFlag(Ke.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};r([a({constructOnly:!0})],U.prototype,"view",void 0),r([a({readOnly:!0})],U.prototype,"active",null),r([a({value:!0})],U.prototype,"visible",null),r([a({value:!0})],U.prototype,"editable",null),r([a({readOnly:!0})],U.prototype,"manipulators",void 0),r([a({readOnly:!0})],U.prototype,"updating",null),r([a()],U.prototype,"cursor",null),r([a({readOnly:!0})],U.prototype,"automaticManipulatorSelection",void 0),r([a()],U.prototype,"hasFocusedManipulators",null),r([a()],U.prototype,"hasGrabbedManipulators",void 0),r([a()],U.prototype,"hasHoveredManipulators",void 0),r([a()],U.prototype,"firstGrabbedManipulator",void 0),r([a({readOnly:!0})],U.prototype,"created",void 0),r([a({readOnly:!0})],U.prototype,"removeIncompleteOnCancel",void 0),U=r([k("esri.views.interactive.InteractiveToolBase")],U);function fl(e,t){let i=null,n=null;return s=>{if(s.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&i==null&&(i=new ri,n=new ri,t(e,i,n,s.pointerType,o)),i?.execute(o),s.action==="end"&&i!=null&&(i=null,n=null)}}function oi(e,t){return e.events.on("drag",fl(e,t))}function _l(e,t){const i=[e.x,e.y,e.z??0],n=t,s=[Math.cos(n),Math.sin(n)],o=Math.sqrt(s[0]*s[0]+s[1]*s[1]);if(o===0)return null;s[0]/=o,s[1]/=o;const l=c=>{const p=(c.x-i[0])*s[0]+(c.y-i[1])*s[1];c.x=i[0]+p*s[0],c.y=i[1]+p*s[1]};return c=>(l(c.mapStart),l(c.mapEnd),{...c,axis:s})}function vs(e){let t=null;return i=>{if(i.action==="start"&&(t=wl(e,i.mapStart.spatialReference)),t==null)return null;const n=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,o=(i.mapEnd.z??0)-(i.mapStart.z??0);return t.move(n,s,o,i.action),{...i,translationX:n,translationY:s,translationZ:o}}}function fs(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():Qt(e,t)}function wl(e,t){const i=e.operations;if(!i)return null;const n=i.data.geometry,s=oa(t);if(n.spatialReference.equals(s))return Ki(e,i,()=>{});if(n.type!=="mesh"){const o=fs(n,s);if(o==null)return null;const l=n.spatialReference;return Ki(e,si.fromGeometry(o,i.viewingMode),()=>{const c=Qt(n,l);i.trySetGeometry(c)})}if(sa(n)){const o=fs(n.origin,s);if(!o)return null;const l=n.spatialReference,c=si.fromGeometry(o,i.viewingMode);return Ki(e,i,()=>{const p=Qt(c.data.geometry,l),d=p.x-n.origin.x,h=p.y-n.origin.y,g=(p.z??0)-(n.origin.z??0);i.move(d,h,g)})}return null}function Ki(e,t,i){let n=0,s=0,o=0;return{move:(l,c,p,d)=>{d==="start"&&(n=0,s=0,o=0);const h=l-n,g=c-s,m=p-o;t.move(h,g,m),n+=h,s+=g,o+=m,i(),d==="end"&&e.endInteraction?.()}}}function bl(e,t=null,i){let n=null;const s=t==null||e.spatialReference?.equals(t)?l=>l:l=>l!=null?Qt(l,t):l,o={exclude:[],...i};return l=>{if(l.action==="start"&&(n=s(e.toMap(l.screenStart,o))),n==null)return null;const c=s(e.toMap(l.screenEnd,o));return c!=null?{...l,mapStart:n,mapEnd:c}:null}}function Tl(e){const t=e.map(i=>vs(i)).filter(se);return i=>{const n=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,o=i.mapEnd.z-i.mapStart.z;return t.forEach(l=>l(i)),{...i,translationX:n,translationY:s,translationZ:o}}}function _s(e){const t=e.operations?.createResetState();return i=>(t?.remove(),i)}function xl(e){const t=e.map(i=>_s(i)).filter(i=>i!=null);return i=>(t.forEach(n=>n(i)),i)}function Ml(){let e=0,t=0,i=0;return n=>{n.action==="start"&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const s=n.mapEnd.x-e,o=n.mapEnd.y-t,l=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:s,mapDeltaY:o,mapDeltaZ:l,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function El(){let e=0,t=0;return i=>{i.action==="start"&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,s=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:s}}}function Cl(e,t){let i=null,n=0,s=0;return o=>{if(o.action==="start"&&(i=e.toScreen?.(t),i!=null&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=o.screenStart.x-i.x,s=o.screenStart.y-i.y))),i==null)return null;const l=Ci(o.screenEnd.x-n,0,e.width),c=Ci(o.screenEnd.y-s,0,e.height),p=Nt(l,c);return o.screenStart=i,o.screenEnd=p,o}}const Sl=()=>{};let ri=class ho{constructor(){this.execute=Sl}next(t,i=new ho){return t!=null&&(this.execute=n=>{const s=t(n);s!=null&&i.execute(s)}),i}};function ws(e,t,i=[]){if(e.type==="2d")return s=>s;let n=null;return s=>{s.action==="start"&&(n=e.toMap(s.screenStart,{exclude:i}),n!=null&&(n.z=jt(n,e,t)));const o=e.toMap(s.screenEnd,{exclude:i});o!=null&&(o.z=jt(o,e,t));const l=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...s,scenePoints:l}}}function bs(e,t,i){const n=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,s=Jt(e);return s.z=n,s.hasZ=!0,s.z=jt(s,t,i),s}function Vl(e,t){if(e.type==="2d")return n=>n;let i=null;return n=>{n.action==="start"&&(i=bs(n.mapStart,e,t));const s=bs(n.mapEnd,e,t),o=i!=null&&s!=null?{sceneStart:i,sceneEnd:s}:null;return{...n,scenePoints:o}}}let ai=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}},et=class extends ne{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Si(async(t,i,n,s)=>{const o=this._frameTask;if(o==null)return;const l=await o.schedule(()=>i.snap({...t,context:n,signal:s}),s);l.valid&&await o.schedule(()=>{this.stagedPoint=l.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=e!=null?e.registerTask(Yn.SNAPPING):Qn}destroy(){this._abortController=Vi(this._abortController),this._frameTask=Xe(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,o=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=o,o}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Vi(this._abortController),this._snapPoints=null}};r([a({constructOnly:!0})],et.prototype,"view",void 0),r([a()],et.prototype,"stagedPoint",null),r([a()],et.prototype,"constrainResult",void 0),r([a()],et.prototype,"_stagedPoint",void 0),et=r([k("esri.views.interactive.snapping.SnappingOperation")],et);function Yi(e){let t,i,n=[],s=!1;function o(...l){return s&&t===this&&Pl(l,n)||(i=e.apply(this,l),t=this,n=l,s=!0),i}return o}function Pl(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const Ts="click";let kl=class{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new Le,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};function Ol(e,t,i,n,s,o){let l="geodesic",c=ga(i);const p=dt();return Ai(e,t,n,p),p[2]=0,c&&ei(p,i,p,c)||(l="euclidean",c=i),{mode:l,view:t,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:e.spatialReference,measurementSR:c,origin:p}}function Ll(e,t,i){if(t==null||e==null)return;const n=Lo(i.measurementSR);if(n==null)return;const s=li(e,i);if(s==null)return;const o=Ui(t,n);return new Cr(s,o)}function Rl(e,t,i,n){if(i==null||e==null)return;const s=li(e,n);if(s==null)return;const o=ht(i),l=10,c=d=>{if(d==null)return;const h=dt(),g=ha(d,"degrees","geographic");return Vr(h,s,n.measurementSR,l,g,n.mode)?new Pr(s,h):void 0},p=()=>{if(t!=null&&e!=null)return ht(kn(t,e))};switch(n.directionMode){case ut.Absolute:return c(o);case ut.Relative:{const d=p();return d==null?void 0:c(d+o)}case ut.RelativeBilateral:{const d=p();return d==null?void 0:Pn([c(d+o),c(d-o)])}}}function xs(e,t){const i=ci(e,t);return i!=null?new Sr(i):void 0}function Ms(e,t,i){const{context:n,longitude:s,latitude:o,direction:l,distance:c,elevation:p}=i;if(s!=null||o!=null||c!=null||p!=null||l!=null){if(s!=null||o!=null){const d=ht(s),h=ht(o),g=ci(p,n);return new Vn(d,h,g)}return Il(e,t,i)}}function Il(e,t,{context:i,direction:n,distance:s,elevation:o}){if(t==null)return xs(o,i);const{view:l,elevationInfo:c,measurementSR:p}=i,d=Ai(t,l,c);if(!p||!ei(d,t.spatialReference,Cs,p))return;const[h,g]=Cs,m=s!=null?Ui(s,"meters"):void 0,v=ht(n),C=ci(o,i),S=A=>{const Z=new kr([h,g],p,m,C,A);return m==null||A==null||C==null&&i.hasZ?Z:new Or(Z.closestTo(d))};if(v==null)return S(void 0);const z=()=>{if(e!=null&&t!=null)return ht(kn(e,t))};switch(i.directionMode){case ut.Absolute:return S(v);case ut.Relative:{const A=z();return A==null?void 0:S(A+v)}case ut.RelativeBilateral:{const A=z();return A==null?void 0:Pn([S(A+v),S(A-v)])}}}function Dl(e){return e.context.mode==="geodesic"?Ms(null,null,e):Es(e)}function Al(e,t,i){const{context:n,x:s,y:o,distance:l,direction:c,elevation:p}=i;return n.mode==="geodesic"?Ms(t,e,i):s!=null||o!=null?Es(i):zl([Ll(e,l,n),Rl(e,t,c,n),xs(p,n)])}function Es({x:e,y:t,elevation:i,context:n}){pi.x=e?.value??0,pi.y=t?.value??0,pi.spatialReference=n.spatialReference;const s=li(pi,n,Bl);return new Vn(e!=null&&s!=null?s[0]:void 0,t!=null&&s!=null?s[1]:void 0,ci(i,n))}function zl(e){let t;for(const i of e)i&&(t=t?.intersect(i)??i);return t}function li(e,t,i=dt()){const{view:n,elevationInfo:s,measurementSR:o,origin:l,mode:c}=t;if(Ai(e,n,s,i),ei(i,e.spatialReference,i,o))return c!=="geodesic"&&jn(i,i,l),i}function Gl(e,t,i,n){const{view:s,measurementSR:o,spatialReference:l,origin:c,mode:p}=i;if(p==="geodesic"?gt(Dt,e):vt(Dt,e,c),ei(Dt,o,Dt,l))return Mr(Dt,s,t,i,n)}function ci(e,t){return Hl(e,t)?.value??void 0}function Hl(e,{view:t,origin:i,elevationInfo:n,hasZ:s,measurementSR:o}){if(e==null||!s)return;const l=Oo(o);if(l==null)return;const[c,p]=i,d=Ui(e,l),h=t?.type==="3d"?Er(t,c,p,d,o,n):d;return h!=null?da(h,l):void 0}const Cs=dt(),Bl=dt(),Dt=dt(),pi=$i(0,0,0,Mt.WGS84);function Ss({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:n,useZ:s=!0}){const o=new ri;if(t==null)return{snappingStep:[ks,o],cancelSnapping:ks};let l,c=null,p=null,d=null;const h=()=>{c=Vi(c),t.doneSnapping(),p?.frameTask.remove(),p=null,l=Xe(l),d=null},g=Fl(t,s,o);let m=null,v=null,C=null;return{snappingStep:[S=>{if(!e(S))return S;const{action:z}=S;if(z==="start"){const{info:A}=S,Z=Nl(t.view);if(p=Zl(i,S,Z),p.context.selfSnappingZ=null,!s&&A!=null){const he=$l(i.coordinateHelper,A.handle.component);he!=null&&(p.context.selfSnappingZ={value:he,elevationInfo:i.elevationInfo??Lr})}}if(p!=null){const{context:A,originalScenePos:Z,originalPos:he}=p,{mapEnd:Pe,mapStart:Ne,scenePoints:le}=S,ke=Vs(he,Qi(Pe,Ne)),Ze=Qi(Ne,he),wi={...S,action:"update"},y=p.context,b=Ul(Z,le),f=t.update({point:ke,scenePoint:b,context:A});if(C=f,Ps(Pe,f,Ze,s),m=ke,v=b,z!=="end"){const{frameTask:I}=p;c==null&&(c=new AbortController),d=$=>{n.addPromise(Re(g({frameTask:I,event:wi,context:y,point:ke,scenePoint:b,delta:Ze,getLastState:()=>({point:m,scenePoint:v,updatePoint:$.forceUpdate?null:C})},c.signal)))},d({forceUpdate:!1}),l==null&&(l=L(()=>t.options.effectiveEnabled,()=>d?.({forceUpdate:!0})))}}return z==="end"&&h(),S},o],cancelSnapping:S=>(h(),S)}}function Fl(e,t,i){return Si(async({frameTask:n,point:s,scenePoint:o,context:l,event:c,delta:p,getLastState:d},h)=>{const g=await n.schedule(()=>e.snap({point:s,scenePoint:o,context:l,signal:h}),h);if(g.valid){let m=await n.schedule(()=>g.apply(),h);const v=d();v.point!=null&&s!==v.point&&(m=e.update({point:v.point,scenePoint:v.scenePoint,context:l})),v.updatePoint!=null&&It(m,v.updatePoint)||(Ps(c.mapEnd,m,p,t),i.execute(c))}})}function Nl(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(Yn.SNAPPING):Qn}function Zl(e,t,i){return{context:new ai({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:i}}function Vs(e,[t,i,n]){const s=Jt(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}function Ul(e,t){return e==null||t==null?null:Vs(e,Qi(t.sceneEnd,t.sceneStart))}function Qi(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function Ps(e,t,[i,n,s],o){e.x=t.x+i,e.y=t.y+n,o&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function $l(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const s of i){const o=e.getZ(s.pos);if(n!=null&&o!=null&&Math.abs(o-n)>1e-6)return null;n==null&&(n=o)}return n}function ks(e){return e}const Wl="crosshair",jl="progress",Os=Symbol(),Ls=Symbol();let w=class extends Le.EventedMixin(ne){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Nr,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new $r,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Yi(Dl),this._getPolylineOrPolygonConstraint=Yi(Al),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new On,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=Rr(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,n="viewingMode"in t.state?t.state.viewingMode:Bn.Local,s=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=Xi(this.hasZ,this.hasM,i),this._editGeometryOperations=new si(new ii(s,this.coordinateHelper),n),this._snappingOperation=new et({view:t}),this.addHandles([L(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:p},d)=>{const{snappingOptions:h}=this;if(h&&(h.forceDisabled=p!=null&&Ir(p)),d!=null&&c===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,p)=>c.stagedPoint===p.stagedPoint&&Ro(c.constraint,p.constraint)}),L(()=>this.view.viewpoint,(c,p)=>{c&&p&&Ur(c,p)&&this._onKeyboardBasedChange()})]),this._activeComponent=new ti(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(L(()=>this.labelOptions.enabled,c=>{o.visible=c},Ct))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{const p=c.vertices.map(v=>({componentIndex:0,vertexIndex:v.index,coordinates:this.coordinateHelper.vectorToArray(v.pos)})),d=p.map(v=>v.coordinates),h=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;It(h,this.firstVertex)||(this.firstVertex=h);const g=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;It(g,this.lastVertex)||(this.lastVertex=g);const m=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(It(m,this.secondToLastVertex)||(this.secondToLastVertex=m),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,{...c,added:d,vertices:p});break;case"vertex-update":this.emit(c.type,{...c,updated:d,vertices:p});break;case"vertex-remove":this.emit(c.type,{...c,removed:d,vertices:p})}}));const l=this._manipulator=new kl({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=e!=="point"&&e!=="multipoint",this.addHandles([l.events.on("immediate-click",c=>this._onImmediateClick(c)),l.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),L(()=>this.drawingMode,()=>{this.removeHandles(Os),this.addHandles(this._createManipulatorDragPipeline(l),Os)},Ct),L(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{l.cursor=c},Ct)]),Dr(this,()=>{const c=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(c);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(Re(d))}})}destroy(){we(this.segmentLabels),we(this._snappingOperation),this._editGeometryOperations=we(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??Ts)}get effectiveCursor(){return this.loading?jl:this._hideDefaultCursor?null:this.cursor||Wl}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:n}=this;return n==="polygon"&&qi(e,i)||qi(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,n=e.slice();return t!=null&&n.push(i.pointToArray(t)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,s=i==="multipoint"&&n===0||i==="polyline"&&n<2||i==="polygon"&&n<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((o,l)=>({componentIndex:0,vertexIndex:l,coordinates:o})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=Pi(this.cursorVertex),i=Pi(e),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),s=this._snapToClosingVertex(n),o=this._applyConstraints(s);qi(t,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return oi(e,(t,i,n,s)=>{const o=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:l,cancelSnapping:c}=Ss({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new ai({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(p=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p)).next(c),i.next(this._screenToMapDragEventStep()).next(p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),p)).next(ws(this.view,this.elevationInfo)).next(...l).next(p=>(o&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p)).next(p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p))})}_createManipulatorDragPipelineFreehand(e){return oi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(e){return oi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Ls),this._processCursor(n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Ls),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:n}=this;return e?t!=null||i==="segment"&&n>0:(i==="segment"||i==="polygon")&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:s}=this;if(n==null)return i;if(!this.hasZ)return n.defaultZ=null,n;const o=this.elevationInfo?.mode;let l=this.defaultZ,c=e||o==="absolute-height";return s!=null&&(c=s),o==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(l=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),c=!1),c?i:(n.defaultZ=l,n)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const n=this._screenToMap(e.screenPoint);if(n==null||n==null||t==="freehand"&&i!=="point"&&i!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(n),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"&&this.geometryType!=="multipoint"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=Nt(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const i=this._snappingOperation,n=this._screenToMap(e),s=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(n==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(n),void i.abort();const l=this._getSnappingContext(t);this._updatingHandles.addPromise(Re(i.snap({point:n,scenePoint:s},o,l)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:n}=i,s=li(e,n),o=s?t.closestTo(s):void 0;if(!o)return e;const l=Gl(o,e,n),c=this.view.type==="2d"||n.elevationInfo.mode!=="absolute-height";return l!=null&&c&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const i=this._screenToMap(t.screenEnd);return i!=null?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return i!=null&&Xl(i,t,25)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new ai({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function Xl(e,t,i){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s<=i}r([a()],w.prototype,"_hideDefaultCursor",void 0),r([a()],w.prototype,"_stagedPointerId",void 0),r([a()],w.prototype,"_isDragging",null),r([a()],w.prototype,"_snappingOperation",void 0),r([a()],w.prototype,"_snappingEnabled",null),r([a({constructOnly:!0})],w.prototype,"graphic",void 0),r([a()],w.prototype,"constraintsEnabled",void 0),r([a()],w.prototype,"constraints",void 0),r([a()],w.prototype,"_constraint",null),r([a()],w.prototype,"constraintZ",void 0),r([a()],w.prototype,"defaultZ",void 0),r([a()],w.prototype,"isDraped",void 0),r([a({value:Ts})],w.prototype,"drawingMode",null),r([a({constructOnly:!0})],w.prototype,"elevationDrawSurface",void 0),r([a({constructOnly:!0})],w.prototype,"elevationInfo",void 0),r([a({constructOnly:!0,type:On})],w.prototype,"labelOptions",void 0),r([a({constructOnly:!0})],w.prototype,"geometryType",void 0),r([a({constructOnly:!0})],w.prototype,"hasM",void 0),r([a({constructOnly:!0})],w.prototype,"hasZ",void 0),r([a()],w.prototype,"cursor",void 0),r([a()],w.prototype,"effectiveCursor",null),r([a()],w.prototype,"loading",void 0),r([a({constructOnly:!0})],w.prototype,"manipulators",void 0),r([a({constructOnly:!0})],w.prototype,"drawSurface",void 0),r([a({constructOnly:!0})],w.prototype,"segmentLabels",void 0),r([a({constructOnly:!0})],w.prototype,"snappingManager",void 0),r([a({constructOnly:!0})],w.prototype,"snappingVisualizer",void 0),r([a()],w.prototype,"snapToSceneEnabled",void 0),r([a({readOnly:!0})],w.prototype,"cursorVertex",null),r([a({readOnly:!0})],w.prototype,"visualizationCursorVertex",null),r([a()],w.prototype,"committableVertex",null),r([a()],w.prototype,"firstVertex",void 0),r([a()],w.prototype,"lastVertex",void 0),r([a()],w.prototype,"secondToLastVertex",void 0),r([a()],w.prototype,"updating",null),r([a({constructOnly:!0})],w.prototype,"view",void 0),w=r([k("esri.views.draw.DrawOperation")],w);let ql=class{constructor(e,t,i,n=null){this._elevationInfo=e,this.defaultZ=t,this._view=i,this._excludeGraphics=n}screenToMap(e){const{defaultZ:t,_view:i}=this,n=i.sceneIntersectionHelper.intersectElevationFromScreen(Io(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&n!=null&&(n.z=void 0),n}mapToScreen(e){const t=$i(e.x,e.y,Ln(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=Jt(e)).z=t),e}},Kl=class{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=jt(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=$i(e.x,e.y,Ln(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Yl=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=n=>e.toScreen(n),this.screenToMap=t?n=>{const s=e.toMap(n);return s.z=i,s}:n=>e.toMap(n)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=Jt(e)).z=t),e}},Ji=class uo{screenToMap(t){const{x:i,y:n}=t;return new F({x:i,y:n,spatialReference:uo.spatialReference})}mapToScreen(t){return Nt(t.x,t.y)}constrainZ(t){return t}};Ji.spatialReference=new Mt;function di(e,t,i=null){return i!=null?[e,t,i]:[e,t]}function R(e,t,i=null){return i!=null?{x:e,y:t,z:i}:{x:e,y:t}}let Rs=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(se)}get doUnnormalization(){return!1}};class Is extends Rs{constructor(t,i,n=null){super(i),this._defaultZ=n,this.transform=Gn(),this.transformInv=Gn(),this.transform=Br(t),ya(this.transformInv,this.transform)}makeMapPoint(t,i){return di(t,i,this._defaultZ)}mapToLocal(t){return R(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return di(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}let Ql=class extends Rs{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=E(),this.tangentFrameUpWS=E(),this.tangentFrameRightWS=E(),this.tangentFrameForwardWS=E(),this.localFrameRightWS=E(),this.localFrameUpWS=E(),this.worldToLocalTransform=Jn(),this.localToWorldTransform=Jn(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ki.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ki.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,ki.Z,this.tangentFrameForwardWS);const n=E();Bi(n,this.tangentFrameForwardWS,Yt(i,this.tangentFrameForwardWS)),jn(this.localFrameRightWS,i,n),mt(this.localFrameRightWS,this.localFrameRightWS),yt(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ma(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),va(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return di(e,t,this.defaultZ)}mapToLocal(e){const t=E();this.view.renderCoordsHelper.toRenderCoords(new F({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Xn(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new F({spatialReference:this.view.spatialReference}));return i!=null?R(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=E();this.view.renderCoordsHelper.toRenderCoords(new F({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Xn(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new F({spatialReference:this.view.spatialReference}));return i!=null?di(i.x,i.y,this.defaultZ):null}};function Jl(e,t){if(e.type==="2d")return new Is(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const i=t.length>2?new F({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new F({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Ql(e,i)}return null}const Ds={absolute:"absolute-direction",relative:"relative-direction"},ec={hide:"hide",hideChildren:"hide-children"};function hi(e){return e?.listMode??void 0}function tc(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function ic(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function nc(e){if(!e)return"inherited";const t=oc(Gs(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function As(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function en(e){return hi(e)!==ec.hide}function sc(e,t){if(!e||t==null||isNaN(t))return!1;const i=tc(e),n=ic(e),s=i!=null&&!isNaN(i)&&i>0&&t>i,o=n!=null&&!isNaN(n)&&n>0&&t<n;return s||o}function zs(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function Gs(e){return e!=null&&"layer"in e&&e.layer!=null}function oc(e){const t=rc(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function rc(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}let X=class extends gn.IdentifiableMixin(Ee){constructor(e,t){super(e,t),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([L(()=>this._canCreateLegend,()=>this._createLegend(),ce),L(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),ce)])}destroy(){this._legend=we(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e?.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||e.type==="subtype-sublayer")return null;const t=Gs(e)?e:null,i=e?.parent,n=i!=null&&"type"in i&&i.type==="map-image"?t?.source:null,s="";return n&&i?{layer:i,title:s,sublayerIds:[n.mapLayerId]}:{layer:e,title:s}}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!t.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return u("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:n}=this;return e&&!i&&n?e==="legend"&&t?u("div",{key:"legend-widget"},t.render()):typeof e=="string"?u("div",{innerHTML:e,key:e}):Hn(e)?u("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?u("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e):null}async _createLegend(){if(we(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await import("./Legend-DJR2cQsA.js"),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:Hn(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};r([a()],X.prototype,"_legend",void 0),r([a()],X.prototype,"_canCreateLegend",null),r([a()],X.prototype,"_legendOptions",null),r([a()],X.prototype,"_legendLayerInfo",null),r([a()],X.prototype,"className",void 0),r([a()],X.prototype,"content",void 0),r([a()],X.prototype,"disabled",null),r([a()],X.prototype,"flowEnabled",void 0),r([a()],X.prototype,"icon",null),r([a()],X.prototype,"image",void 0),r([a()],X.prototype,"listItem",void 0),r([a()],X.prototype,"open",void 0),r([a()],X.prototype,"title",null),r([a()],X.prototype,"visible",void 0),X=r([k("esri.widgets.LayerList.ListItemPanel")],X);const Hs=X;var At;const ac=_e.ofType({key:"type",defaultKeyValue:"button",base:Do,typeMap:{button:Ao,toggle:zo}}),Bs=_e.ofType(ac),tn="layer",ui="child-list-mode",lc="hide";let O=At=class extends gn.IdentifiableMixin(ne){constructor(e){super(e),this.actionsSections=new Bs,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(_e.ofType(At)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([L(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),ce),L(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),ce),L(()=>this.view,e=>this._updateChildrenView(e),ce),L(()=>this.panel,e=>this._setListItemOnPanel(e),ce)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){const{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;const i=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>n.layer===i)??null}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new Hs(e):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=Zt(this,"layer.layer");return(!e||e&&Zt(this,"layer.layer.loaded"))&&Zt(this,"layer.title")||Zt(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&e.publishingInfo?.status==="publishing")}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:n}=this;return!n&&!t&&(e?e.updating:i?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!sc(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return nc(this.layer)}clone(){return new At({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_createChildren(e){const{listModeDisabled:t,children:i}=this,n=e.filter(s=>!i.some(o=>o.layer===s));i.addMany(this._createChildItems(n,t))}_destroyChildren(e){const{children:t}=this,i=t.filter(n=>!!n.layer&&!e.includes(n.layer));t.destroyMany(i)}_sortChildren(e){this.children.sort((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(ui),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(ui),this.listModeDisabled||this.addHandles(e.toArray().map(t=>L(()=>t.listMode,()=>this._compileChildren(e))),ui)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(i=>hi(i)!==lc);e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),tn)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(i=>t||en(i)?new At({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(se)}_watchLayerProperties(e){if(this.removeHandles(tn),this.removeHandles(ui),!e)return;if((!this.listModeDisabled&&hi(e))==="hide-children")return void this.children.destroyAll();const t=As(e);t&&this.addHandles(L(()=>e[t],i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)},ce),tn)}};r([a({type:Bs})],O.prototype,"actionsSections",void 0),r([a()],O.prototype,"actionsOpen",void 0),r([a()],O.prototype,"checkPublishStatusEnabled",void 0),r([a({type:_e.ofType(O)})],O.prototype,"children",void 0),r([a()],O.prototype,"childrenSortable",void 0),r([a({readOnly:!0})],O.prototype,"connectionStatus",null),r([a({readOnly:!0})],O.prototype,"error",null),r([a()],O.prototype,"hidden",void 0),r([a({readOnly:!0})],O.prototype,"incompatible",null),r([a()],O.prototype,"layer",void 0),r([a({readOnly:!0})],O.prototype,"layerView",null),r([a()],O.prototype,"listItemCreatedFunction",void 0),r([a({nonNullable:!0})],O.prototype,"listModeDisabled",void 0),r([a()],O.prototype,"open",void 0),r([a({type:Hs})],O.prototype,"panel",void 0),r([yn("panel")],O.prototype,"castPanel",null),r([a()],O.prototype,"parent",void 0),r([a({value:!0})],O.prototype,"sortable",null),r([a()],O.prototype,"title",null),r([a({readOnly:!0})],O.prototype,"publishing",null),r([a({readOnly:!0})],O.prototype,"updating",null),r([a()],O.prototype,"view",void 0),r([a()],O.prototype,"visible",null),r([a({readOnly:!0})],O.prototype,"visibleAtCurrentScale",null),r([a({readOnly:!0})],O.prototype,"visibleAtCurrentTimeExtent",null),r([a({readOnly:!0})],O.prototype,"visibilityMode",null),O=At=r([k("esri.widgets.LayerList.ListItem")],O);const nn=O;let pe=class extends ne{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};r([a({type:Boolean,nonNullable:!0})],pe.prototype,"colorSelection",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"dynamicScaleToggle",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"gridEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"numericInputs",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"gridSnapEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"lineIntervalInput",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"outOfScaleWarning",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"placementButtons",void 0),r([a({type:Boolean,nonNullable:!0})],pe.prototype,"rotateWithMapToggle",void 0),pe=r([k("esri.widgets.support.GridControls.VisibleElements")],pe);const sn=pe;let de=class extends ne{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new sn({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};r([a({type:Boolean,nonNullable:!0})],de.prototype,"enabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"featureEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"gridEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"header",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"layerList",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"gridControls",void 0),r([a({type:sn,nonNullable:!0})],de.prototype,"gridControlsElements",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"layerListToggleLayersButton",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"selfEnabledToggle",void 0),de=r([k("esri.widgets.support.SnappingControls.VisibleElements")],de);const gi=de,on=()=>Ie({icon:()=>import("./index-BqjMOTz2.js").then(e=>e.i),label:()=>import("./index-BKwTZL9-.js"),switch:()=>import("./index-D8BWhq8s.js"),tooltip:()=>import("./index-CdjOLMHU.js")}),zt="esri-labeled-switch",Gt={label:`${zt}__label`,labelContent:`${zt}__label-content`,iconInfo:`${zt}__icon_info`,iconWarning:`${zt}__icon_warning`,tooltip:`${zt}__tooltip`};function tt({checked:e,disabled:t,hint:i,key:n,label:s,onChange:o,hintIcon:l,hintKind:c}){return u("calcite-label",{class:Gt.label,disabled:t,key:n,layout:"inline-space-between",scale:"s"},i?u("div",{class:Gt.labelContent,key:"label-content"},u("div",null,s),u("calcite-icon",{class:c!=="warning"?Gt.iconInfo:Gt.iconWarning,icon:l??"information",id:n,scale:"s",tabIndex:0}),u("calcite-tooltip",{class:Gt.tooltip,overlayPositioning:"fixed",referenceElement:n},i)):s,u("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:p=>o(p.currentTarget.checked)}))}let it=class extends ne{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};r([a({type:Boolean,nonNullable:!0})],it.prototype,"directionModePicker",void 0),r([a({type:Boolean,nonNullable:!0})],it.prototype,"header",void 0),r([a({type:Boolean,nonNullable:!0})],it.prototype,"labelsToggle",void 0),r([a({type:Boolean,nonNullable:!0})],it.prototype,"tooltipsToggle",void 0),it=r([k("esri.widgets.support.SketchTooltipControls.VisibleElements")],it);const rn=it,Ht="esri-sketch-tooltip-controls",yi={base:Ht,block:`${Ht}__block`,blockContent:`${Ht}__block-content`,hintIcon:`${Ht}__hint-icon`,radioButtonLabelWrapper:`${Ht}__radio-button-label-wrapper`};let ze=class extends Ee{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new rn,this.sketchOptions=new Rn,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([Ie({block:()=>import("./index-D3TCQkBM.js"),label:()=>import("./index-BKwTZL9-.js"),icon:()=>import("./index-BqjMOTz2.js").then(e=>e.i),"radio-button":()=>import("./index-nRElBlx3.js"),"radio-button-group":()=>import("./index-BkvYaLeq.js")}),on()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return u("div",{"aria-label":e,class:this.classes(yi.base,zi.widget)},i?u("calcite-block",{class:yi.block,heading:t.header?this.label:"",key:"content-block",label:this.label,open:!0},u("div",{class:yi.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(se);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return u(tt,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return u(tt,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return u("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,u("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return u("calcite-label",{key:e,layout:"inline",scale:"s"},u("calcite-radio-button",{checked:e===t,scale:"s",value:e}),u("div",{class:yi.radioButtonLabelWrapper,key:"label-wrapper"},u("calcite-icon",{icon:Ds[e],scale:"s"}),i))}};r([a()],ze.prototype,"label",null),r([a({type:rn,nonNullable:!0})],ze.prototype,"visibleElements",void 0),r([a(),De("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],ze.prototype,"messages",void 0),r([a({nonNullable:!0,type:Rn})],ze.prototype,"sketchOptions",void 0),r([a({type:String})],ze.prototype,"viewType",void 0),ze=r([k("esri.widgets.support.SketchTooltipControls")],ze);const cc=ze,ue={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},pc="hide",Fs=_e.ofType(nn);let be=class extends Le.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new Fs,this.view=null}initialize(){this.addHandles([L(()=>this.view?.ready===!0,()=>this._viewHandles(),ce),L(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),L(()=>es(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],ue.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,n){const s=e?.layer;if(!s||s.type==="subtype-sublayer"||s.type==="sublayer")return;const o=this.view?.map?.layers,l=t?zs(t):o,c=i?zs(i):o;if(!l||!c)return;const{operationalItems:p}=this,d=t?.children||p,h=i?.children||p,g=c.length-n;e.parent=i||null,d.remove(e),l.remove(s),h.includes(e)||h.add(e,g),c.includes(s)||c.add(s,g),this._compileList()}_createLayerViewHandles(e){this.removeHandles(ue.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ue.layerViews)}_createMapLayerHandles(e){this.removeHandles(ue.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ue.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:n,listModeDisabled:s}=this;return new nn({checkPublishStatusEnabled:n,listModeDisabled:s,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>hi(t)!==pc):void 0}_watchLayersListMode(e){this.removeHandles(ue.layerListMode),e&&!this.listModeDisabled&&this.addHandles(L(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),ue.layerListMode)}_compileList(){const e=this.view?.map?.layers,t=es(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:n})=>n==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(n=>n.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(n=>{n&&e&&e.includes(n.layer)||i.push(n)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,n)=>{const s=e.indexOf(i.layer),o=e.indexOf(n.layer);return s>o?-1:s<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([ue.mapLayers,ue.layerViews,ue.viewLayers]),e?.ready?this.addHandles([L(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),ce),L(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),ce)],ue.viewLayers):this._removeAllItems()}};r([a()],be.prototype,"checkPublishStatusEnabled",void 0),r([a()],be.prototype,"listItemCreatedFunction",void 0),r([a({nonNullable:!0})],be.prototype,"listModeDisabled",void 0),r([a({type:Fs})],be.prototype,"operationalItems",void 0),r([a({readOnly:!0})],be.prototype,"state",null),r([a()],be.prototype,"totalItems",null),r([a()],be.prototype,"view",void 0),be=r([k("esri.widgets.LayerList.LayerListViewModel")],be);const dc=be,an=e=>hc(e)||uc(e),hc=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},uc=e=>{const t=As(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(const i of e[t])if(an(i))return!0}return!1},mi=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(i=>mi(i,t)!==!1)&&"children");var ln;let Se=ln=class extends nn{constructor(e){super(e),this.children=new _e,this.parent=null}get enabled(){const{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const n of e){if(n.enabled==="indeterminate")return n.enabled;if(n.enabled==="enabled"?t=!0:n.enabled==="disabled"&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(i=>i.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(an);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>en(t)?new ln({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(se).reverse()}};r([a()],Se.prototype,"enabled",null),r([a()],Se.prototype,"children",void 0),r([a()],Se.prototype,"childLayerIds",null),r([a()],Se.prototype,"featureSource",null),r([a({constructOnly:!0})],Se.prototype,"getFeatureSnappingSources",void 0),r([a()],Se.prototype,"parent",void 0),Se=ln=r([k("esri.widgets.support.SnappingControls.SnappingListItem")],Se);let nt=class extends dc{constructor(){super(...arguments),this.featureSnappingSources=new _e}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(an);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new Se({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};r([a()],nt.prototype,"featureSnappingSources",void 0),r([a()],nt.prototype,"operationalItems",void 0),r([a()],nt.prototype,"operationalItemsFlat",null),r([a()],nt.prototype,"selectableItems",null),nt=r([k("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],nt);let Te=class extends ne{constructor(e){super(e),this.layerListViewModel=new nt,this.snappingOptions=new In,this.view=null}initialize(){this.addHandles([L(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},ce),L(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},ce)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(i=>t?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const i=t?.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)en(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(n=>n.layer?.id===e)?.layer;if(!t)throw new Go("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;const i=new Ar({layer:t});return this.snappingOptions.featureSources.add(i),i}};r([a()],Te.prototype,"allLayersEnabled",null),r([a()],Te.prototype,"allLayersDisabled",null),r([a({constructOnly:!0})],Te.prototype,"layerListViewModel",void 0),r([a()],Te.prototype,"layersEnabledCount",null),r([a({type:In,nonNullable:!0})],Te.prototype,"snappingOptions",void 0),r([a()],Te.prototype,"state",null),r([a()],Te.prototype,"view",void 0),Te=r([k("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],Te);const gc=Te,ge="esri-snapping-controls",ye={base:ge,container:`${ge}__container`,item:`${ge}__item`,toggleBlock:`${ge}__toggle-block`,layerListBlock:`${ge}__layer-list-block`,layerList:`${ge}__layer-list`,layerListFilter:`${ge}__layer-list__filter`,layerListButton:`${ge}__layer-list__button`,layerListItem:`${ge}__layer-list__item`,layerListGroup:`${ge}__layer-list__group`,nestedContainer:`${ge}__nested-container`};let N=class extends Ee{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new gi,this._enableSnappingSwitchChange=o=>{this.snappingOptions.enabled=o},this._featureEnabledSwitchChange=o=>{this.snappingOptions.featureEnabled=o},this._gridEnabledSwitchChange=o=>{this.snappingOptions.gridEnabled=o,o&&this._startLoadGrid()},this._selfEnabledSwitchChange=o=>{this.snappingOptions.selfEnabled=o},this._onToggleLayersButtonClick=o=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),Gr(o.target)};const{snappingOptions:i,view:n,viewModel:s}=e;this.viewModel=s??(this._defaultViewModel=new gc({snappingOptions:i,view:n}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:n,...s}=e;return s}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=we(this._defaultViewModel))}loadDependencies(){return Promise.all([Ie({block:()=>import("./index-D3TCQkBM.js"),button:()=>import("./index-BgwlXFtK.js"),input:()=>import("./index-E1xQLISi.js"),list:()=>import("./index-Cu3USWUK.js"),"list-item":()=>import("./index-BMRJ0JZH.js"),checkbox:()=>import("./index-BREOFc0M.js"),loader:()=>import("./index-Vn1wRGpv.js")}),on()])}initialize(){this.addHandles(L(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=we(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return u("div",{"aria-label":e,class:this.classes(ye.base,zi.widget)},u("div",{class:ye.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&t?.type==="2d"?this._renderGridEnabledToggle():null].filter(se),n=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?u("div",{class:ye.nestedContainer},i):null].filter(se);return n.length===0?null:u("calcite-block",{class:ye.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",label:this.label,open:!0},n)}_renderEnabledToggle(){return u(tt,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return u(tt,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return u(tt,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return u(tt,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?u("calcite-input",{class:ye.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:l}})=>{this._layerListFilter=l===""?null:new RegExp(l,"i")}}):null,n=this._secondaryElementsDisabled,s=this.layerListOpen&&!n,o=t.layerListViewModel.operationalItems?.find(l=>!!l.children.length);return u("calcite-block",{class:ye.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:s,onCalciteBlockToggle:l=>this.layerListOpen=l.currentTarget.open},i,this._renderToggleLayersButton(),u("calcite-list",{class:ye.layerList,displayMode:o?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:i,snappingOptions:n,_openAndReady:s}=this,{gridEnabled:o,enabled:l}=n;(s||e?.type==="2d"&&e.grid)&&this._startLoadGrid();const c=this._gridLoadTask?.value,p=c&&e?.type==="2d"&&u(c,{snappingManager:i,snappingOptions:n,view:e,visibleElements:t.gridControlsElements});return u("calcite-block",{class:ye.layerListBlock,collapsible:!0,disabled:!o||!l,heading:this.messages.gridOptionsHeading,key:"grid-block",open:s,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},p??u("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=mn(async()=>(await import("./GridControls-pGa_wb5g.js")).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(i=>{switch(t?mi(i,t):null){case"children":{const n=i.children.filter(s=>mi(s,t)!==!1);return this._renderLayerListItemGroup(i,n)}case"self":case null:return this._renderLayerListItemOrGroup(i);case!1:return mi(i.parent,t)==="self"?this._renderLayerListItemOrGroup(i):null}}).toArray().filter(se)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return u("calcite-button",{appearance:"transparent",class:ye.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,n=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return u("calcite-list-item",{class:ye.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:s=>{s.stopPropagation(),n()}},u("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:n}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:n,title:s}=e,o=s||i.untitledLayer,l=s&&s!==""?s:Ho(),c=!!t?.length,p=t??n,d=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},h=p?.find(g=>!!g.children.length);return u("calcite-list-item",{class:ye.layerListGroup,key:l,label:o,open:c,onCalciteListItemSelect:g=>{g.stopPropagation(),d()}},u("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:d}),u("calcite-list",{displayMode:h?"nested":"flat",label:i?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(p)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};r([a()],N.prototype,"_defaultViewModel",void 0),r([a()],N.prototype,"_layerListFilter",void 0),r([a()],N.prototype,"_gridLoadTask",void 0),r([a()],N.prototype,"_openAndReady",null),r([a()],N.prototype,"label",null),r([a({type:Boolean,nonNullable:!0})],N.prototype,"layerListOpen",void 0),r([a({type:Boolean,nonNullable:!0})],N.prototype,"gridOptionsOpen",void 0),r([a(),De("esri/widgets/support/SnappingControls/t9n/SnappingControls")],N.prototype,"messages",void 0),r([a(),De("esri/t9n/common")],N.prototype,"messagesCommon",void 0),r([a()],N.prototype,"snappingOptions",null),r([a()],N.prototype,"snappingManager",void 0),r([a()],N.prototype,"view",null),r([a()],N.prototype,"viewModel",null),r([a({type:gi,nonNullable:!0})],N.prototype,"visibleElements",void 0),r([a()],N.prototype,"_enabledToggleDisabled",null),r([a()],N.prototype,"_secondaryElementsDisabled",null),N=r([k("esri.widgets.support.SnappingControls")],N);const yc=N;let re=class extends ne{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};r([a({type:Boolean,nonNullable:!0})],re.prototype,"point",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"polyline",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"polygon",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"rectangle",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"circle",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"multipoint",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"mesh",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"freehandPolyline",void 0),r([a({type:Boolean,nonNullable:!0})],re.prototype,"freehandPolygon",void 0),re=r([k("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],re);let st=class extends ne{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};r([a({nonNullable:!0})],st.prototype,"rectangle-selection",void 0),r([a({nonNullable:!0})],st.prototype,"lasso-selection",void 0),r([a({nonNullable:!0})],st.prototype,"custom-selection",void 0),st=r([k("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],st);let q=class extends ne{constructor(e){super(e),this.createTools=new re,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new st,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new gi,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};r([a({type:re,nonNullable:!0})],q.prototype,"createTools",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"directionModePicker",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"duplicateButton",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"deleteButton",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"selectionCountLabel",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"labelsToggle",void 0),r([a({type:st,nonNullable:!0})],q.prototype,"selectionTools",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"settingsMenu",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"snappingControls",void 0),r([a({type:gi,nonNullable:!0})],q.prototype,"snappingControlsElements",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"tooltipsToggle",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"undoRedoMenu",void 0),q=r([k("esri.widgets.Sketch.VisibleElements")],q);const K={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},Ns={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function Zs(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(i=>Zs(i,t))??[]}const cn=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(i){const n=this._get("measurementManager");i!==n&&(n&&n.managedElements.remove(this),this._set("measurementManager",i),i?.managedElements.add(this))}set budgetedLength(i){this.budgetedLength!==i&&(this._set("budgetedLength",i),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(i=>Zs(i,"calcite-action"))??[]}get activeChildElement(){const i=this.actionChildren.find(n=>n.properties?.active===!0);return i?(this._set("lastActiveKey",i.properties?.key),i):this.lastActiveKey?this.actionChildren.find(n=>n.properties?.key===this.lastActiveKey):void 0}_handleClick(i){i?.dataset&&"dataset"in i&&i.dataset.actionKey&&(this.lastActiveKey=i.dataset.actionKey)}};return r([a()],t.prototype,"priority",void 0),r([a()],t.prototype,"measurementManager",null),r([a()],t.prototype,"budgetedLength",null),r([a()],t.prototype,"actionChildren",null),r([a()],t.prototype,"activeChildElement",null),r([a()],t.prototype,"scale",void 0),r([a()],t.prototype,"slot",void 0),r([a()],t.prototype,"lastActiveKey",void 0),r([a()],t.prototype,"layout",void 0),t=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t},Us=Symbol("on-resize-handle-key");let ot=class extends cn(Ee){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return u("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(Hr(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),Us)},afterRemoved:()=>this.removeHandles(Us)},this.children)}};r([a()],ot.prototype,"_measuredWidth",void 0),r([a()],ot.prototype,"_measuredHeight",void 0),r([a()],ot.prototype,"lengthOptions",null),r([a()],ot.prototype,"_measuredElement",void 0),ot=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],ot);const mc=ot;let Ge=class extends cn(Ee){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return Ie({action:()=>import("./index-DjUNdREK.js"),"action-group":()=>import("./index-D9xNACT4.js").then(e=>e.i),"action-menu":()=>import("./index-LZyz9ov8.js").then(e=>e.i)})}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?K.groupSeparator+K.action[t]*Math.min(e.length,2):K.groupSeparator+K.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:n,priority:s}=this,o=[i];if(e.length<=2||!n||s<1)return o;for(let l=1;l<e.length-1;l++)o.push(i+K.action[t]*l);return o}render(){if(!this.actionChildren.length)return u(zn,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:n,slot:s,scale:o}=this,l=Math.floor(e/K.action[o]),c=[],p=[];if(l>=t.length)c.push(...t);else{const d=i??c.at(0);if(c.push(...t.slice(0,l-1)),p.push(...t.slice(l-1)),d&&p.includes(d)){const[h]=p.splice(p.indexOf(d),1),g=c.pop();c.push(h),g&&p.unshift(g)}}return u("calcite-action-group",{key:"overflow-button-group",layout:n,onclick:d=>this._handleClick(d.target),slot:s},c.map(d=>this._renderManagedAction(d)),p.length>0?u("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},u("calcite-action",{icon:Ns.overflow,key:"split-button-dropdown-trigger",scale:o,slot:"trigger",text:this.messagesCommon.more}),p.map(d=>this._renderManagedAction(d))):void 0)}_renderManagedAction(e){return u("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};Ge.vnodeSelector="calcite-action-group",r([a()],Ge.prototype,"allowCollapse",void 0),r([a()],Ge.prototype,"minimumLength",null),r([a(),De("esri/t9n/common")],Ge.prototype,"messagesCommon",void 0),r([a()],Ge.prototype,"lengthOptions",null),Ge=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],Ge);const vc=Ge;let He=class extends ne{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new _e,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let n=0;for(const s of i){const o=s.lengthOptions[0];e.set(s,o),n+=o}for(const s of i)for(;n<t;){const o=e.get(s);if(!o)break;const l=s.lengthOptions.find(p=>p>o);if(!l)break;const c=n-o+l;if(c>t)break;e.set(s,l),n=c}for(const[s,o]of e)s.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};r([a()],He.prototype,"measuredElement",void 0),r([a()],He.prototype,"managedElements",void 0),r([a()],He.prototype,"_sortedElements",null),r([a()],He.prototype,"availableLength",void 0),r([a()],He.prototype,"layout",void 0),He=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],He);const fc=He,_c={base:"esri-split-button",splitButtonBase:"esri-split-button--split-part"};let rt=class extends cn(Ee){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return Ie({action:()=>import("./index-DjUNdREK.js"),"action-group":()=>import("./index-D9xNACT4.js").then(e=>e.i),"action-menu":()=>import("./index-LZyz9ov8.js").then(e=>e.i)})}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?K.action[this.scale]+K.groupSeparator:K.action[this.scale]+K.splitButtonPart[this.layout][this.scale]+K.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:n,priority:s}=this;if(e.length<2||s<0)return[t];const o=K.groupSeparator+K.action[n]*e.length;return[K.groupSeparator+K.action[n]+K.splitButtonPart[i][n],o]}render(){if(!this.actionChildren.length)return u(zn,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:n,slot:s}=this,o=e.length<2||i>t;return u("calcite-action-group",{key:"split-button-group",layout:n,onclick:l=>this._handleClick(l.target),slot:s},o?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:n,messagesCommon:s}=this,o=e??i.at(0);if(!o)return;const l=i.filter(c=>c!==o);return[this._renderManagedAction(o),u("calcite-action-menu",{key:"split-button-dropdown",label:s.more,overlayPositioning:"fixed",placement:t==="horizontal"?"bottom-end":"right-end"},u("calcite-action",{class:`${_c.splitButtonBase}--${t}--${this.scale}`,compact:t==="horizontal",icon:Ns.splitButton[t],key:"split-button-dropdown-trigger",scale:n,slot:"trigger",text:s.more}),l?.map(c=>this._renderManagedAction(c)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return u("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};rt.vnodeSelector="calcite-action-group",r([a()],rt.prototype,"minimumLength",null),r([a()],rt.prototype,"lengthOptions",null),r([a(),De("esri/t9n/common")],rt.prototype,"messagesCommon",void 0),rt=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],rt);const me="esri-responsive-toolbar",ve={rulerBase:`${me}__ruler`,rulerBarHorizontal:`${me}__ruler--bar`,rulerBarVertical:`${me}__ruler--bar--vertical`,rulerPadVertical:`${me}__ruler--pad--vertical`,rulerPadHorizontal:`${me}__ruler--pad--horizontal`,bar:`${me}__bar`,barHorizontal:`${me}__bar--horizontal`,barVertical:`${me}__bar--vertical`,pad:`${me}__pad`,padVertical:`${me}__pad--vertical`,padHorizontal:`${me}__pad--horizontal`};let Be=class extends Ee{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new fc,this._managedWidgets=new Map}loadDependencies(){return Ie({"action-bar":()=>import("./index-Bw3mB3un.js"),"action-pad":()=>import("./index-D5QixMM4.js")})}destroy(){this._measurementManager=we(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}render(){const{layout:e,scale:t,barStyle:i}=this,n={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},s=i==="docked"?e==="vertical"?ve.rulerBarVertical:ve.rulerBarHorizontal:e==="horizontal"?ve.rulerPadHorizontal:ve.rulerPadVertical;return u("div",null,u("div",{afterCreate:o=>{this._measurementManager?.connect(o)},class:this.classes(ve.rulerBase,s)}),i==="docked"?u("calcite-action-bar",{...n,classes:{[ve.barHorizontal]:this.layout==="horizontal",[ve.barVertical]:this.layout==="vertical",[ve.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):u("calcite-action-pad",{...n,class:this.classes(ve.pad,e==="horizontal"?ve.padHorizontal:ve.padVertical)},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(n=>n.properties?.key!==void 0&&"group-kind"in n.properties),t=new Set,i=e.map(n=>{const s=n.properties,o=s.key;t.add(o);const l=this.barStyle==="docked"?s.slot??void 0:void 0,c=s.priority??0,p=s["group-kind"]??"overflow-group",d=s["allow-collapse"]??!0,h=this._managedWidgets.get(o);if(h)return h.children=n.children,h.priority=c,"allowCollapse"in h&&(h.allowCollapse=d),h.slot=l,h.layout=this.layout,h.scale=this.scale,h.measurementManager=this._measurementManager,h;const g={scale:this.scale,priority:c,measurementManager:this._measurementManager,children:n.children,slot:l,layout:this.layout};switch(p){case"split-button":{const m=new rt({...g});return this._managedWidgets.set(o,m),m}case"overflow-group":{const m=new vc({...g,allowCollapse:d});return this._managedWidgets.set(o,m),m}case"measured-content":{const m=new mc({...g});return this._managedWidgets.set(o,m),m}}}).filter(se);return Array.from(this._managedWidgets.keys()).filter(n=>!t.has(n)).forEach(n=>{this._managedWidgets.get(n)?.destroy(),this._managedWidgets.delete(n)}),this._measurementManager?.allocate(),i.map(n=>n.render())}};r([a()],Be.prototype,"scale",void 0),r([a({value:"horizontal"})],Be.prototype,"layout",null),r([a()],Be.prototype,"barStyle",void 0),r([a()],Be.prototype,"_measurementManager",void 0),r([a()],Be.prototype,"_managedWidgets",void 0),Be=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],Be);const $s=Be;function at(e,t){const i=new F({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function wc(e,t){return new Bo({points:e,spatialReference:t})}function bc(e,t,i){const n=new Me({paths:e,spatialReference:t});return i&&vn(n),n}function Bt(e,t,i,n=!0){const s=Pi(e);s.forEach(l=>{const c=l[0],p=l[l.length-1];Et(c,p)&&l.length!==1||l.push(l[0])});let o=new J({rings:s,spatialReference:t});return o.rings.forEach(l=>{fn(l)||l.reverse()}),i&&vn(o),n&&o.isSelfIntersecting&&_n(t)&&(o=ns(o)),o}function Ws(e,t,i){const n=t.mapToLocalMultiple(e),s=[],o={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y},c=Math.round(l.x-o.x),p=Math.round(l.y-o.y),d=Math.max(Math.abs(c),Math.abs(p));if(i){const h={x:o.x+d,y:o.y+d},g={x:o.x-d,y:o.y-d};s.push(R(h.x,g.y),R(g.x,g.y),R(g.x,h.y),R(h.x,h.y))}else{const h={x:c>0?o.x+d:o.x-d,y:p>0?o.y+d:o.y-d};s.push(R(o.x,o.y),R(h.x,o.y),R(h.x,h.y),R(o.x,h.y))}return Xs(Bt([s.map(h=>t.localToMap(h)).filter(se)],t.spatialReference,t.doUnnormalization,!0),s,t)}function js(e,t,i){let n=t.mapToLocalMultiple(e);if(n.length===1){const c=n[0];n=[R(c.x-48,c.y+48),R(c.x+48,c.y-48),R(c.x+48,c.y-48),R(c.x-48,c.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y};if(i){const c=Math.round(l.x-o.x),p=Math.round(l.y-o.y);s.push(R(o.x-c,o.y-p),R(l.x,o.y-p),R(l.x,l.y),R(o.x-c,l.y))}else s.push(R(o.x,o.y),R(l.x,o.y),R(l.x,l.y),R(o.x,l.y));return Xs(Bt([s.map(c=>t.localToMap(c)).filter(se)],t.spatialReference,t.doUnnormalization,!0),s,t)}function Xs(e,t,i){const n=vi(t[3],t[2],i),s=vi(t[1],t[2],i),o=vi(t[0],t[1],i),l=vi(t[0],t[3],i);return{geometry:e,midpoints:n!=null&&s!=null&&o!=null&&l!=null?{top:n,right:s,bottom:o,left:l}:null}}function vi(e,t,i){_t[0]=e.x,_t[1]=e.y,_t[2]=0,wt[0]=t.x,wt[1]=t.y,wt[2]=0,Gi(_t,_t,wt,.5),fi.x=_t[0],fi.y=wt[1],fi.z=wt[2];const n=i.localToMap(fi);return n!=null?at(n,i.spatialReference):null}const fi=R(0,0,0),_t=E(),wt=E();function qs(e,t,i,n){const s=t.mapToLocalMultiple(e);let o=null,l=null;if(i)o=s[0],l=s[1];else{const C=s[0],S=s[1],z=Math.round(S.x-C.x),A=Math.round(S.y-C.y),Z=Math.max(Math.abs(z),Math.abs(A));o=R(z>0?C.x+Z/2:C.x-Z/2,A>0?C.y+Z/2:C.y-Z/2),l=R(Math.abs(z)>Math.abs(A)?o.x-Z/2:o.x,Math.abs(z)>Math.abs(A)?o.y:o.y-Z/2)}const c=t.localToMap(o),p=t.localToMap(l);if(c==null||p==null)return null;t.doUnnormalization&&Fo([[c,p]],t.spatialReference);const d=at(c,t.spatialReference),h=at(p,t.spatialReference),g=No(t.spatialReference);let m=0;if(_n(t.spatialReference))m=g*is(d,h,null);else{const C=o.x-l.x,S=o.y-l.y;m=g*Math.sqrt(C*C+S*S)*(n||1)}const v=new wa({center:d,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Bt(v.rings,v.spatialReference,!1),center:d,edge:h}}function Ks(e,t,i){const n=t.mapToLocalMultiple(e),s=n[0],o=n[1],l=Math.round(o.x-s.x),c=Math.round(o.y-s.y),p=R(i?s.x:s.x+l/2,i?s.y:s.y+c/2),d=i?l:l/2,h=i?c:c/2,g=60,m=[],v=2*Math.PI/g;function C(le){const ke=Math.cos(le),Ze=Math.sin(le);return R(d*ke+p.x,h*Ze+p.y)}for(let le=0;le<g;le++)m.push(C(le*v));m.push(m[0]);const{spatialReference:S,doUnnormalization:z}=t,A=Bt([m.map(le=>t.localToMap(le)).filter(se)],S,z,!1),Z=t.localToMap(C(Math.PI/2)),he=t.localToMap(C(0)),Pe=t.localToMap(C(-Math.PI/2)),Ne=t.localToMap(C(Math.PI));return{geometry:A,midpoints:Z!=null&&he!=null&&Pe!=null&&Ne!=null?{top:at(Z,S),right:at(he,S),bottom:at(Pe,S),left:at(Ne,S)}:null}}let Q=class extends ne{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){const e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){const e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){const e=[];if(!this.coordinates)return{coordinates:e,rect:wn};const t=Zo(Uo($o(wn),this.coordinates),2*this.strokeWidth);t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]+.5),t[3]=Math.ceil(t[3]+.5);for(const i of this.coordinates)e.push([Math.floor(i[0]-t[0])+.5,Math.floor(i[1]-t[1])+.5]);return e.reverse(),{coordinates:e,rect:t}}render(){const{coordinates:e,rect:t}=this._renderCoordinates,i=Wo(t),n=jo(t);return u("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:t[0]+"px",top:t[1]+"px",width:i+"px",height:n+"px",visibility:this.visible?"visible":"hidden"}},u("svg",{height:n,styles:{display:"block"},width:i},u("polygon",{fill:this._fillStyle,points:e.map(([s,o])=>`${s},${o}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),u("polygon",{fill:"transparent",points:e.map(([s,o])=>`${s},${o}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};r([a()],Q.prototype,"coordinates",void 0),r([a()],Q.prototype,"strokeDash",void 0),r([a()],Q.prototype,"strokeWidth",void 0),r([a()],Q.prototype,"strokeColor",void 0),r([a()],Q.prototype,"strokeDashColor",void 0),r([a()],Q.prototype,"fillColor",void 0),r([a()],Q.prototype,"visible",void 0),r([a()],Q.prototype,"isDecoration",void 0),r([a({readOnly:!0})],Q.prototype,"_strokeStyle",null),r([a({readOnly:!0})],Q.prototype,"_strokeBackgroundStyle",null),r([a({readOnly:!0})],Q.prototype,"_fillStyle",null),r([a({readOnly:!0})],Q.prototype,"_renderCoordinates",null),Q=r([k("esri.views.overlay.OutlineOverlayItem")],Q);const Tc=Q;let ae=class extends Le.EventedMixin(U){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=t=>this.drawOperation.on(t,i=>{this._updateVisuals(),this.emit(t,i)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=we(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){return this.drawOperation?.updating??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new w({view:e,manipulators:this.manipulators,geometryType:xc(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new Ji,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){const{drawOperation:e}=this;if(!e?.geometryIncludingUncommittedVertices.length)return[];const{coordinateHelper:t}=e,i=e.committableVertex,n=e.committedVertices.slice();i!=null&&n.push(t.pointToArray(i));const s=n.length;switch(this.geometryType){case"circle":case"rectangle":{const o=new Is(Fr,Ji.spatialReference),l=this.geometryType==="circle"?qs:Ws,c=this.geometryType==="circle"?Ks:js;if(s===1&&e.isCompleted){const p=n[0],d=o.makeMapPoint(p[0]+Mc,p[1]);return l([p,d],o,!0)?.geometry.rings[0]??[]}if(s===2){const p=this.geometryType!=="rectangle",d=this.centeredToggled!==p,h=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==h?l(n,o,d)?.geometry.rings[0]:c(n,o,d)?.geometry.rings[0])??[]}return[]}}return n}_updateVisuals(){if(!this._overlayItem){const e=new Tc({strokeDash:[5],strokeDashColor:[255,255,255,255]});this.view.overlay?.addItem(e),this.addHandles(je(()=>{this.view.overlay?.removeItem(e),e?.destroy(),this._overlayItem=void 0})),this._overlayItem=e}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function xc(e){switch(e){case"polygon":case"point":return e;case"circle":case"rectangle":return"segment"}}r([a({value:!1})],ae.prototype,"centeredToggled",null),r([a()],ae.prototype,"drawOperation",void 0),r([a({value:!0})],ae.prototype,"enabled",null),r([a({value:!1})],ae.prototype,"uniformSizeToggled",null),r([a({constructOnly:!0})],ae.prototype,"geometryType",void 0),r([a({constructOnly:!0})],ae.prototype,"mode",void 0),r([a({readOnly:!0})],ae.prototype,"type",void 0),r([a({readOnly:!0})],ae.prototype,"updating",null),r([a({constructOnly:!0,nonNullable:!0})],ae.prototype,"view",void 0),r([a()],ae.prototype,"cursor",null),ae=r([k("esri.views.draw.DrawScreenTool")],ae);const Mc=48;async function Ec(){return import("./geometryEngineJSON-CGn_tfx8.js").then(e=>e.g)}async function Cc(){return Ec().then(({contains:e,intersects:t,overlaps:i,simplify:n})=>({contains:e,intersects:t,overlaps:i,simplify:n}))}async function Sc(e){const{currentSelection:t,selector:i,signal:n,sources:s,view:o}=e;if(!s?.length)return{added:[],removed:[]};const{layers:l,layerViews:c,graphicsLayers:p}=Oc(s),d=(await Oi(Promise.all([Pc(i,l,o,n),kc(i,c,o,n),Vc(i,p,o)]),n)).flat();if(!t)return{added:d,removed:[]};const h=t.toArray(),g=d.filter(v=>!Qs(h,v)),m=h.filter(v=>!Qs(d,v));return t.removeMany(m),t.addMany(g),{added:g,removed:m}}const Vc=async(e,t,i)=>Dc({candidates:t.flatMap(n=>n.graphics.toArray())??[],selector:e,view:i}),Pc=async(e,t,i,n)=>{const s=await Re(Rc({selector:e,signal:n,layers:t,view:i}));return s?Ys(s):[]},kc=async(e,t,i,n)=>{const s=await Re(Lc({selector:e,signal:n,layerViews:t,view:i}));return s?Ys(s):[]};function Ys(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i];n.status==="fulfilled"&&t.push(...n.value)}return t}function Oc(e){const t=[],i=[],n=[];return e.forEach(s=>{Xo(s)?t.push(s):(bn(s)||Tn(s))&&s.layers?.length?t.push(...s.layers.toArray()):qo(s)&&s.sublayers?.length?n.push(...s.sublayers.toArray()):Ko(s)?n.push(s):qt(s)&&i.push(s)}),{layers:t,layerViews:i,graphicsLayers:n}}function Qs(e,t){if(e.includes(t))return!0;const i=t.getObjectId(),n=i!=null,{layer:s,uid:o}=t;return n?e.some(l=>{if(s===l.layer)return i===l.getObjectId()}):e.some(l=>{if(s===l.layer)return o===l.uid})}async function Lc(e){const{layerViews:t,selector:i,signal:n,view:s}=e;return Oi(Promise.allSettled(t.map(async o=>{const l=o.createQuery(),{geometry:c}=Js(i,o.layer,s);return l.outFields=["*"],l.geometry=c,l.returnGeometry=!0,l.outSpatialReference=s.spatialReference,o.queryFeatures(l,{signal:n}).then(({features:p})=>p)})),n)}async function Rc(e){const{layers:t,selector:i,signal:n,view:s}=e;return Oi(Promise.allSettled(t.map(async o=>o.queryFeatures(Ic(o.createQuery(),i,o,s),{signal:n}).then(({features:l})=>l))),n)}function Js(e,t,i){const n="renderer"in t?fa({renderer:t.renderer}):0,s=e.type==="point"?_a(e,n,i):e,o="displayField"in t?t.displayField:null,l=Yo({displayField:o,fields:t.fields}),c=[t.objectIdField];if(l!=null&&t.fieldsIndex.has(l)&&c.push(l),"globalIdField"in t&&t.globalIdField!=null&&t.fieldsIndex.has(t.globalIdField)&&c.push(t.fieldsIndex.get(t.globalIdField).name),xn(t)&&t.subtypeField!=null&&t.fieldsIndex.has(t.subtypeField)&&c.push(t.fieldsIndex.get(t.subtypeField).name),"utilityNetworks"in i.map&&i.map.utilityNetworks?.length&&(xn(t)||t.type==="feature")){const p=t.fieldsIndex.get("assetgroup"),d=t.fieldsIndex.get("assettype");p?.name&&c.push(p.name),d?.name&&c.push(d.name)}return{geometry:s,outFields:c}}function Ic(e,t,i,n){const{outFields:s,geometry:o}=Js(t,i,n);return e.outFields=s,e.geometry=o,e.returnGeometry=!0,e.outSpatialReference=n.spatialReference,e}async function Dc(e){const{selector:t,candidates:i,view:n}=e;if(!i?.length||!t)return[];const{spatialReference:s}=n,o=t,l=await Cc();return i.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&l.intersects(s,o,c.geometry))}const Ac=100;let lt=class extends Le.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new _e,this.sources=null,this._process=Si(async(t,i)=>{const{callback:n,selector:s,completed:o}=t,l=mn(async c=>{const{options:p,sources:d,selection:h,view:g}=this;if(!(!d?.length&&!g?.selectionManager.sources.length)&&g){if(s&&d!=null){const m=await Sc({currentSelection:h,selector:s,signal:c,sources:d,view:g});o&&p?.persistSelection!==!1&&g.selectionManager?.updateSelection({current:h.toArray(),...m})}n&&n()}else h.removeAll()});return Qo(i,()=>l.abort()),this._processTask=l,l.promise},Ac)}initialize(){this._setup()}cancel(){this.removeAllHandles(),this._processTask?.abort()}async _setup(){const{view:e}=this;if(await e.whenReady(),this.destroyed)return;const t=this.options,i=t?.createTool??"rectangle",n=t?.mode??(i==="polygon"?"click":"hybrid"),s=Symbol();this._tool=new ae({view:e,mode:n,geometryType:i}),t?.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>Re(this._process({selector:this._selectionArea}))),s),this.addHandles([e.on("key-down",o=>{if(!o.repeat)switch(o.key){case Xt.constraint:this._tool.uniformSizeToggled=!0,o.stopPropagation();break;case Xt.center:this._tool.centeredToggled=!0,o.stopPropagation()}}),e.on("key-up",o=>{switch(o.key){case Xt.constraint:this._tool.uniformSizeToggled=!1,o.stopPropagation();break;case Xt.center:this._tool.centeredToggled=!1,o.stopPropagation()}}),this._tool.on("complete",async o=>{this.removeHandles(s);const l=()=>{this.removeAllHandles(),this.emit("complete",{aborted:o.aborted,selection:this.selection.toArray()})};o.aborted?(this.cancel(),this.selection.removeAll(),l()):await this._process({selector:this._selectionArea,callback:l,completed:!0})})],s),this.addHandles(je(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)}get _selectionArea(){const e=Nt(),t=this._tool.coordinates,i=this.view.spatialReference,n=o=>{e.x=o[0],e.y=o[1];const{x:l,y:c}=this.view.toMap(e);return[l,c]};if(t.length===0)return;if(t.length===1||t.every(([o,l])=>o===t[0][0]&&l===t[0][1])){const[o,l]=n(t[0]);return new F({x:o,y:l,spatialReference:i})}const s=t.map(n);if(s.length!==0)return fn(s)||s.reverse(),new J({spatialReference:i,rings:[s]})}};r([a()],lt.prototype,"options",void 0),r([a({readOnly:!0})],lt.prototype,"selection",void 0),r([a()],lt.prototype,"sources",void 0),r([a({constructOnly:!0})],lt.prototype,"view",void 0),lt=r([k("esri.widgets.support.Selector2D.SelectionOperation")],lt);const zc=lt;let xe=class extends Le.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([L(()=>this._sources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=Xe(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this;return i&&t?.length?t.flatMap(n=>{if(qt(n))return n;if(bn(n)||Tn(n)){const o=n.layers||[],l=o.map(c=>{const p=Dn(i,c)||void 0;return e&&qt(p)?p:c});return l.length?l.toArray():o.length?o.toArray():n}if(!e)return n;const s=Dn(i,n)||void 0;return qt(s)?s:n}):[]}get layers(){return Ut(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){Ut(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:t}=this,i=!e?.length&&!t?.selectionManager.sources.length;return this.activeOperation?"active":t?.ready&&!i?"ready":"disabled"}cancel(){this.state==="active"&&(this.activeOperation?.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:i,view:n}=this,s=!t?.length&&!n?.selectionManager.sources.length;if(i==="disabled"||s||!this.view)return;i==="active"&&this.cancel();const o=new zc({view:this.view,sources:t,options:e});return this._operationHandlesGroup=Li([o.selection.on("change",l=>this.emit("selection-change",l)),o.once("complete",l=>this._onOperationComplete(l))]),this._set("activeOperation",o),o}_onOperationComplete(e){this._operationHandlesGroup=Xe(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};r([a()],xe.prototype,"_sources",null),r([a({readOnly:!0})],xe.prototype,"activeOperation",void 0),r([a()],xe.prototype,"layers",null),r([a()],xe.prototype,"layerViewPreferenceEnabled",void 0),r([a()],xe.prototype,"sources",void 0),r([a({readOnly:!0})],xe.prototype,"state",null),r([a()],xe.prototype,"view",void 0),xe=r([k("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],xe);const Gc=xe,eo={lassoTool:!0,rectangleTool:!0},pn="esri-selection-toolbar",dn={base:pn,container:`${pn}__container`,toolButton:`${pn}__tool-button`};let B=class extends Ee{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new Gc,this.visibleElements={...eo},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=Li([this.viewModel.on("complete",i=>{this._set("activeToolInfo",null),this.emit("complete",i)})])}destroy(){this._viewModelHandlesGroup=Xe(this._viewModelHandlesGroup)}loadDependencies(){return Ie({action:()=>import("./index-DjUNdREK.js")})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return Ut(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){Ut(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...eo,...e}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:i}=this;return(t?.length??0)+(e?.type==="2d"?(i.lassoTool?1:0)+(i.rectangleTool?1:0):0)}activate(e){if(this.cancel(),this.state!=="disabled")switch(e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return u("div",{"aria-label":this.label,class:this.classes(dn.base,zi.widget)},u("div",{class:dn.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if(this.view?.type==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map(({toolName:e,icon:t,toolKey:i})=>this._renderToolWithTooltip(e,i,t))}_renderLassoTool(){const{messages:e,visibleElements:t}=this;if(!t.lassoTool)return;const i=e.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",i)}_renderRectangleTool(){const{messages:e,visibleElements:t}=this;if(!t.rectangleTool)return;const i=e.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",i)}_renderToolWithTooltip(e,t,i,n=e){const s=`${this.id}-tool-${t}`;return u("calcite-action",{active:this.activeToolInfo?.toolName===e,bind:this,class:dn.toolButton,disabled:this.state==="disabled",icon:i||"selection",id:s,key:s,onclick:()=>this._toggleTool(e),scale:this.scale,text:n,title:n})}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const i=this.viewModel.activate(t);i&&this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){return e==="lasso"?this.defaultLassoToolOptions:e==="rectangle"?this.defaultRectangleToolOptions:this.toolConfigs.find(t=>t.toolName===e)}};r([a({readOnly:!0})],B.prototype,"activeToolInfo",void 0),r([a()],B.prototype,"defaultLassoToolOptions",void 0),r([a()],B.prototype,"defaultRectangleToolOptions",void 0),r([a()],B.prototype,"label",null),r([a()],B.prototype,"layers",null),r([a()],B.prototype,"layerViewPreferenceEnabled",null),r([a(),De("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],B.prototype,"messages",void 0),r([a()],B.prototype,"sources",null),r([a()],B.prototype,"toolConfigs",void 0),r([a()],B.prototype,"view",null),r([a()],B.prototype,"viewModel",void 0),r([a()],B.prototype,"visibleElements",void 0),r([yn("visibleElements")],B.prototype,"castVisibleElements",null),r([a()],B.prototype,"scale",void 0),r([a()],B.prototype,"state",null),r([a()],B.prototype,"layout",void 0),r([a()],B.prototype,"visibleToolCount",null),B=r([k("esri.widgets.support.SelectionToolbar")],B);const Hc=B,Fe="esri-sketch",Ve={base:Fe,vertical:`${Fe}--vertical`,docked:`${Fe}-bar`,floating:`${Fe}-pad`,chipHorizontal:`${Fe}__selection-count-chip--horizontal`,chipVertical:`${Fe}__selection-count-chip--vertical`,chipVerticalSmall:`${Fe}__selection-count-chip--vertical--s`,popoverWrapper:`${Fe}__popover-wrapper`},Bc={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let M=class extends Ee{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new q,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new An({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=new Hc({view:t?.type==="2d"?t:null,sources:e?[e]:null,scale:this.scale});this.addHandles([L(()=>this.viewModel,n=>{this._viewModelHandlesGroup=Xe(this._viewModelHandlesGroup),n&&(this._viewModelHandlesGroup=Li([n.on("create",()=>this.scheduleRender()),n.on("update",()=>this.scheduleRender()),n.on("delete",s=>this.emit("delete",s)),n.on("undo",()=>this.scheduleRender()),n.on("redo",()=>this.scheduleRender()),L(()=>n.layer,s=>{this._selectionToolbar&&(this._selectionToolbar.sources=s?[s]:null)}),L(()=>n.view,s=>{this._selectionToolbar&&(this._selectionToolbar.view=s?.type==="2d"?s:null)}),L(()=>n.state,()=>this.notifyChange("state"))]))},Ct),Jo(()=>i.activeToolInfo,()=>this.viewModel.cancel()),i.on("complete",n=>this._onSelectionOperationComplete(n)),L(()=>{const{selectionTools:n}=this.visibleElements;return{lassoTool:!!n?.["lasso-selection"],rectangleTool:!!n?.["rectangle-selection"]}},n=>{Object.assign(i.visibleElements,n)},Ct)]),this._selectionToolbar=i}loadDependencies(){return Ie({action:()=>import("./index-DjUNdREK.js"),chip:()=>import("./index-DS4kC18w.js"),popover:()=>import("./index-pkRo6EfR.js").then(e=>e.i)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=Xe(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:n}=this.viewModel;return i==="polygon"&&n==="freehand"&&t?.includes("freehandPolygon")?"freehandPolygon":i==="polyline"&&n==="freehand"&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&we(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,n=e?.filter(s=>!!i.createTools?.[s]);return t?.type==="3d"?n?.filter(s=>s!=="multipoint"):n}create(e,t,i){const n=i?.createOptions??t;return this._activeCustomToolOptions=i,Re(this.viewModel.create(e,n))}update(e,t){return Re(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,n=this.customActions?.filter(s=>s.position==="selection-toolbar");return u("div",null,u("div",{classes:{[Ve.base]:!0,[Ve.floating]:e==="floating",[Ve.docked]:e==="docked",[Ve.vertical]:t==="vertical"}},u($s,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),u("div",{"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??Pt.Low},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),n?.map(s=>this._renderToolbarItem(s))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:n,visibleElements:s}=this;if(!this._calcitePopoverReferenceElement)return;const o={directionModePicker:s.directionModePicker,labelsToggle:s.labelsToggle,tooltipsToggle:s.tooltipsToggle},l=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return u("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:l,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},u("div",{class:Ve.popoverWrapper},Object.values(o).includes(!0)?u(cc,{sketchOptions:n.sketchOptions,viewType:i?.type,visibleElements:new rn(o)}):void 0,s.snappingControls&&i&&t?u(yc,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:s.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e?.length?u($s,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return u("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??Pt.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(n=>{n.position==="settings-before"?t.push(n):n.position==="settings-after"&&e.push(n)});const i=[...t.map(n=>this._renderToolbarItem(n)),this._renderSettingsMenuButton(),...e.map(n=>this._renderToolbarItem(n))].filter(se);if(i.length)return u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??Pt.Max,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=this.customActions?.filter(s=>s.position==="before-selection-set"),i=this.customActions?.filter(s=>s.position==="after-selection-set"),n=this.groupCollapsePriorities?.get("selectionSet")??Pt.High;return[u("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:n,slot:e},this._renderFeatureCountChip()),u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:n,slot:e},t?.map(s=>this._renderToolbarItem(s)),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map(s=>this._renderToolbarItem(s)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(i=>this._renderBuiltInCreateToolItem(i))??[],t=this.customToolOptions?.flatMap(i=>this._renderCustomToolItem(i))??[];return u("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??Pt.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:Bc[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:n,updateGraphics:{length:s}}=this,o=ts(t.selectedCount,{count:s}),l=i==="s"?99:999,c=s>l?ts(t.selectedCountTruncated,{truncated:l}):s,p=i==="s"&&e==="vertical",d=p?`${n}-selection-chip-small`:`${n}-selection-chip`;return[p?u("span",{classes:{[Ve.chipVertical]:!0,[Ve.chipVerticalSmall]:this.scale==="s"},id:d,tabIndex:0,title:o},c):u("calcite-chip",{appearance:"outline",class:e==="horizontal"?Ve.chipHorizontal:Ve.chipVertical,id:d,kind:"brand",label:o,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?o:void 0},e==="vertical"?c:o)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:n,onclick:s,active:o,flipRTL:l,afterCreate:c,afterUpdate:p,afterRemoved:d}){const h=`${this.id}-${e}`;return[u("calcite-action",{active:o,afterCreate:c,afterRemoved:d,afterUpdate:p,bind:this,"data-testid":e,disabled:n||this.state==="disabled",icon:i,iconFlipRtl:l??!1,id:h,key:e,onclick:s,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),n=t?.style;if(!(t&&i&&n&&this.view?.container?.contains(t)))return;const s=this._calcitePopoverReferenceElement;if(!s)return;const{bottom:o,top:l}=s.getBoundingClientRect();if(this.layout==="horizontal"){const p=o<i.height/2;p!==(this._relativeLocation==="top")&&(this._relativeLocation=p?"top":"bottom"),p?(n?.setProperty("--sketch-view-height-offset",o-i.top+"px"),n?.setProperty("--sketch-view-margin-offset","30px")):(n?.setProperty("--sketch-view-height-offset",i.bottom-l+"px"),n?.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(n.setProperty("--sketch-view-height-offset","15px"),n.setProperty("--sketch-view-margin-offset","15px"));const c=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;n.setProperty("--sketch-popover-header-offset",`${c}px`)}catch(t){St.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,i){const n=this._activeCustomToolOptions;if(i||n){if(i?.toolKey===n?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const n=t.tool,s=i.length>1&&n==="reshape"?"transform":n;this.update(i,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};r([a()],M.prototype,"_activeCustomToolOptions",void 0),r([a()],M.prototype,"activeTool",null),r([a({readOnly:!0})],M.prototype,"activeTooltip",null),r([a({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(i=>t.has(i))}})],M.prototype,"availableCreateTools",void 0),r([a({readOnly:!0})],M.prototype,"createGraphic",null),r([a()],M.prototype,"creationMode",null),r([a()],M.prototype,"customToolOptions",void 0),r([a()],M.prototype,"customActions",void 0),r([a()],M.prototype,"defaultCreateOptions",null),r([a()],M.prototype,"defaultUpdateOptions",null),r([a()],M.prototype,"icon",null),r([a()],M.prototype,"label",null),r([a()],M.prototype,"labelOptions",null),r([a()],M.prototype,"layer",null),r([a({type:["horizontal","vertical"],value:"horizontal"})],M.prototype,"layout",null),r([a({value:"m"})],M.prototype,"scale",null),r([a()],M.prototype,"toolbarKind",void 0),r([a()],M.prototype,"contextualToolLocation",void 0),r([a()],M.prototype,"groupCollapsePriorities",void 0),r([a(),De("esri/widgets/Sketch/t9n/Sketch")],M.prototype,"messages",void 0),r([a(),De("esri/t9n/common")],M.prototype,"messagesCommon",void 0),r([a()],M.prototype,"snappingOptions",null),r([a()],M.prototype,"state",null),r([a()],M.prototype,"tooltipOptions",null),r([a({readOnly:!0})],M.prototype,"updateGraphics",null),r([a({type:zr,nonNullable:!0})],M.prototype,"valueOptions",null),r([a()],M.prototype,"view",null),r([a({type:An}),Zr(["create","update","undo","redo"])],M.prototype,"viewModel",null),r([a({type:q,nonNullable:!0})],M.prototype,"visibleElements",void 0),r([a()],M.prototype,"_effectiveAvailableCreateTools",null),r([a()],M.prototype,"_defaultViewModel",void 0),r([a()],M.prototype,"_calcitePopoverReferenceElement",void 0),r([a()],M.prototype,"_relativeLocation",void 0),r([a()],M.prototype,"_popoverOpen",void 0),M=r([k("esri.widgets.Sketch")],M);const Fc=M,Nc=(e,t,i)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((s,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})},Zc=(e,t)=>(i,n)=>$c(i,e,n);class Uc extends tr{constructor(t,i,n){super(t,i,n),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:Ri.makeGetterProxy(t,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.loadedCalled&&$t(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),this.onLifecycle(()=>this.reactiveUtils.watch(()=>this._instance.viewModel,n=>{this.component.viewModel=n},{initial:!0}));const t=this._instance.viewModel;typeof t=="object"&&(Ri.watchComponentUpdates(this,t,this._watchedViewModelProperties),Ri.watchAccessorUpdates(this,t,this._watchedViewModelProperties));const i=Object.entries(this._watchedVisibleElementsProperties);i.length>0&&this.onLifecycle(()=>i.map(([n,s])=>{let o=this._instance.visibleElements??{},l;for(const d of s.slice(0,-1))if(typeof o[d]=="object"&&o[d]!==null)o=o[d];else{l=!!o[d];break}l===void 0&&(l=!!(o[s.slice(-1)[0]]??!0)),n.startsWith("hide");const c=n.startsWith("hide")||n.startsWith("show")?n.startsWith("hide"):l,p=this.component;return typeof p[n]=="boolean"?this._updateWidgetVisibleElement(s,p[n],c):p[n]=!1,Ii(this.component,n,d=>this._updateWidgetVisibleElement(s,d,c))}))}_updateWidgetVisibleElement(t,i,n){let s=this._instance.visibleElements??{};for(const l of t.slice(0,-1))(typeof s[l]!="object"||s[l]===null)&&(s[l]={}),s=s[l];const o=!!(n?!i:i);s[t.at(-1)]=o}hostLoaded(){const{el:t}=this.component;t.childElem??=document.createElement("div"),this._instance.container=t.childElem;let i=!1;const n=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view??this._instance.viewModel?.view,set:s=>{!("view"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.view=s:this._instance.view=s,!("map"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.map=s.map:this._instance.map=s.map,this._watchViewDestroy(),s&&!i&&(i=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),n&&(this._instance.view=n),this.component.el.isConnected&&($t(this.component),this._watchViewDestroy())}hostDisconnected(){typeof this.component.el.childElem=="object"&&this.component.el.view?.ui?.remove(this.component.el.childElem)}hostDestroy(){super.hostDestroy(),this._watchViewDestroyHandle?.remove()}_watchMetaProperties(){Ii(this.component,"position",t=>{this.component.el.childElem!=null&&typeof t=="string"&&$t(this.component)}),Ii(this.component,"referenceElement",()=>$t(this.component))}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,i)=>typeof i=="string"||Reflect.has(t,i),get:(t,i)=>{if(typeof i=="symbol"||i in Promise.prototype)return Reflect.get(t,i);const n=[i],s=this._makeRecursiveProxy(n);return ir(this.component,o=>{const l=o;this.component[l]=!1,this._watchedVisibleElementsProperties[l]=n},s)}})}_makeRecursiveProxy(t){const i=new Proxy({},{get:(n,s)=>{const o=Reflect.get(n,s);return typeof s=="symbol"||s in Promise.prototype?o:(t.push(s),i)}});return i}_watchViewDestroy(){this._watchViewDestroyHandle?.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when(()=>this.component.el.view?.destroyed===!0,()=>void this.component.destroy().catch(console.error),{sync:!0})}}const $c=er(Uc),Wc=nr`@layer{arcgis-sketch{display:block}}`,jc=Zc(Fc);class Xc extends sr{constructor(){super(),this.widget=jc(this,{editConstructorProperties:this._editConstructorProperties}),this.viewModel=this.widget.viewModel,this.activeTool=this.widget.activeTool,this.autoDestroyDisabled=!1,this.availableCreateTools=this.widget.availableCreateTools,this.createGraphic=this.widget.createGraphic,this.creationMode=this.widget.creationMode,this.defaultCreateOptions=this.widget.defaultCreateOptions,this.defaultGraphicsLayerDisabled=!1,this.defaultUpdateOptions=this.widget.defaultUpdateOptions,this.hideCreateToolsCircle=this.widget.visibleElements.createTools.circle,this.hideCreateToolsPoint=this.widget.visibleElements.createTools.point,this.hideCreateToolsPolygon=this.widget.visibleElements.createTools.polygon,this.hideCreateToolsPolyline=this.widget.visibleElements.createTools.polyline,this.hideCreateToolsRectangle=this.widget.visibleElements.createTools.rectangle,this.hideDuplicateButton=this.widget.visibleElements.duplicateButton,this.hideDeleteButton=this.widget.visibleElements.deleteButton,this.hideSelectionCountLabel=this.widget.visibleElements.selectionCountLabel,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSelectionToolsLassoSelection=this.widget.visibleElements.selectionTools["lasso-selection"],this.hideSelectionToolsRectangleSelection=this.widget.visibleElements.selectionTools["rectangle-selection"],this.hideSettingsMenu=this.widget.visibleElements.settingsMenu,this.hideSnappingControls=this.widget.visibleElements.snappingControls,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.hideUndoRedoMenu=this.widget.visibleElements.undoRedoMenu,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layer=this.widget.layer,this.layout=this.widget.layout,this.pointSymbol=this.viewModel.pointSymbol,this.polygonSymbol=this.viewModel.polygonSymbol,this.polylineSymbol=this.viewModel.polylineSymbol,this.position="bottom-left",this.scale=this.widget.scale,this.toolbarKind=this.widget.toolbarKind,this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.snappingOptions=this.widget.snappingOptions,this.state=this.widget.state,this.tooltipOptions=this.widget.tooltipOptions,this.updateGraphics=this.widget.updateGraphics,this.arcgisCreate=Vt(()=>this.widget,"create"),this.arcgisDelete=Vt(()=>this.widget,"delete"),this.arcgisPropertyChange=or()("state"),this.arcgisReady=rr(),this.arcgisRedo=Vt(()=>this.widget,"redo"),this.arcgisUndo=Vt(()=>this.widget,"undo"),this.arcgisUpdate=Vt(()=>this.widget,"update"),this.listen("arcgisReady",this._arcgisReadyHandler)}static{this.properties={activeTool:3,autoDestroyDisabled:5,availableCreateTools:0,createGraphic:0,creationMode:1,defaultCreateOptions:0,defaultGraphicsLayerDisabled:5,defaultUpdateOptions:0,hideCreateToolsCircle:5,hideCreateToolsPoint:5,hideCreateToolsPolygon:5,hideCreateToolsPolyline:5,hideCreateToolsRectangle:5,hideDuplicateButton:5,hideDeleteButton:5,hideSelectionCountLabel:5,hideLabelsToggle:5,hideSelectionToolsLassoSelection:5,hideSelectionToolsRectangleSelection:5,hideSettingsMenu:5,hideSnappingControls:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,hideUndoRedoMenu:5,icon:1,label:1,labelOptions:0,layer:0,layout:1,pointSymbol:0,polygonSymbol:0,polylineSymbol:0,position:1,referenceElement:1,scale:1,toolbarKind:1,showSnappingControlsElementsHeader:5,snappingOptions:0,state:3,tooltipOptions:0,updateGraphics:0}}static{this.shadowRootOptions=ar}static{this.styles=Wc}async cancel(){this.widget?.cancel()}async complete(){this.widget?.complete()}async create(t,i){await this.widget?.create(t,i)}async delete(){this.widget?.delete()}async destroy(){await this.manager.destroy()}async duplicate(){this.widget?.duplicate()}async redo(){this.widget?.redo()}async triggerUpdate(t,i){this.widget?.update(t,i)}async undo(){this.widget?.undo()}_arcgisReadyHandler(){this.defaultGraphicsLayerDisabled||this.el.view?.map.add(this.widget.layer)}async _editConstructorProperties(t){return this.defaultGraphicsLayerDisabled||(t.layer??=new Tr({title:"Sketch Layer"})),t}}lr("arcgis-sketch",Xc);const _i="RampDrawGraphicsLayer",qc=cr({__name:"draw",setup(e){const{t}=pr(),i=y=>t(y?`draw.${y}`:"draw.unknown"),n=dr("iApi"),s=Di();let o=null;const l=hr("sketchEl");let c=null,p=null,d=null,h=null,g=!1,m=null,v=[];const C=ur([]);async function S(){(await n.fixture.isLoaded("keyboardnav")).register("D",{name:{en:"Draw Tools",fr:"Outils de dessin"},activeHandler:()=>{s.setActiveTool("")},keys:[{key:"P",description:{en:"Draw a point",fr:"Dessine un point"},handler:()=>{s.setActiveTool("point")}},{key:"L",description:{en:"Draw a line",fr:"Dessine une ligne"},handler:()=>{s.setActiveTool("polyline")}},{key:"G",description:{en:"Draw a polygon",fr:"Dessine un polygone"},handler:()=>{s.setActiveTool("polygon")}},{key:"C",description:{en:"Draw a circle",fr:"Dessine un cercle"},handler:()=>{s.setActiveTool("circle")}},{key:"R",description:{en:"Draw a rectangle",fr:"Dessine un rectangle"},handler:()=>{s.setActiveTool("rectangle")}},{key:"E",description:{en:"Edit geometry",fr:"Mode \xE9dition"},handler:()=>{s.setActiveTool("edit")}}]})}const z=y=>{if(h&&(p?.remove(h),h=null),!y)return;let b;switch(y.geometry?.type){case"point":case"multipoint":b=new _r({color:[255,255,0,.8],size:16,outline:{color:[255,165,0,1],width:3}});break;case"polyline":b=new Cn({color:[255,255,0,.8],width:6});break;default:b=new Wt({color:[255,255,0,.3],outline:{color:[255,165,0,1],width:3}})}h=new qe({geometry:y.geometry,symbol:b}),p?.add(h)};Mn(()=>s.selectedGraphicId,(y,b)=>{if(!(!o||!p)){if(!y)o.cancel(),z();else if(y!==b){const f=p.graphics.toArray().find(I=>I.attributes&&I.attributes.id===y);f&&(o.triggerUpdate([f]),z(f))}}});const A=async()=>{if(!p||!o||s.activeTool!=="edit")return;await n.geo.map.viewPromise;const y=n.geo.map.esriView,b={x:y.width/2,y:y.height/2},f={x:b.x,y:b.y,width:20,height:20},I=(await y.hitTest(f)).results.filter($=>!("graphic"in $)||$.graphic.layer!==p?!1:!!$.graphic.attributes?.id);I.length>0?(d=I[0].graphic,o.triggerUpdate([d]),d.attributes?.id&&s.selectGraphic(d.attributes.id),n.updateAlert(t("draw.graphic.selected",{type:i(d.attributes?.type)}))):(o.cancel(),d=null,s.clearSelection())},Z=async()=>{if(!o||!s.activeTool)return;await n.geo.map.viewPromise;const y=n.geo.map.esriView,b={x:Math.floor(y.width/2),y:Math.floor(y.height/2)},f=y.toMap(b),I=y.extent,$=I.width,fe=I.height,Oe=Math.min($,fe)/10;let ee;switch(s.activeTool){case"point":ee=new qe({geometry:new F({x:f.x,y:f.y,spatialReference:y.spatialReference}),symbol:o.pointSymbol});break;case"polyline":ee=new qe({geometry:new Me({paths:[[[f.x-Oe/2,f.y],[f.x+Oe/2,f.y]]],spatialReference:y.spatialReference}),symbol:o.polylineSymbol});break;case"polygon":case"rectangle":const _=Oe/2;ee=new qe({geometry:new J({rings:[[[f.x-_,f.y-_],[f.x+_,f.y-_],[f.x+_,f.y+_],[f.x-_,f.y+_],[f.x-_,f.y-_]]],spatialReference:y.spatialReference}),symbol:o.polygonSymbol||new Wt({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})});break;case"circle":const D=Oe/2,ct=36,bt=[];for(let Ue=0;Ue<=ct;Ue++){const pt=Ue/ct*2*Math.PI,W=f.x+D*Math.cos(pt),H=f.y+D*Math.sin(pt);bt.push([W,H])}ee=new qe({geometry:new J({rings:[bt],spatialReference:y.spatialReference}),symbol:o.polygonSymbol||new Wt({color:[255,0,255,.3],outline:{color:[255,0,255,1],width:1}})});break;default:console.warn("Unknown tool type:",s.activeTool);return}if(ee){const _=`graphic-${Date.now()}`;ee.attributes={id:_,type:s.activeTool},p?.add(ee),s.addGraphic({id:_,type:s.activeTool,geometry:ee.geometry,attributes:ee.attributes}),s.activeTool!=="point"&&(s.clearSelection(),s.setActiveTool(null),o.cancel()),n.updateAlert(t("draw.graphic.created",{type:i(s.activeTool)}))}},he=y=>{const b=n.geo.map.esriView?.container;if(!(!document.activeElement||!b?.contains(document.activeElement)))switch(y.key){case"Enter":if(y.preventDefault(),s.activeTool&&s.activeTool!=="edit")if((s.activeTool==="polyline"||s.activeTool==="polygon")&&(g||v.length===0)){const I=n.geo.map.esriView,$={x:Math.floor(I.width/2),y:Math.floor(I.height/2)},fe=I.toMap($);g?(v.push([fe.x,fe.y]),s.activeTool==="polyline"?m.geometry=new Me({paths:[v],spatialReference:I.spatialReference}):m.geometry=new J({rings:[v],spatialReference:I.spatialReference}),n.updateAlert(t("draw.multiPoint.pointAdded",{type:i(s.activeTool),count:v.length}))):(g=!0,v=[[fe.x,fe.y]],s.activeTool==="polyline"?m=new qe({geometry:new Me({paths:[v],spatialReference:I.spatialReference}),symbol:o?.polylineSymbol||new Cn({color:[0,0,255,1],width:2})}):m=new qe({geometry:new J({rings:[v],spatialReference:I.spatialReference}),symbol:o?.polygonSymbol||new Wt({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})}),m.attributes={id:`temp-graphic-${Date.now()}`,type:s.activeTool},p?.add(m),n.updateAlert(t("draw.multiPoint.started",{type:i(s.activeTool),count:1})))}else Z();else A();break;case"Delete":case"Backspace":const f=n.geo.map.esriView;g&&v.length>1?(y.preventDefault(),v.pop(),s.activeTool==="polyline"?m.geometry=new Me({paths:[v],spatialReference:f.spatialReference}):m.geometry=new J({rings:[v],spatialReference:f.spatialReference}),m.set("geometry",m?.geometry),n.updateAlert(t("draw.multiPoint.pointRemoved",{type:i(s.activeTool??void 0),count:v.length}))):g&&v.length===1?(y.preventDefault(),m&&p?.remove(m),m=null,v=[],g=!1,n.updateAlert(t("draw.multiPoint.canceled"))):d&&(y.preventDefault(),o?.delete(),p?.remove(d),typeof s.removeGraphic=="function"&&s.removeGraphic(d.attributes.id),d=null,z(void 0),n.updateAlert(t("draw.graphic.deleted")));break;case"Escape":s.setActiveTool(null),o?.cancel(),d=null,z(void 0),s.clearSelection(),n.updateAlert(t("draw.tool.canceled"));break}},Pe=y=>{const b=n.geo.map.esriView.container;if(!document.activeElement||!b?.contains(document.activeElement)||!d||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(y.key))return;y.preventDefault(),y.stopPropagation();const f=10,I=y.shiftKey,$=y.altKey,fe=n.geo.map.esriView;let Oe=0,ee=0;y.key==="ArrowLeft"&&(Oe=-f),y.key==="ArrowRight"&&(Oe=f),y.key==="ArrowUp"&&(ee=-f),y.key==="ArrowDown"&&(ee=f);const _=d.geometry;let D;if(_.type==="point")D={x:_.x,y:_.y};else{const H=_.extent;D={x:(H.xmin+H.xmax)/2,y:(H.ymin+H.ymax)/2}}const ct=fe.toScreen(new F({x:D.x,y:D.y,spatialReference:fe.spatialReference}));ct.x+=Oe,ct.y+=ee;const bt=fe.toMap(ct),Ue=bt.x-D.x,pt=bt.y-D.y;let W;if(_.type==="point")!I&&!$?W=new F({x:_.x+Ue,y:_.y+pt,spatialReference:_.spatialReference}):I?(W=_.clone(),n.updateAlert(t("draw.point.resize.unsupported"))):$&&(W=_.clone(),n.updateAlert(t("draw.point.rotate.unsupported")));else if(_.type==="polyline"){if(!I&&!$){const H=_.paths.map(j=>j.map(([te,ie])=>[te+Ue,ie+pt]));W=new Me({paths:H,spatialReference:_.spatialReference})}else if(I){const H=_,j=y.key==="ArrowUp"||y.key==="ArrowRight"?1.05:.95,te=H.paths.map(ie=>ie.map(([$e,We])=>[D.x+($e-D.x)*j,D.y+(We-D.y)*j]));W=new Me({paths:te,spatialReference:_.spatialReference})}else if($){const H=_,j=y.key==="ArrowLeft"?-.05:y.key==="ArrowRight"?.05:0;if(j!==0){const te=Math.cos(j),ie=Math.sin(j),$e=H.paths.map(We=>We.map(([bi,Ti])=>{const Tt=bi-D.x,xt=Ti-D.y,xi=Tt*te-xt*ie,Mi=Tt*ie+xt*te;return[D.x+xi,D.y+Mi]}));W=new Me({paths:$e,spatialReference:_.spatialReference})}else W=_.clone()}}else if(_.type==="polygon"){if(!I&&!$){const H=_.rings.map(j=>j.map(([te,ie])=>[te+Ue,ie+pt]));W=new J({rings:H,spatialReference:_.spatialReference})}else if(I){const H=_,j=y.key==="ArrowUp"||y.key==="ArrowRight"?1.05:.95,te=H.rings.map(ie=>ie.map(([$e,We])=>[D.x+($e-D.x)*j,D.y+(We-D.y)*j]));W=new J({rings:te,spatialReference:_.spatialReference})}else if($){const H=_,j=y.key==="ArrowLeft"?-.05:y.key==="ArrowRight"?.05:0;if(j!==0){const te=Math.cos(j),ie=Math.sin(j),$e=H.rings.map(We=>We.map(([bi,Ti])=>{const Tt=bi-D.x,xt=Ti-D.y,xi=Tt*te-xt*ie,Mi=Tt*ie+xt*te;return[D.x+xi,D.y+Mi]}));W=new J({rings:$e,spatialReference:_.spatialReference})}else W=_.clone()}}if(W){d.geometry=W,d.set("geometry",W),z(d),d.attributes?.id&&s.updateGraphicGeometry(d.attributes.id,W);const H=I?"resized":$?"rotated":"moved";n.updateAlert(t(`draw.graphic.${H}`))}},Ne=async y=>{const b=(await n.geo.map.esriView.hitTest(y)).results.find(f=>"graphic"in f&&f.graphic.layer===p&&!!f.graphic.attributes?.id);b&&s.activeTool==="edit"?o?.triggerUpdate([b.graphic]):(o?.cancel(),d=null,s.clearSelection(),z())},le=async()=>{await n.geo.map.viewPromise,n.geo.layer.getLayer(_i)?p=n.geo.layer.getLayer(_i).esriLayer:(p=n.geo.layer.createLayer({id:_i,layerType:vr.GRAPHIC,cosmetic:!0,system:!0,url:""}),await n.geo.map.addLayer(p)),p?.esriLayer&&(p=p.esriLayer),Object.assign(l.value,{view:n.geo.map.esriView,layer:p,availableCreateTools:["point","multipoint","polyline","polygon","rectangle","circle"],updateOnGraphicClick:!0,visibleElements:{createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{enable:!0},settingsMenu:!1},defaultUpdateOptions:{highlightOptions:{enabled:!1}}}),n.geo.map.esriView.ui.add(l.value,"bottom-right"),l.value?.addEventListener("arcgisCreate",y=>Ze(y.detail)),l.value?.addEventListener("arcgisUpdate",y=>wi(y.detail)),c={remove:()=>l.value?.removeEventListener("arcgisCreate",y=>Ze(y.detail))},o=l.value,n.geo.map.esriView.on("click",Ne),document.addEventListener("keydown",he),document.addEventListener("keydown",Pe,{capture:!0})},ke=()=>{o&&(n.geo.map.esriView&&n.geo.map.esriView.ui.remove(o),c&&c.remove(),o.destroy()),document.removeEventListener("keydown",he),document.removeEventListener("keydown",Pe,{capture:!0}),g=!1,m=null,v=[],o=null,p=null},Ze=y=>{if(y.state==="complete"){const b=y.graphic,f=`graphic-${Date.now()}`;b.attributes=b.attributes||{},b.attributes.id=f,s.addGraphic({id:f,type:y.tool,geometry:b.geometry,attributes:b.attributes}),y.tool!=="point"&&s.setActiveTool(null)}},wi=y=>{const b=y.graphics[0];if(b)if(y.state==="start"){if(s.activeTool!=="edit"){o.cancel();return}d=b,b.attributes?.id&&(s.selectGraphic(b.attributes.id),n.updateAlert(t("draw.graphic.selected",{type:i(b.attributes?.type)})))}else y.state==="active"?z(b):y.state==="complete"&&b.attributes?.id&&(s.updateGraphicGeometry(b.attributes.id,b.geometry),n.updateAlert(t("draw.graphic.updated")))};return gr(()=>{S(),le(),C.push(n.event.on(En.MAP_DESTROYED,()=>{ke()}))}),Mn(()=>s.activeTool,y=>{o.cancel(),z(),m=null,v=[],g=!1,y&&y!="edit"&&o.create(y)}),yr(()=>{ke(),C.forEach(y=>n.event.off(y))}),(y,b)=>(fr(),mr("arcgis-sketch",{ref_key:"sketchEl",ref:l,style:{display:"none"}},null,512))}}),to=[{type:"point"},{type:"polyline"},{type:"polygon"},{type:"circle"},{type:"rectangle"}];class Kc extends wr{store;constructor(t,i){super(t,i),this.store=Di(this.$vApp.$pinia)}_parseConfig(t){if(!t){this.store.setSupportedTypes(to);return}if(t.types!==void 0){const i=(t.types===null?[]:t.types).filter(n=>n.enabled!==!1);this.store.setSupportedTypes(i)}else this.store.setSupportedTypes(to);t.defaultTool&&this.store.setActiveTool(t.defaultTool)}get graphicsLayerId(){return _i}}const Yc={en:{"draw.multiPoint.started":"{type} drawing started with 1 point","draw.multiPoint.pointAdded":"Point added {count} points total","draw.multiPoint.pointRemoved":"Point removed {count} points remaining","draw.multiPoint.canceled":"Drawing canceled","draw.multiPoint.completed":"{type} completed with {count} points","draw.multiPoint.notEnoughPoints":"Not enough points for {type} minimum {min} required","draw.graphic.created":"{type} created","draw.graphic.selected":"{type} selected","draw.graphic.deselected":"Graphic deselected","draw.graphic.deleted":"Graphic deleted","draw.graphic.updated":"Graphic updated","draw.graphic.none":"No graphic found","draw.tool.canceled":"Drawing tool canceled","draw.point.resize.unsupported":"Resizing not supported for point graphics","draw.point.rotate.unsupported":"Rotation not supported for point graphics","draw.move.up":"Moved up","draw.move.down":"Moved down","draw.move.left":"Moved left","draw.move.right":"Moved right","draw.resize.increase":"Increased size","draw.resize.decrease":"Decreased size","draw.rotate.clockwise":"Rotated clockwise","draw.rotate.counterclockwise":"Rotated counter-clockwise","draw.button.point":"Draw point","draw.button.polyline":"Draw line","draw.button.polygon":"Draw polygon","draw.button.rectangle":"Draw rectangle","draw.button.circle":"Draw circle","draw.point.tooltip":"Draw point","draw.polyline.tooltip":"Draw polyline","draw.polygon.tooltip":"Draw polygon","draw.circle.tooltip":"Draw circle","draw.rectangle.tooltip":"Draw rectangle","draw.edit.tooltip":"Edit Mode","draw.graphic.moved":"Graphic moved","draw.shape":"shape","draw.point":"point","draw.multipoint":"multipoint","draw.polyline":"polyline","draw.polygon":"polygon","draw.rectangle":"rectangle","draw.circle":"circle","draw.unknown":"unknown"},fr:{"draw.multiPoint.started":"Dessin de {type} commenc\xE9 avec 1 point","draw.multiPoint.pointAdded":"Point ajout\xE9","draw.multiPoint.pointRemoved":"Point supprim\xE9","draw.multiPoint.canceled":"Dessin annul\xE9","draw.multiPoint.completed":"{type} termin\xE9 avec {count} points","draw.multiPoint.notEnoughPoints":"Pas assez de points pour {type}","draw.graphic.created":"{type} cr\xE9\xE9","draw.graphic.selected":"{type} s\xE9lectionn\xE9","draw.graphic.deselected":"Graphique d\xE9s\xE9lectionn\xE9","draw.graphic.deleted":"Graphique supprim\xE9","draw.graphic.updated":"Graphique mis \xE0 jour","draw.graphic.none":"Aucun graphique trouv\xE9","draw.tool.canceled":"Outil de dessin annul\xE9","draw.point.resize.unsupported":"Le redimensionnement n'est pas pris en charge pour les points","draw.point.rotate.unsupported":"La rotation n'est pas prise en charge pour les points","draw.move.up":"D\xE9plac\xE9 vers le haut","draw.move.down":"D\xE9plac\xE9 vers le bas","draw.move.left":"D\xE9plac\xE9 vers la gauche","draw.move.right":"D\xE9plac\xE9 vers la droite","draw.resize.increase":"Taille augment\xE9e","draw.resize.decrease":"Taille r\xE9duite","draw.rotate.clockwise":"Rotation dans le sens horaire","draw.rotate.counterclockwise":"Rotation dans le sens antihoraire","draw.button.point":"Dessiner un point","draw.button.polyline":"Dessiner une ligne","draw.button.polygon":"Dessiner un polygone","draw.button.rectangle":"Dessiner un rectangle","draw.button.circle":"Dessiner un cercle","draw.point.tooltip":"Dessiner un point","draw.polyline.tooltip":"Dessiner une polyligne","draw.polygon.tooltip":"Dessiner un polygone","draw.circle.tooltip":"Dessiner un cercle","draw.rectangle.tooltip":"Dessiner un rectangle","draw.edit.tooltip":"Mode \xE9dition","draw.graphic.moved":"Graphique d\xE9plac\xE9","draw.shape":"forme","draw.point":"indiquer","draw.multipoint":"multipoint","draw.polyline":"polyligne","draw.polygon":"polygone","draw.rectangle":"rectangle","draw.circle":"cercle","draw.unknown":"inconnue"}};class Qc extends Kc{async init(){const{el:t}=this.mount(qc,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),Object.entries(Yc).forEach(i=>this.$iApi.$i18n.mergeLocaleMessage(...i)),this._parseConfig(this.config),Di(this.$vApp.$pinia).supportedTypes.forEach(i=>{const n=`${i.type}-icon`;this.$iApi.component(n,br(Nc(Object.assign({"./icons/circle-icon.vue":()=>import("./circle-icon-CuAP7fK5.js"),"./icons/edit-icon.vue":()=>import("./edit-icon-DAX4EVvH.js"),"./icons/point-icon.vue":()=>import("./point-icon-H8FMDzZg.js"),"./icons/polygon-icon.vue":()=>import("./polygon-icon-5W75RMVc.js"),"./icons/polyline-icon.vue":()=>import("./polyline-icon-D3QXeUpR.js"),"./icons/rectangle-icon.vue":()=>import("./rectangle-icon-Ck3XAfev.js")}),`./icons/${i.type}-icon.vue`,3)))})}async added(){this.$iApi.event.on(En.MAP_CREATED,()=>{this.init()})}}const Jc=Object.freeze(Object.defineProperty({__proto__:null,default:Qc},Symbol.toStringTag,{value:"Module"}));export{_s as A,_l as B,ss as C,El as D,si as E,Jl as F,Kl as G,ql as H,Ml as I,xl as J,Ss as K,qs as L,Cl as M,ni as N,ds as O,os as P,ws as Q,bc as R,Tl as S,Ws as T,Vl as U,il as V,Jc as W,Ol as Z,Xi as a,on as b,js as c,It as d,ai as e,wc as f,ls as g,ps as h,gs as i,Bt as j,ys as k,Ds as l,w as m,U as n,tt as o,Yl as p,oi as q,sn as r,bl as s,Yi as t,Y as u,Ks as v,ri as w,oe as x,ii as y,vs as z};
